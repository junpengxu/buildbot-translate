

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.5.10. Properties &mdash; buildbot-translate 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.5.11. Build Steps" href="buildsteps.html" />
    <link rel="prev" title="2.5.9. Build Sets" href="buildsets.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> buildbot-translate
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">1. Buildbot Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">2. Buildbot Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">2.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.html">2.2. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts.html">2.3. Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../secretsmanagement.html">2.4. Secret Management</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">2.5. Configuration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="intro.html">2.5.1. Configuring Buildbot</a></li>
<li class="toctree-l3"><a class="reference internal" href="global.html">2.5.2. Global Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="changesources.html">2.5.3. Change Sources and Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="changesources.html#changes">2.5.4. Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="schedulers.html">2.5.5. Schedulers</a></li>
<li class="toctree-l3"><a class="reference internal" href="workers.html">2.5.6. Workers</a></li>
<li class="toctree-l3"><a class="reference internal" href="builders.html">2.5.7. Builder Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildfactories.html">2.5.8. Build Factories</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildsets.html">2.5.9. Build Sets</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.5.10. Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#common-build-properties">2.5.10.1. Common Build Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#source-stamp-attributes">2.5.10.2. Source Stamp Attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-properties-in-steps">2.5.10.3. Using Properties in Steps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="buildsteps.html">2.5.11. Build Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="interlocks.html">2.5.12. Interlocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="reporters.html">2.5.13. Reporters</a></li>
<li class="toctree-l3"><a class="reference internal" href="www.html">2.5.14. Web Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="wwwhooks.html">2.5.15. Change Hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="services.html">2.5.16. Custom Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="dbconfig.html">2.5.17. DbConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="configurators.html">2.5.18. Configurators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../customization.html">2.6. Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmdline.html">2.7. Command-line Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resources.html">2.8. Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization.html">2.9. Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins.html">2.10. Plugin Infrastructure in Buildbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy.html">2.11. Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrading/index.html">2.12. Upgrading</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">buildbot-translate</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html"><span class="section-number">2. </span>Buildbot Manual</a> &raquo;</li>
        
          <li><a href="index.html"><span class="section-number">2.5. </span>Configuration</a> &raquo;</li>
        
      <li><span class="section-number">2.5.10. </span>Properties</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/manual/configuration/properties.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="properties">
<span id="index-0"></span><span id="id1"></span><h1><span class="section-number">2.5.10. </span>Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h1>
<p>Build properties are a generalized way to provide configuration information to build steps; see <a class="reference internal" href="../concepts.html#build-properties"><span class="std std-ref">Build Properties</span></a> for the conceptual overview of properties.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#common-build-properties" id="id22">Common Build Properties</a></p></li>
<li><p><a class="reference internal" href="#source-stamp-attributes" id="id23">Source Stamp Attributes</a></p></li>
<li><p><a class="reference internal" href="#using-properties-in-steps" id="id24">Using Properties in Steps</a></p></li>
</ul>
</div>
<p>Some build properties come from external sources and are set before the build begins; others are set during the build, and available for later steps.
The sources for properties are:</p>
<dl class="simple">
<dt><a href="#id2"><span class="problematic" id="id3">:bb:cfg:`global configuration &lt;properties&gt;`</span></a></dt><dd><p>These properties apply to all builds.</p>
</dd>
<dt><a class="reference internal" href="schedulers.html#configuring-schedulers"><span class="std std-ref">schedulers</span></a></dt><dd><p>A scheduler can specify properties that become available to all builds it starts.</p>
</dd>
<dt><a class="reference internal" href="changesources.html#change-sources"><span class="std std-ref">changes</span></a></dt><dd><p>A change can have properties attached to it, supplying extra information gathered by the change source.
This is most commonly used with the <a href="#id4"><span class="problematic" id="id5">:bb:cmdline:`sendchange`</span></a> command.</p>
</dd>
<dt>forced builds</dt><dd><p>The “Force Build” form allows users to specify properties</p>
</dd>
<dt><a href="#id6"><span class="problematic" id="id7">:bb:cfg:`workers &lt;workers&gt;`</span></a></dt><dd><p>A worker can pass properties on to the builds it performs.</p>
</dd>
<dt><a class="reference internal" href="#common-build-properties"><span class="std std-ref">builds</span></a></dt><dd><p>A build automatically sets a number of properties on itself.</p>
</dd>
<dt><a href="#id8"><span class="problematic" id="id9">:bb:cfg:`builders &lt;builders&gt;`</span></a></dt><dd><p>A builder can set properties on all the builds it runs.</p>
</dd>
<dt><a class="reference internal" href="buildsteps.html#build-steps"><span class="std std-ref">steps</span></a></dt><dd><p>The steps of a build can set properties that are available to subsequent steps.
In particular, source steps set the <cite>got_revision</cite> property.</p>
</dd>
</dl>
<p>If the same property is supplied in multiple places, the final appearance takes precedence.
For example, a property set in a builder configuration will override one supplied by a scheduler.</p>
<p>Properties are stored internally in JSON format, so they are limited to basic types of data: numbers, strings, lists, and dictionaries.</p>
<div class="section" id="common-build-properties">
<span id="index-1"></span><span id="id10"></span><h2><a class="toc-backref" href="#id22"><span class="section-number">2.5.10.1. </span>Common Build Properties</a><a class="headerlink" href="#common-build-properties" title="Permalink to this headline">¶</a></h2>
<p>The following build properties are set when the build is started, and are available to all steps.</p>
<dl id="index-2">
<dt><code class="docutils literal notranslate"><span class="pre">got_revision</span></code></dt><dd><p>This property is set when a <code class="xref py py-class docutils literal notranslate"><span class="pre">Source</span></code> step checks out the source tree, and provides the revision that was actually obtained from the VC system.
In general this should be the same as <code class="docutils literal notranslate"><span class="pre">revision</span></code>, except for non-absolute sourcestamps, where <code class="docutils literal notranslate"><span class="pre">got_revision</span></code> indicates what revision was current when the checkout was performed.
This can be used to rebuild the same source code later.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For some VC systems (Darcs in particular), the revision is a large string containing newlines, and is not suitable for interpolation into a filename.</p>
</div>
<p>For multi-codebase builds (where codebase is not the default <cite>‘’</cite>), this property is a dictionary, keyed by codebase.</p>
</dd>
</dl>
<dl class="simple" id="index-3">
<dt><code class="docutils literal notranslate"><span class="pre">buildername</span></code></dt><dd><p>This is a string that indicates which <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> the build was a part of.
The combination of buildername and buildnumber uniquely identify a build.</p>
</dd>
</dl>
<dl class="simple" id="index-4">
<dt><code class="docutils literal notranslate"><span class="pre">buildnumber</span></code></dt><dd><p>Each build gets a number, scoped to the <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> (so the first build performed on any given <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> will have a build number of 0).
This integer property contains the build’s number.</p>
</dd>
</dl>
<dl class="simple" id="index-5">
<dt><code class="docutils literal notranslate"><span class="pre">workername</span></code></dt><dd><p>This is a string which identifies which worker the build is running on.</p>
</dd>
</dl>
<dl class="simple" id="index-6">
<dt><code class="docutils literal notranslate"><span class="pre">scheduler</span></code></dt><dd><p>If the build was started from a scheduler, then this property will contain the name of that scheduler.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">builddir</span></code></dt><dd><p>The absolute path of the base working directory on the worker, of the current builder.</p>
</dd>
</dl>
<p id="index-7">For single codebase builds, where the codebase is <cite>‘’</cite>, the following <a class="reference internal" href="#source-stamp-attributes"><span class="std std-ref">Source Stamp Attributes</span></a> are also available as properties: <code class="docutils literal notranslate"><span class="pre">branch</span></code>, <code class="docutils literal notranslate"><span class="pre">revision</span></code>, <code class="docutils literal notranslate"><span class="pre">repository</span></code>, and <code class="docutils literal notranslate"><span class="pre">project</span></code> .</p>
</div>
<div class="section" id="source-stamp-attributes">
<span id="id11"></span><h2><a class="toc-backref" href="#id23"><span class="section-number">2.5.10.2. </span>Source Stamp Attributes</a><a class="headerlink" href="#source-stamp-attributes" title="Permalink to this headline">¶</a></h2>
<p id="index-8"><code class="docutils literal notranslate"><span class="pre">branch</span></code>
<code class="docutils literal notranslate"><span class="pre">revision</span></code>
<code class="docutils literal notranslate"><span class="pre">repository</span></code>
<code class="docutils literal notranslate"><span class="pre">project</span></code>
<code class="docutils literal notranslate"><span class="pre">codebase</span></code></p>
<blockquote>
<div><p>For details of these attributes see <a class="reference internal" href="../concepts.html"><span class="doc">Concepts</span></a>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">changes</span></code></p>
<blockquote>
<div><p>This attribute is a list of dictionaries representing the changes that make up this sourcestamp.</p>
</div></blockquote>
</div>
<div class="section" id="using-properties-in-steps">
<h2><a class="toc-backref" href="#id24"><span class="section-number">2.5.10.3. </span>Using Properties in Steps</a><a class="headerlink" href="#using-properties-in-steps" title="Permalink to this headline">¶</a></h2>
<p>For the most part, properties are used to alter the behavior of build steps during a build.
This is done by using <span class="target" id="index-9"></span>renderables (objects implementing the <code class="xref py py-class docutils literal notranslate"><span class="pre">IRenderable</span></code> interface) as step parameters.
When the step is started, each such object is rendered using the current values of the build properties, and the resultant rendering is substituted as the actual value of the step parameter.</p>
<p>Buildbot offers several renderable object types covering common cases.
It’s also possible to <a class="reference internal" href="#custom-renderables"><span class="std std-ref">create custom renderables</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Properties are defined while a build is in progress; their values are not available when the configuration file is parsed.
This can sometimes confuse newcomers to Buildbot!
In particular, the following is a common error:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">Property</span><span class="p">(</span><span class="s1">&#39;release_train&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>This does not work because the value of the property is not available when the <code class="docutils literal notranslate"><span class="pre">if</span></code> statement is executed.
However, Python will not detect this as an error - you will just never see the step added to the factory.</p>
</div>
<p>You can use renderables in most step parameters.
Please file bugs for any parameters which do not accept renderables.</p>
<div class="section" id="property">
<span id="index-10"></span><span id="id12"></span><h3>Property<a class="headerlink" href="#property" title="Permalink to this headline">¶</a></h3>
<p>The simplest renderable is <code class="xref py py-class docutils literal notranslate"><span class="pre">Property</span></code>, which renders to the value of the property named by its argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="s1">&#39;buildername:&#39;</span><span class="p">,</span>
                             <span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;buildername&#39;</span><span class="p">)]))</span>
</pre></div>
</div>
<p>You can specify a default value by passing a <code class="docutils literal notranslate"><span class="pre">default</span></code> keyword argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="s1">&#39;warnings:&#39;</span><span class="p">,</span>
                             <span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;warnings&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)]))</span>
</pre></div>
</div>
<p>The default value is used when the property doesn’t exist, or when the value is something Python regards as <code class="docutils literal notranslate"><span class="pre">False</span></code>.
The <code class="docutils literal notranslate"><span class="pre">defaultWhenFalse</span></code> argument can be set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to force buildbot to use the default argument only if the parameter is not set:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="s1">&#39;warnings:&#39;</span><span class="p">,</span>
                             <span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;warnings&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                           <span class="n">defaultWhenFalse</span><span class="o">=</span><span class="bp">False</span><span class="p">)]))</span>
</pre></div>
</div>
<p>The default value can be a renderable itself, e.g.,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">command</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;default-command&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="interpolate">
<span id="index-11"></span><span id="id13"></span><h3>Interpolate<a class="headerlink" href="#interpolate" title="Permalink to this headline">¶</a></h3>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">Property</span></code> can only be used to replace an entire argument: in the example above, it replaces an argument to <code class="docutils literal notranslate"><span class="pre">echo</span></code>.
Often, properties need to be interpolated into strings, instead.
The tool for that job is <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a>.</p>
<p>The more common pattern is to use Python dictionary-style string interpolation by using the <code class="docutils literal notranslate"><span class="pre">%(prop:&lt;propname&gt;)s</span></code> syntax.
In this form, the property name goes in the parentheses, as above.
A common mistake is to omit the trailing “s”, leading to a rather obscure error from Python (“ValueError: unsupported format character”).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span>
            <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;REVISION=%(prop:got_revision)s&#39;</span><span class="p">),</span>
            <span class="s1">&#39;dist&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p>This example will result in a <code class="docutils literal notranslate"><span class="pre">make</span></code> command with an argument like <code class="docutils literal notranslate"><span class="pre">REVISION=12098</span></code>.</p>
<p id="interpolate-dictstyle">The syntax of dictionary-style interpolation is a selector, followed by a colon, followed by a selector specific key, optionally followed by a colon and a string indicating how to interpret the value produced by the key.</p>
<p>The following selectors are supported.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">prop</span></code></dt><dd><p>The key is the name of a property.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">src</span></code></dt><dd><p>The key is a codebase and source stamp attribute, separated by a colon.
Note, it is <code class="docutils literal notranslate"><span class="pre">%(src:&lt;codebase&gt;:&lt;ssattr&gt;)s</span></code> syntax, which differs from other selectors.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">kw</span></code></dt><dd><p>The key refers to a keyword argument passed to <code class="docutils literal notranslate"><span class="pre">Interpolate</span></code>.
Those keyword arguments may be ordinary values or renderables.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">secrets</span></code></dt><dd><p>The key refers to a secret provided by a provider declared in <a href="#id14"><span class="problematic" id="id15">:bb:cfg:`secretsProviders`</span></a> .</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">worker</span></code></dt><dd><p>The key refers to a info item provided by <a href="#id16"><span class="problematic" id="id17">:bb:cfg:`workers`</span></a>.</p>
</dd>
</dl>
<p>The following ways of interpreting the value are available.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-replacement</span></code></dt><dd><p>If the key exists, substitute its value; otherwise, substitute <code class="docutils literal notranslate"><span class="pre">replacement</span></code>.
<code class="docutils literal notranslate"><span class="pre">replacement</span></code> may be empty (<code class="docutils literal notranslate"><span class="pre">%(prop:propname:-)s</span></code>).
This is the default.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">~replacement</span></code></dt><dd><p>Like <code class="docutils literal notranslate"><span class="pre">-replacement</span></code>, but only substitutes the value of the key if it is something Python regards as <code class="docutils literal notranslate"><span class="pre">True</span></code>.
Python considers <code class="docutils literal notranslate"><span class="pre">None</span></code>, 0, empty lists, and the empty string to be false, so such values will be replaced by <code class="docutils literal notranslate"><span class="pre">replacement</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">+replacement</span></code></dt><dd><p>If the key exists, substitute <code class="docutils literal notranslate"><span class="pre">replacement</span></code>; otherwise, substitute an empty string.</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">?|sub_if_exists|sub_if_missing</span></code></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">#?|sub_if_true|sub_if_false</span></code></dt><dd><p>Ternary substitution, depending on either the key being present (with <code class="docutils literal notranslate"><span class="pre">?</span></code>, similar to <code class="docutils literal notranslate"><span class="pre">+</span></code>) or being <code class="docutils literal notranslate"><span class="pre">True</span></code> (with <code class="docutils literal notranslate"><span class="pre">#?</span></code>, like <code class="docutils literal notranslate"><span class="pre">~</span></code>).
Notice that there is a pipe immediately following the question mark <em>and</em> between the two substitution alternatives.
The character that follows the question mark is used as the delimiter between the two alternatives.
In the above examples, it is a pipe, but any character other than <code class="docutils literal notranslate"><span class="pre">(</span></code> can be used.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although these are similar to shell substitutions, no other substitutions are currently supported.</p>
</div>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;save-build-artifacts-script.sh&#39;</span><span class="p">,</span>
        <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;-r %(prop:repository)s&#39;</span><span class="p">),</span>
        <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;-b %(src::branch)s&#39;</span><span class="p">),</span>
        <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;-d %(kw:data)s&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;some extra needed data&quot;</span><span class="p">)</span>
    <span class="p">]))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We use <code class="docutils literal notranslate"><span class="pre">%(src::branch)s</span></code> in most of examples, because <code class="docutils literal notranslate"><span class="pre">codebase</span></code> is empty by default.</p>
</div>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;make&#39;</span><span class="p">,</span>
        <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;REVISION=%(prop:got_revision:-%(src::revision:-unknown)s)s&#39;</span><span class="p">),</span>
        <span class="s1">&#39;dist&#39;</span>
    <span class="p">]))</span>
</pre></div>
</div>
<p>In addition, <code class="docutils literal notranslate"><span class="pre">Interpolate</span></code> supports using positional string interpolation.
Here, <code class="docutils literal notranslate"><span class="pre">%s</span></code> is used as a placeholder, and the substitutions (which may be renderables), are given as subsequent arguments:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">TODO</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Like Python, you can use either positional interpolation <em>or</em> dictionary-style interpolation, not both.
Thus you cannot use a string like <code class="docutils literal notranslate"><span class="pre">Interpolate(&quot;foo-%(src::revision)s-%s&quot;,</span> <span class="pre">&quot;branch&quot;)</span></code>.</p>
</div>
</div>
<div class="section" id="renderer">
<span id="index-12"></span><span id="id18"></span><h3>Renderer<a class="headerlink" href="#renderer" title="Permalink to this headline">¶</a></h3>
<p>While Interpolate can handle many simple cases, and even some common conditionals, more complex cases are best handled with Python code.
The <code class="docutils literal notranslate"><span class="pre">renderer</span></code> decorator creates a renderable object whose rendering is obtained by calling the decorated function when the step it’s passed to begins.
The function receives an <code class="xref py py-class docutils literal notranslate"><span class="pre">IProperties</span></code> object, which it can use to examine the values of any and all properties.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="nd">@util.renderer</span>
<span class="k">def</span> <span class="nf">makeCommand</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">]</span>
    <span class="n">cpus</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;CPUs&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cpus</span><span class="p">:</span>
        <span class="n">command</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;-j&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cpus</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">command</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;-j&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">])</span>
    <span class="n">command</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;%(prop:MAKETARGET)s&#39;</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">command</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">makeCommand</span><span class="p">))</span>
</pre></div>
</div>
<p>You can think of <code class="docutils literal notranslate"><span class="pre">renderer</span></code> as saying “call this function when the step starts”.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since 0.9.3, renderer can itself return <code class="xref py py-class docutils literal notranslate"><span class="pre">IRenderable</span></code> objects or containers containing <code class="xref py py-class docutils literal notranslate"><span class="pre">IRenderable</span></code>.</p>
</div>
<p>Optionally, extra arguments may be passed to the rendered function at any time by calling <code class="docutils literal notranslate"><span class="pre">withArgs</span></code> on the renderable object.
The <code class="docutils literal notranslate"><span class="pre">withArgs</span></code> method accepts <code class="docutils literal notranslate"><span class="pre">*args</span></code> and <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> arguments which are stored in a new renderable object which is returned.
The original renderable object is not modified.
Multiple <code class="docutils literal notranslate"><span class="pre">withArgs</span></code> calls may be chained.
The passed <code class="docutils literal notranslate"><span class="pre">*args</span></code> and <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> parameters are rendered and the results are passed to the rendered function at the time it is itself rendered.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="nd">@util.renderer</span>
<span class="k">def</span> <span class="nf">makeCommand</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">]</span>
    <span class="n">cpus</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;CPUs&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cpus</span><span class="p">:</span>
        <span class="n">command</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;-j&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cpus</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">command</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;-j&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">])</span>
    <span class="n">command</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">target</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">command</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">makeCommand</span><span class="o">.</span><span class="n">withArgs</span><span class="p">(</span><span class="s1">&#39;mytarget&#39;</span><span class="p">)))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The rendering of the renderable object may happen at unexpected times, so it is best to ensure that the passed extra arguments are not changed.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Config errors with Renderables may not always be caught via checkconfig</p>
</div>
</div>
<div class="section" id="transform">
<span id="index-13"></span><span id="id19"></span><h3>Transform<a class="headerlink" href="#transform" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Transform</span></code> is an alternative to <code class="docutils literal notranslate"><span class="pre">renderer</span></code>.
While <code class="docutils literal notranslate"><span class="pre">renderer</span></code> is useful for creating new renderables, <code class="docutils literal notranslate"><span class="pre">Transform</span></code> is easier to use when you want to transform or combine the renderings of preexisting ones.</p>
<p><code class="docutils literal notranslate"><span class="pre">Transform</span></code> takes a function and any number of positional and keyword arguments.
The function must either be a callable object or a renderable producing one.
When rendered, a <code class="docutils literal notranslate"><span class="pre">Transform</span></code> first replaces all of its arguments that are renderables with their renderings, then calls the function, passing it the positional and keyword arguments, and returns the result as its own rendering.</p>
<p>For example, suppose <code class="docutils literal notranslate"><span class="pre">my_path</span></code> is a path on the worker, and you want to get it relative to the build directory.
You can do it like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>

<span class="n">my_path_rel</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">,</span> <span class="n">my_path</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;builddir&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>This works whether <code class="docutils literal notranslate"><span class="pre">my_path</span></code> is an ordinary string or a renderable.
<code class="docutils literal notranslate"><span class="pre">my_path_rel</span></code> will be a renderable in either case, however.</p>
</div>
<div class="section" id="flattenlist">
<span id="withproperties"></span><span id="index-14"></span><h3>FlattenList<a class="headerlink" href="#flattenlist" title="Permalink to this headline">¶</a></h3>
<p>If nested list should be flatten for some renderables, FlattenList could be used.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span> <span class="s1">&#39;make&#39;</span> <span class="p">],</span>
    <span class="n">descriptionDone</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">FlattenList</span><span class="p">([</span> <span class="s1">&#39;make &#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;done&#39;</span> <span class="p">]])</span>
<span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">descriptionDone</span></code> would be set to <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">'make',</span> <span class="pre">'done'</span> <span class="pre">]</span></code> when the <code class="docutils literal notranslate"><span class="pre">ShellCommand</span></code> executes.
This is useful when a list-returning property is used in renderables.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ShellCommand automatically flattens nested lists in its <code class="docutils literal notranslate"><span class="pre">command</span></code> argument, so there is no need to use <code class="docutils literal notranslate"><span class="pre">FlattenList</span></code> for it.</p>
</div>
</div>
<div class="section" id="id20">
<h3>WithProperties<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This class is deprecated.
It is an older version of <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a>.
It exists for compatibility with older configs.</p>
</div>
<p>The simplest use of this class is with positional string interpolation.
Here, <code class="docutils literal notranslate"><span class="pre">%s</span></code> is used as a placeholder, and property names are given as subsequent arguments:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tar&quot;</span><span class="p">,</span> <span class="s2">&quot;czf&quot;</span><span class="p">,</span>
            <span class="n">util</span><span class="o">.</span><span class="n">WithProperties</span><span class="p">(</span><span class="s2">&quot;build-</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">.tar.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;branch&quot;</span><span class="p">,</span> <span class="s2">&quot;revision&quot;</span><span class="p">),</span>
            <span class="s2">&quot;source&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>If this <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> were used in a tree obtained from Git, it would create a tarball with a name like <code class="file docutils literal notranslate"><span class="pre">build-master-a7d3a333db708e786edb34b6af646edd8d4d3ad9.tar.gz</span></code>.</p>
<p id="index-15">The more common pattern is to use Python dictionary-style string interpolation by using the <code class="docutils literal notranslate"><span class="pre">%(propname)s</span></code> syntax.
In this form, the property name goes in the parentheses, as above.
A common mistake is to omit the trailing “s”, leading to a rather obscure error from Python (“ValueError: unsupported format character”).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span>
            <span class="n">util</span><span class="o">.</span><span class="n">WithProperties</span><span class="p">(</span><span class="s1">&#39;REVISION=</span><span class="si">%(got_revision)s</span><span class="s1">&#39;</span><span class="p">),</span>
            <span class="s1">&#39;dist&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p>This example will result in a <code class="docutils literal notranslate"><span class="pre">make</span></code> command with an argument like <code class="docutils literal notranslate"><span class="pre">REVISION=12098</span></code>.</p>
<p id="withproperties-dictstyle">The dictionary-style interpolation supports a number of more advanced syntaxes in the parentheses.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">propname:-replacement</span></code></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">propname</span></code> exists, substitute its value; otherwise, substitute <code class="docutils literal notranslate"><span class="pre">replacement</span></code>.
<code class="docutils literal notranslate"><span class="pre">replacement</span></code> may be empty (<code class="docutils literal notranslate"><span class="pre">%(propname:-)s</span></code>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">propname:~replacement</span></code></dt><dd><p>Like <code class="docutils literal notranslate"><span class="pre">propname:-replacement</span></code>, but only substitutes the value of property <code class="docutils literal notranslate"><span class="pre">propname</span></code> if it is something Python regards as <code class="docutils literal notranslate"><span class="pre">True</span></code>.
Python considers <code class="docutils literal notranslate"><span class="pre">None</span></code>, 0, empty lists, and the empty string to be false, so such values will be replaced by <code class="docutils literal notranslate"><span class="pre">replacement</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">propname:+replacement</span></code></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">propname</span></code> exists, substitute <code class="docutils literal notranslate"><span class="pre">replacement</span></code>; otherwise, substitute an empty string.</p>
</dd>
</dl>
<p>Although these are similar to shell substitutions, no other substitutions are currently supported, and <code class="docutils literal notranslate"><span class="pre">replacement</span></code> in the above cannot contain more substitutions.</p>
<p>Note: like Python, you can use either positional interpolation <em>or</em> dictionary-style interpolation, not both.
Thus you cannot use a string like <code class="docutils literal notranslate"><span class="pre">WithProperties(&quot;foo-%(revision)s-%s&quot;,</span> <span class="pre">&quot;branch&quot;)</span></code>.</p>
</div>
<div class="section" id="custom-renderables">
<span id="id21"></span><h3>Custom Renderables<a class="headerlink" href="#custom-renderables" title="Permalink to this headline">¶</a></h3>
<p>If the options described above are not sufficient, more complex substitutions can be achieved by writing custom renderables.</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">IRenderable</span></code> interface is simple - objects must provide a <cite>getRenderingFor</cite> method.
The method should take one argument - an <code class="xref py py-class docutils literal notranslate"><span class="pre">IProperties</span></code> provider - and should return the rendered value or a deferred firing with one.
Pass instances of the class anywhere other renderables are accepted.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">buildbot.interfaces</span> <span class="kn">import</span> <span class="n">IRenderable</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">implementer</span>

<span class="nd">@implementer</span><span class="p">(</span><span class="n">IRenderable</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DetermineFoo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getRenderingFor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">props</span><span class="o">.</span><span class="n">hasProperty</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">props</span><span class="o">.</span><span class="n">hasProperty</span><span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;baz&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="s1">&#39;qux&#39;</span>
<span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="n">DetermineFoo</span><span class="p">()])</span>
</pre></div>
</div>
<p>or, more practically,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.interfaces</span> <span class="kn">import</span> <span class="n">IRenderable</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">implementer</span>
<span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>

<span class="nd">@implementer</span><span class="p">(</span><span class="n">IRenderable</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Now</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getRenderingFor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;TIME=%(kw:now)s&#39;</span><span class="p">,</span> <span class="n">now</span><span class="o">=</span><span class="n">Now</span><span class="p">())])</span>
</pre></div>
</div>
<p>This is equivalent to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>

<span class="nd">@util.renderer</span>
<span class="k">def</span> <span class="nf">now</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;TIME=%(kw:now)s&#39;</span><span class="p">,</span> <span class="n">now</span><span class="o">=</span><span class="n">now</span><span class="p">)])</span>
</pre></div>
</div>
<p>Note that a custom renderable must be instantiated (and its constructor can take whatever arguments you’d like), whereas a function decorated with <code class="xref py py-func docutils literal notranslate"><span class="pre">renderer()</span></code> can be used directly.</p>
</div>
<div class="section" id="url-for-build">
<span id="urlforbuild"></span><h3>URL for build<a class="headerlink" href="#url-for-build" title="Permalink to this headline">¶</a></h3>
<p>Its common to need to use the URL for the build in a step.
For this you can use a special custom renderer as following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;BUILDURL=%(kw:url)s&#39;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">URLForBuild</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="buildsteps.html" class="btn btn-neutral float-right" title="2.5.11. Build Steps" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="buildsets.html" class="btn btn-neutral float-left" title="2.5.9. Build Sets" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, junpengxu

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>