

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.5.15. Change Hooks &mdash; buildbot-translate 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.5.16. Custom Services" href="services.html" />
    <link rel="prev" title="2.5.14. Web Server" href="www.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> buildbot-translate
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">1. Buildbot Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">2. Buildbot Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">2.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.html">2.2. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts.html">2.3. Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../secretsmanagement.html">2.4. Secret Management</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">2.5. Configuration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="intro.html">2.5.1. Configuring Buildbot</a></li>
<li class="toctree-l3"><a class="reference internal" href="global.html">2.5.2. Global Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="changesources.html">2.5.3. Change Sources and Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="changesources.html#changes">2.5.4. Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="schedulers.html">2.5.5. Schedulers</a></li>
<li class="toctree-l3"><a class="reference internal" href="workers.html">2.5.6. Workers</a></li>
<li class="toctree-l3"><a class="reference internal" href="builders.html">2.5.7. Builder Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildfactories.html">2.5.8. Build Factories</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildsets.html">2.5.9. Build Sets</a></li>
<li class="toctree-l3"><a class="reference internal" href="properties.html">2.5.10. Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildsteps.html">2.5.11. Build Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="interlocks.html">2.5.12. Interlocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="reporters.html">2.5.13. Reporters</a></li>
<li class="toctree-l3"><a class="reference internal" href="www.html">2.5.14. Web Server</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.5.15. Change Hooks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#change-hooks-auth">2.5.15.1. Change Hooks Auth</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mercurial-hook">2.5.15.2. Mercurial hook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#github-hook">2.5.15.3. GitHub hook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bitbucket-hook">2.5.15.4. BitBucket hook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bitbucket-cloud-hook">2.5.15.5. Bitbucket Cloud hook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bitbucket-server-hook">2.5.15.6. Bitbucket Server hook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#poller-hook">2.5.15.7. Poller hook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gitlab-hook">2.5.15.8. GitLab hook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gitorious-hook">2.5.15.9. Gitorious Hook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#custom-hooks">2.5.15.10. Custom Hooks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="services.html">2.5.16. Custom Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="dbconfig.html">2.5.17. DbConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="configurators.html">2.5.18. Configurators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../customization.html">2.6. Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmdline.html">2.7. Command-line Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resources.html">2.8. Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization.html">2.9. Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins.html">2.10. Plugin Infrastructure in Buildbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy.html">2.11. Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrading/index.html">2.12. Upgrading</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">buildbot-translate</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html"><span class="section-number">2. </span>Buildbot Manual</a> &raquo;</li>
        
          <li><a href="index.html"><span class="section-number">2.5. </span>Configuration</a> &raquo;</li>
        
      <li><span class="section-number">2.5.15. </span>Change Hooks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/manual/configuration/wwwhooks.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="change-hooks">
<span id="id1"></span><h1><span class="section-number">2.5.15. </span>Change Hooks<a class="headerlink" href="#change-hooks" title="Permalink to this headline">Â¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">/change_hook</span></code> url is a magic URL which will accept HTTP requests and translate them into changes for buildbot.
Implementations (such as a trivial json-based endpoint and a GitHub implementation) can be found in <a href="#id2"><span class="problematic" id="id3">:src:`master/buildbot/www/hooks`</span></a>.
The format of the url is <code class="samp docutils literal notranslate"><span class="pre">/change_hook/</span><em><span class="pre">DIALECT</span></em></code> where DIALECT is a package within the hooks directory.
Change_hook is disabled by default and each DIALECT has to be enabled separately, for security reasons</p>
<p>An example www configuration line which enables change_hook and two DIALECTS:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span>
                          <span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                          <span class="s1">&#39;somehook&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;option1&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                                       <span class="s1">&#39;option2&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">},</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Within the <code class="docutils literal notranslate"><span class="pre">www</span></code> config dictionary arguments, the <code class="docutils literal notranslate"><span class="pre">change_hook</span></code> key enables/disables the module and <code class="docutils literal notranslate"><span class="pre">change_hook_dialects</span></code> whitelists DIALECTs where the keys are the module names and the values are optional arguments which will be passed to the hooks.</p>
<p>The <a href="#id4"><span class="problematic" id="id5">:contrib-src:`master/contrib/post_build_request.py`</span></a> script allows for the submission of an arbitrary change request.
Run <strong class="command">post_build_request.py --help</strong> for more information.
The <code class="docutils literal notranslate"><span class="pre">base</span></code> dialect must be enabled for this to work.</p>
<div class="section" id="change-hooks-auth">
<span id="id6"></span><h2><span class="section-number">2.5.15.1. </span>Change Hooks Auth<a class="headerlink" href="#change-hooks-auth" title="Permalink to this headline">Â¶</a></h2>
<p>By default change hook URL is not protected.
Some hooks implement their own authentication method.
Other requires the generic method to be secured.</p>
<p>To protect URL against unauthorized access you may use <code class="docutils literal notranslate"><span class="pre">change_hook_auth</span></code> option.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method uses <code class="docutils literal notranslate"><span class="pre">HTTP</span> <span class="pre">BasicAuth</span></code>, it implies the use of SSL via <a class="reference internal" href="www.html#reverse-proxy-config"><span class="std std-ref">Reverse Proxy Configuration</span></a> in order to be fully secured.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.cred</span> <span class="kn">import</span> <span class="n">strcred</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
      <span class="n">change_hook_auth</span><span class="o">=</span><span class="p">[</span><span class="n">strcred</span><span class="o">.</span><span class="n">makeChecker</span><span class="p">(</span><span class="s2">&quot;file:changehook.passwd&quot;</span><span class="p">)],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>create a file <code class="docutils literal notranslate"><span class="pre">changehook.passwd</span></code> with content:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>user:password
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">change_hook_auth</span></code> should be a list of <code class="xref py py-class docutils literal notranslate"><span class="pre">ICredentialsChecker</span></code>.
See the details of available options in <a class="reference external" href="https://twistedmatrix.com/documents/current/core/howto/cred.html">Twisted documentation</a>.</p>
</div>
<div class="section" id="mercurial-hook">
<h2><span class="section-number">2.5.15.2. </span>Mercurial hook<a class="headerlink" href="#mercurial-hook" title="Permalink to this headline">Â¶</a></h2>
<p>The Mercurial hook uses the base dialect:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Once this is configured on your buildmaster add the following hook on your server-side Mercurial repositoryâs <code class="docutils literal notranslate"><span class="pre">hgrc</span></code>:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[hooks]</span>
<span class="na">changegroup.buildbot</span> <span class="o">=</span> <span class="s">python:/path/to/hgbuildbot.py:hook</span>
</pre></div>
</div>
<p>Youâll find <a href="#id7"><span class="problematic" id="id8">:contrib-src:`master/contrib/hgbuildbot.py`</span></a>, and its inline documentation, in the <a href="#id9"><span class="problematic" id="id10">:contrib-src:`buildbot-contrib &lt;../../&gt;`</span></a> repository.</p>
</div>
<div class="section" id="github-hook">
<h2><span class="section-number">2.5.15.3. </span>GitHub hook<a class="headerlink" href="#github-hook" title="Permalink to this headline">Â¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is a standalone HTTP server available for receiving GitHub notifications as well: <a href="#id11"><span class="problematic" id="id12">:contrib-src:`master/contrib/github_buildbot.py`</span></a>.
This script may be useful in cases where you cannot expose the WebStatus for public consumption. Alternatively, you can setup a reverse proxy <a class="reference internal" href="www.html#reverse-proxy-config"><span class="std std-ref">Reverse Proxy Configuration</span></a></p>
</div>
<p>The GitHub hook has the following parameters:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">secret</span></code> (default <cite>None</cite>)</dt><dd><p>Secret token to use to validate payloads.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">strict</span></code> (default <cite>False</cite>)</dt><dd><p>If the hook must be strict regarding valid payloads.
If the value is <cite>False</cite> (default), the signature will only be checked if a secret is specified and a signature was supplied with the payload.
If the value is <cite>True</cite>, a secret must be provided, and payloads without signature will be ignored.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">codebase</span></code> (default <cite>None</cite>)</dt><dd><p>The codebase value to include with created changes.
If the value is a function (or any other callable), it will be called with the GitHub event payload as argument and the function must return the codebase value to use for the event.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">class</span></code> (default <cite>None</cite>)</dt><dd><p>A class to be used for processing incoming payloads.
If the value is <cite>None</cite> (default), the default class â <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.www.hooks.github.GitHubEventHandler</span></code> â will be used.
The default class handles <cite>ping</cite>, <cite>push</cite> and <cite>pull_request</cite> events only.
If youâd like to handle other events (see <a class="reference external" href="https://developer.github.com/v3/activity/events/types/">Event Types &amp; Payloads</a> for more information), youâd need to subclass <code class="docutils literal notranslate"><span class="pre">GitHubEventHandler</span></code> and add handler methods for the corresponding events.
For example, if youâd like to handle <cite>blah</cite> events, your code should look something like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.www.hooks.github</span> <span class="kn">import</span> <span class="n">GitHubEventHandler</span>

<span class="k">class</span> <span class="nc">MyBlahHandler</span><span class="p">(</span><span class="n">GitHubEventHandler</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">handle_blah</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
        <span class="c1"># Do some magic here</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="s1">&#39;git&#39;</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">skips</span></code> (default <code class="docutils literal notranslate"><span class="pre">[r'\[</span> <span class="pre">*skip</span> <span class="pre">*ci</span> <span class="pre">*\]',</span> <span class="pre">r'\[</span> <span class="pre">*ci</span> <span class="pre">*skip</span> <span class="pre">*\]']</span></code>)</dt><dd><p>A list of regex pattern makes buildbot ignore the push event.
For instance, if user push 3 commits and the commit message of branch head
contains a key string <code class="docutils literal notranslate"><span class="pre">[ci</span> <span class="pre">skip]</span></code>, buildbot will ignore this push event.</p>
<p>If you want to disable the skip checking, please set it to <code class="docutils literal notranslate"><span class="pre">[]</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">github_api_endpoint</span></code> (default <code class="docutils literal notranslate"><span class="pre">https://api.github.com</span></code>)</dt><dd><p>If you have a self-host GitHub Enterprise installation, please set
this url properly.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">token</span></code></dt><dd><p>If your GitHub or GitHub Enterprise instance does not allow anonymous communication, you need to provide an access token.  Instructions can be found here &lt;<a class="reference external" href="https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/">https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/</a>&gt;</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pullrequest_ref</span></code> (default <code class="docutils literal notranslate"><span class="pre">merge</span></code>)</dt><dd><p>Remote ref to test if a pull request is sent to the endpoint. See the GitHub developer manual
for possible values for pull requests. (e.g. <code class="docutils literal notranslate"><span class="pre">head</span></code>)</p>
</dd>
</dl>
<p>The simplest way to use GitHub hook is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;github&#39;</span><span class="p">:</span> <span class="p">{}},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Having added this line, you should add a webhook for your GitHub project (see <a class="reference external" href="https://developer.github.com/webhooks/creating/">Creating Webhooks page at GitHub</a>).
The parameters are:</p>
<dl>
<dt><span class="guilabel">Payload URL</span></dt><dd><p>This URL should point to <code class="docutils literal notranslate"><span class="pre">/change_hook/github</span></code> relative to the root of the web status.
For example, if the base URL is <code class="docutils literal notranslate"><span class="pre">http://builds.example.com/buildbot</span></code>, then point GitHub to <code class="docutils literal notranslate"><span class="pre">http://builds.example.com/buildbot/change_hook/github</span></code>.
To specify a project associated to the repository, append <code class="docutils literal notranslate"><span class="pre">?project=name</span></code> to the URL.</p>
</dd>
<dt><span class="guilabel">Content Type</span></dt><dd><p>Specify <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code> or <code class="docutils literal notranslate"><span class="pre">application/json</span></code>.</p>
</dd>
<dt><span class="guilabel">Secret</span></dt><dd><p>Any value.
If you provide a non-empty value (recommended), make sure that your hook is configured to use it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;github&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;secret&#39;</span><span class="p">:</span> <span class="s1">&#39;MY-SECRET&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><span class="guilabel">Which events would you like to trigger this webhook?</span></dt><dd><p>Click â <code class="docutils literal notranslate"><span class="pre">Let</span> <span class="pre">me</span> <span class="pre">select</span> <span class="pre">individual</span> <span class="pre">events</span></code>, then select <code class="docutils literal notranslate"><span class="pre">Push</span></code> and <code class="docutils literal notranslate"><span class="pre">Pull</span> <span class="pre">request</span></code> â other kind of events are not currently supported.</p>
</dd>
</dl>
<p>And then press the <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">Webhook</span></code> button.</p>
<p>Github hook creates 3 kinds of changes, distinguishable by their <code class="docutils literal notranslate"><span class="pre">category</span></code> field:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">None</span></code>: This change is a push to a branch.</dt><dd><p>Use <code class="docutils literal notranslate"><span class="pre">util.ChangeFilter(category=None,</span> <span class="pre">repository=&quot;http://github.com/&lt;org&gt;/&lt;project&gt;&quot;)</span></code></p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">'tag'</span></code>: This change is a push to a tag.</dt><dd><p>Use <code class="docutils literal notranslate"><span class="pre">util.ChangeFilter(category='tag',</span> <span class="pre">repository=&quot;http://github.com/&lt;org&gt;/&lt;project&gt;&quot;)</span></code></p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">'pull'</span></code>: This change is from a pull-request creation or update.</dt><dd><p>Use <code class="docutils literal notranslate"><span class="pre">util.ChangeFilter(category='pull',</span> <span class="pre">repository=&quot;http://github.com/&lt;org&gt;/&lt;project&gt;&quot;)</span></code>
In this case, the <a href="#id13"><span class="problematic" id="id14">:bb:step:`GitHub`</span></a> step must be used instead of the standard <a href="#id15"><span class="problematic" id="id16">:bb:step:`Git`</span></a> in order to be able to pull GitHubâs magic refs.
With this method, the <a href="#id17"><span class="problematic" id="id18">:bb:step:`GitHub`</span></a> step will always checkout the branch merged with latest master.
This allows to test the result of the merge instead of just the source branch.
Note that you can use the <a href="#id19"><span class="problematic" id="id20">:bb:step:`GitHub`</span></a> for all categories of event.</p>
</dd>
</dl>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Pull requests against every branch will trigger the webhook; the base branch name will be in the <code class="docutils literal notranslate"><span class="pre">basename</span></code> property of the build.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The incoming HTTP requests for this hook are not authenticated by default.
Anyone who can access the web server can âfakeâ a request from GitHub, potentially causing the buildmaster to run arbitrary code.</p>
</div>
<p>To protect URL against unauthorized access you should use <a class="reference internal" href="#change-hooks-auth"><span class="std std-ref">Change Hooks Auth</span></a> option.
Then change the the <code class="docutils literal notranslate"><span class="pre">Payload</span> <span class="pre">URL</span></code> of your GitHub webhook to <code class="docutils literal notranslate"><span class="pre">https://user:password&#64;builds.example.com/bbot/change_hook/github</span></code>.</p>
</div>
<div class="section" id="bitbucket-hook">
<h2><span class="section-number">2.5.15.4. </span>BitBucket hook<a class="headerlink" href="#bitbucket-hook" title="Permalink to this headline">Â¶</a></h2>
<p>The BitBucket hook is as simple as GitHub one and it takes no options.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bitbucket&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>When this is setup you should add a <cite>POST</cite> service pointing to <code class="docutils literal notranslate"><span class="pre">/change_hook/bitbucket</span></code> relative to the root of the web status.
For example, it the grid URL is <code class="docutils literal notranslate"><span class="pre">http://builds.example.com/bbot/grid</span></code>, then point BitBucket to <code class="docutils literal notranslate"><span class="pre">http://builds.example.com/change_hook/bitbucket</span></code>.
To specify a project associated to the repository, append <code class="docutils literal notranslate"><span class="pre">?project=name</span></code> to the URL.</p>
<p>Note that there is a standalone HTTP server available for receiving BitBucket notifications, as well: <a href="#id21"><span class="problematic" id="id22">:contrib-src:`master/contrib/bitbucket_buildbot.py`</span></a>.
This script may be useful in cases where you cannot expose the WebStatus for public consumption.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>As in the previous case, the incoming HTTP requests for this hook are not authenticated by default.
Anyone who can access the web status can âfakeâ a request from BitBucket, potentially causing the buildmaster to run arbitrary code.</p>
</div>
<p>To protect URL against unauthorized access you should use <a class="reference internal" href="#change-hooks-auth"><span class="std std-ref">Change Hooks Auth</span></a> option.
Then, create a BitBucket service hook (see <a class="reference external" href="https://confluence.atlassian.com/display/BITBUCKET/POST+Service+Management">https://confluence.atlassian.com/display/BITBUCKET/POST+Service+Management</a>) with a WebHook URL like <code class="docutils literal notranslate"><span class="pre">https://user:password&#64;builds.example.com/bbot/change_hook/bitbucket</span></code>.</p>
<p>Note that as before, not using <code class="docutils literal notranslate"><span class="pre">change_hook_auth</span></code> can expose you to security risks.</p>
</div>
<div class="section" id="bitbucket-cloud-hook">
<h2><span class="section-number">2.5.15.5. </span>Bitbucket Cloud hook<a class="headerlink" href="#bitbucket-cloud-hook" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bitbucketcloud&#39;</span><span class="p">:</span> <span class="p">{}},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>When this is setup you should add a webhook pointing to <code class="docutils literal notranslate"><span class="pre">/change_hook/bitbucketcloud</span></code> relative to the root of the web status.</p>
<p>According to the type of the event, the change category is set to <code class="docutils literal notranslate"><span class="pre">push</span></code>, <code class="docutils literal notranslate"><span class="pre">pull-created</span></code>, <code class="docutils literal notranslate"><span class="pre">pull-rejected</span></code>, <code class="docutils literal notranslate"><span class="pre">pull-updated</span></code>, <code class="docutils literal notranslate"><span class="pre">pull-fulfilled</span></code> or <code class="docutils literal notranslate"><span class="pre">ref-deleted</span></code>.</p>
<p>The Bitbucket Cloud hook may have the following optional parameters:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">codebase</span></code> (default <cite>None</cite>)</dt><dd><p>The codebase value to include with changes or a callable object that will be passed the payload in order to get it.</p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The incoming HTTP requests for this hook are not authenticated by default.
Anyone who can access the web server can âfakeâ a request from Bitbucket Cloud, potentially causing the buildmaster to run arbitrary code</p>
</div>
</div>
<div class="section" id="bitbucket-server-hook">
<h2><span class="section-number">2.5.15.6. </span>Bitbucket Server hook<a class="headerlink" href="#bitbucket-server-hook" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bitbucketserver&#39;</span><span class="p">:</span> <span class="p">{}},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>When this is setup you should add a webhook pointing to <code class="docutils literal notranslate"><span class="pre">/change_hook/bitbucketserver</span></code> relative to the root of the web status.</p>
<p>According to the type of the event, the change category is set to <code class="docutils literal notranslate"><span class="pre">push</span></code>, <code class="docutils literal notranslate"><span class="pre">pull-created</span></code>, <code class="docutils literal notranslate"><span class="pre">pull-rejected</span></code>, <code class="docutils literal notranslate"><span class="pre">pull-updated</span></code>, <code class="docutils literal notranslate"><span class="pre">pull-fulfilled</span></code> or <code class="docutils literal notranslate"><span class="pre">ref-deleted</span></code>.</p>
<p>The Bitbucket Server hook may have the following optional parameters:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">codebase</span></code> (default <cite>None</cite>)</dt><dd><p>The codebase value to include with changes or a callable object that will be passed the payload in order to get it.</p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The incoming HTTP requests for this hook are not authenticated by default.
Anyone who can access the web server can âfakeâ a request from Bitbucket Server, potentially causing the buildmaster to run arbitrary code</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This hook requires the <cite>bitbucket-webhooks</cite> plugin (see <a class="reference external" href="https://marketplace.atlassian.com/plugins/nl.topicus.bitbucket.bitbucket-webhooks/server/overview">https://marketplace.atlassian.com/plugins/nl.topicus.bitbucket.bitbucket-webhooks/server/overview</a>).</p>
</div>
</div>
<div class="section" id="poller-hook">
<h2><span class="section-number">2.5.15.7. </span>Poller hook<a class="headerlink" href="#poller-hook" title="Permalink to this headline">Â¶</a></h2>
<p>The poller hook allows you to use GET or POST requests to trigger polling.
One advantage of this is your buildbot instance can poll at launch (using the pollAtLaunch flag) to get changes that happened while it was down, but then you can still use a commit hook to get fast notification of new changes.</p>
<p>Suppose you have a poller configured like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SVNPoller</span><span class="p">(</span>
    <span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;https://amanda.svn.sourceforge.net/svnroot/amanda/amanda&quot;</span><span class="p">,</span>
    <span class="n">split_file</span><span class="o">=</span><span class="n">split_file_branches</span><span class="p">,</span>
    <span class="n">pollInterval</span><span class="o">=</span><span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">pollAtLaunch</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>And you configure your WebStatus to enable this hook:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;poller&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Then you will be able to trigger a poll of the SVN repository by poking the <code class="docutils literal notranslate"><span class="pre">/change_hook/poller</span></code> URL from a commit hook like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -s -F <span class="nv">poller</span><span class="o">=</span>https://amanda.svn.sourceforge.net/svnroot/amanda/amanda <span class="se">\</span>
    http://yourbuildbot/change_hook/poller
</pre></div>
</div>
<p>If no <code class="docutils literal notranslate"><span class="pre">poller</span></code> argument is provided then the hook will trigger polling of all polling change sources.</p>
<p>You can restrict which pollers the webhook has access to using the <code class="docutils literal notranslate"><span class="pre">allowed</span></code> option:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="s1">&#39;change_hook_dialects&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;poller&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;allowed&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;https://amanda.svn.sourceforge.net/svnroot/amanda/amanda&#39;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="gitlab-hook">
<h2><span class="section-number">2.5.15.8. </span>GitLab hook<a class="headerlink" href="#gitlab-hook" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;gitlab&#39;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;secret&#39;</span><span class="p">:</span> <span class="s1">&#39;...&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The GitLab hook has the following parameters:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">secret</span></code> (default <cite>None</cite>)</dt><dd><p>Secret token to use to validate payloads.</p>
</dd>
</dl>
<p>When this is setup you should add a <cite>POST</cite> service pointing to <code class="docutils literal notranslate"><span class="pre">/change_hook/gitlab</span></code> relative to the root of the web status.
For example, if the grid URL is <code class="docutils literal notranslate"><span class="pre">http://builds.example.com/bbot/grid</span></code>, then point GitLab to <code class="docutils literal notranslate"><span class="pre">http://builds.example.com/change_hook/gitlab</span></code>.
The project and/or codebase can also be passed in the URL by appending <code class="docutils literal notranslate"><span class="pre">?project=name</span></code> or <code class="docutils literal notranslate"><span class="pre">?codebase=foo</span></code> to the URL.
These parameters will be passed along to the scheduler.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To handle merge requests from forks properly, itâs easiest to use a GitLab source step rather than a Git source step.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Your Git or GitLab step must be configured with a git&#64; repourl, not a https: one, else the change from the webhook will not trigger a build.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>As in the previous case, the incoming HTTP requests for this hook are not authenticated by default.
Anyone who can access the web status can âfakeâ a request from your GitLab server, potentially causing the buildmaster to run arbitrary code.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When applicable, you need to permit access to internal/local networks.
See <code class="docutils literal notranslate"><span class="pre">https://docs.gitlab.com/ee/security/webhooks.html</span></code> for details.</p>
</div>
<p>To protect URL against unauthorized access you should either</p>
<blockquote>
<div><ul class="simple">
<li><p>set secret token in the configuration above, then set it in the GitLab service hook declaration, or</p></li>
<li><p>use the <a class="reference internal" href="#change-hooks-auth"><span class="std std-ref">Change Hooks Auth</span></a> option. Then, create a GitLab service hook (see <code class="docutils literal notranslate"><span class="pre">https://your.gitlab.server/help/web_hooks</span></code>) with a WebHook URL like <code class="docutils literal notranslate"><span class="pre">https://user:password&#64;builds.example.com/bbot/change_hook/gitlab</span></code>.</p></li>
</ul>
</div></blockquote>
<p>Note that as before, not using <code class="docutils literal notranslate"><span class="pre">change_hook_auth</span></code> can expose you to security risks.</p>
</div>
<div class="section" id="gitorious-hook">
<h2><span class="section-number">2.5.15.9. </span>Gitorious Hook<a class="headerlink" href="#gitorious-hook" title="Permalink to this headline">Â¶</a></h2>
<p>The Gitorious hook is as simple as GitHub one and it also takes no options.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gitorious&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>When this is setup you should add a <cite>POST</cite> service pointing to <code class="docutils literal notranslate"><span class="pre">/change_hook/gitorious</span></code> relative to the root of the web status.
For example, it the grid URL is <code class="docutils literal notranslate"><span class="pre">http://builds.example.com/bbot/grid</span></code>, then point Gitorious to <code class="docutils literal notranslate"><span class="pre">http://builds.example.com/change_hook/gitorious</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>As in the previous case, the incoming HTTP requests for this hook are not authenticated by default.
Anyone who can access the web status can âfakeâ a request from your Gitorious server, potentially causing the buildmaster to run arbitrary code.</p>
</div>
<p>To protect URL against unauthorized access you should use <a class="reference internal" href="#change-hooks-auth"><span class="std std-ref">Change Hooks Auth</span></a> option.
Then, create a Gitorious web hook with a WebHook URL like <code class="docutils literal notranslate"><span class="pre">https://user:password&#64;builds.example.com/bbot/change_hook/gitorious</span></code>.</p>
<p>Note that as before, not using <code class="docutils literal notranslate"><span class="pre">change_hook_auth</span></code> can expose you to security risks.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Web hooks are only available for local Gitorious installations, since this feature is not offered as part of Gitorious.org yet.</p>
</div>
</div>
<div class="section" id="custom-hooks">
<h2><span class="section-number">2.5.15.10. </span>Custom Hooks<a class="headerlink" href="#custom-hooks" title="Permalink to this headline">Â¶</a></h2>
<p>Custom hooks are supported via the <a class="reference internal" href="../plugins.html#plugins"><span class="std std-ref">Plugin Infrastructure in Buildbot</span></a> mechanism.
You can subclass any of the available hook handler class available in <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.www.hooks</span></code> and register it in the plugin system, via a custom python module.
For convenience, you ca also use the generic option <code class="docutils literal notranslate"><span class="pre">custom_class</span></code> e.g:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">webhooks</span>
<span class="k">class</span> <span class="nc">CustomBase</span><span class="p">(</span><span class="n">webhooks</span><span class="o">.</span><span class="n">base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getChanges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span>
        <span class="n">chdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                      <span class="n">revision</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;revision&#39;</span><span class="p">),</span>
                      <span class="n">repository</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;repository&#39;</span><span class="p">),</span>
                      <span class="n">project</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;project&#39;</span><span class="p">),</span>
                      <span class="n">codebase</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;codebase&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">([</span><span class="n">chdict</span><span class="p">],</span> <span class="bp">None</span><span class="p">)</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;base&#39;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;custom_class&#39;</span><span class="p">:</span> <span class="n">CustomBase</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="services.html" class="btn btn-neutral float-right" title="2.5.16. Custom Services" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="www.html" class="btn btn-neutral float-left" title="2.5.14. Web Server" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, junpengxu

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>