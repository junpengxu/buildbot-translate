

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.5.11. Build Steps &mdash; buildbot-translate 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.5.12. Interlocks" href="interlocks.html" />
    <link rel="prev" title="2.5.10. Properties" href="properties.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> buildbot-translate
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">1. Buildbot Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">2. Buildbot Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">2.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.html">2.2. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts.html">2.3. Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../secretsmanagement.html">2.4. Secret Management</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">2.5. Configuration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="intro.html">2.5.1. Configuring Buildbot</a></li>
<li class="toctree-l3"><a class="reference internal" href="global.html">2.5.2. Global Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="changesources.html">2.5.3. Change Sources and Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="changesources.html#changes">2.5.4. Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="schedulers.html">2.5.5. Schedulers</a></li>
<li class="toctree-l3"><a class="reference internal" href="workers.html">2.5.6. Workers</a></li>
<li class="toctree-l3"><a class="reference internal" href="builders.html">2.5.7. Builder Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildfactories.html">2.5.8. Build Factories</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildsets.html">2.5.9. Build Sets</a></li>
<li class="toctree-l3"><a class="reference internal" href="properties.html">2.5.10. Properties</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.5.11. Build Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#common-parameters">2.5.11.1. Common Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-buildbot.steps.source">2.5.11.2. Source Checkout</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-source-operations">2.5.11.3. Other Source operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#shellcommand">2.5.11.4. ShellCommand</a></li>
<li class="toctree-l4"><a class="reference internal" href="#worker-filesystem-steps">2.5.11.5. Worker Filesystem Steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#python-buildsteps">2.5.11.6. Python BuildSteps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#transferring-files">2.5.11.7. Transferring Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#transferring-strings">2.5.11.8. Transferring Strings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-commands-on-the-master">2.5.11.9. Running Commands on the Master</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-properties">2.5.11.10. Setting Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#triggering-schedulers">2.5.11.11. Triggering Schedulers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rpm-related-steps">2.5.11.12. RPM-Related Steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debian-build-steps">2.5.11.13. Debian Build Steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#miscellaneous-buildsteps">2.5.11.14. Miscellaneous BuildSteps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="interlocks.html">2.5.12. Interlocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="reporters.html">2.5.13. Reporters</a></li>
<li class="toctree-l3"><a class="reference internal" href="www.html">2.5.14. Web Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="wwwhooks.html">2.5.15. Change Hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="services.html">2.5.16. Custom Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="dbconfig.html">2.5.17. DbConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="configurators.html">2.5.18. Configurators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../customization.html">2.6. Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmdline.html">2.7. Command-line Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resources.html">2.8. Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization.html">2.9. Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins.html">2.10. Plugin Infrastructure in Buildbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy.html">2.11. Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrading/index.html">2.12. Upgrading</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">buildbot-translate</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html"><span class="section-number">2. </span>Buildbot Manual</a> &raquo;</li>
        
          <li><a href="index.html"><span class="section-number">2.5. </span>Configuration</a> &raquo;</li>
        
      <li><span class="section-number">2.5.11. </span>Build Steps</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/manual/configuration/buildsteps.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="build-steps">
<span id="id1"></span><h1><span class="section-number">2.5.11. </span>Build Steps<a class="headerlink" href="#build-steps" title="Permalink to this headline">¶</a></h1>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>s are usually specified in the buildmaster’s configuration file, in a list that goes into the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildFactory</span></code>.
The <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> instances in this list are used as templates to construct new independent copies for each build (so that state can be kept on the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> in one build without affecting a later build).
Each <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildFactory</span></code> can be created with a list of steps, or the factory can be created empty and then steps added to it using the <code class="xref py py-meth docutils literal notranslate"><span class="pre">addStep()</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span><span class="p">,</span> <span class="n">steps</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addSteps</span><span class="p">([</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">SVN</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;http://svn.example.org/Trunk/&quot;</span><span class="p">),</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">]),</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">])</span>
<span class="p">])</span>
</pre></div>
</div>
<p>The basic behavior for a <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> is to:</p>
<ul class="simple">
<li><p>run for a while, then stop</p></li>
<li><p>possibly invoke some RemoteCommands on the attached worker</p></li>
<li><p>possibly produce a set of log files</p></li>
<li><p>finish with a status described by one of four values defined in <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.status.builder</span></code>: <code class="docutils literal notranslate"><span class="pre">SUCCESS</span></code>, <code class="docutils literal notranslate"><span class="pre">WARNINGS</span></code>, <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code>, <code class="docutils literal notranslate"><span class="pre">SKIPPED</span></code></p></li>
<li><p>provide a list of short strings to describe the step</p></li>
</ul>
<p>The rest of this section describes all the standard <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> objects available for use in a <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>, and the parameters which can be used to control each.
A full list of build steps is available in the <a href="#id2"><span class="problematic" id="id3">:bb:index:`step`</span></a>.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#common-parameters" id="id228">Common Parameters</a></p></li>
<li><p><a class="reference internal" href="#module-buildbot.steps.source" id="id229">Source Checkout</a></p>
<ul>
<li><p><a class="reference internal" href="#common-parameters-of-source-checkout-operations" id="id230">Common Parameters of source checkout operations</a></p></li>
<li><p><a class="reference internal" href="#mercurial" id="id231">Mercurial</a></p></li>
<li><p><a class="reference internal" href="#git" id="id232">Git</a></p></li>
<li><p><a class="reference internal" href="#svn" id="id233">SVN</a></p></li>
<li><p><a class="reference internal" href="#cvs" id="id234">CVS</a></p></li>
<li><p><a class="reference internal" href="#bzr" id="id235">Bzr</a></p></li>
<li><p><a class="reference internal" href="#p4" id="id236">P4</a></p></li>
<li><p><a class="reference internal" href="#repo" id="id237">Repo</a></p></li>
<li><p><a class="reference internal" href="#gerrit" id="id238">Gerrit</a></p></li>
<li><p><a class="reference internal" href="#github" id="id239">GitHub</a></p></li>
<li><p><a class="reference internal" href="#gitlab" id="id240">GitLab</a></p></li>
<li><p><a class="reference internal" href="#darcs" id="id241">Darcs</a></p></li>
<li><p><a class="reference internal" href="#monotone" id="id242">Monotone</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#other-source-operations" id="id243">Other Source operations</a></p>
<ul>
<li><p><a class="reference internal" href="#gitcommit" id="id244">GitCommit</a></p></li>
<li><p><a class="reference internal" href="#gitpush" id="id245">GitPush</a></p></li>
<li><p><a class="reference internal" href="#gittag" id="id246">GitTag</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#shellcommand" id="id247">ShellCommand</a></p>
<ul>
<li><p><a class="reference internal" href="#using-shellcommands" id="id248">Using ShellCommands</a></p></li>
<li><p><a class="reference internal" href="#shell-sequence" id="id249">Shell Sequence</a></p></li>
<li><p><a class="reference internal" href="#configure" id="id250">Configure</a></p></li>
<li><p><a class="reference internal" href="#cmake" id="id251">CMake</a></p></li>
<li><p><a class="reference internal" href="#compile" id="id252">Compile</a></p></li>
<li><p><a class="reference internal" href="#visual-c" id="id253">Visual C++</a></p></li>
<li><p><a class="reference internal" href="#cppcheck" id="id254">Cppcheck</a></p></li>
<li><p><a class="reference internal" href="#robocopy" id="id255">Robocopy</a></p></li>
<li><p><a class="reference internal" href="#test" id="id256">Test</a></p></li>
<li><p><a class="reference internal" href="#treesize" id="id257">TreeSize</a></p></li>
<li><p><a class="reference internal" href="#perlmoduletest" id="id258">PerlModuleTest</a></p></li>
<li><p><a class="reference internal" href="#mtr-mysql-test-run" id="id259">MTR (mysql-test-run)</a></p></li>
<li><p><a class="reference internal" href="#subunitshellcommand" id="id260">SubunitShellCommand</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#worker-filesystem-steps" id="id261">Worker Filesystem Steps</a></p>
<ul>
<li><p><a class="reference internal" href="#fileexists" id="id262">FileExists</a></p></li>
<li><p><a class="reference internal" href="#copydirectory" id="id263">CopyDirectory</a></p></li>
<li><p><a class="reference internal" href="#removedirectory" id="id264">RemoveDirectory</a></p></li>
<li><p><a class="reference internal" href="#makedirectory" id="id265">MakeDirectory</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#python-buildsteps" id="id266">Python BuildSteps</a></p>
<ul>
<li><p><a class="reference internal" href="#buildepydoc" id="id267">BuildEPYDoc</a></p></li>
<li><p><a class="reference internal" href="#pyflakes" id="id268">PyFlakes</a></p></li>
<li><p><a class="reference internal" href="#sphinx" id="id269">Sphinx</a></p></li>
<li><p><a class="reference internal" href="#pylint" id="id270">PyLint</a></p></li>
<li><p><a class="reference internal" href="#trial" id="id271">Trial</a></p></li>
<li><p><a class="reference internal" href="#removepycs" id="id272">RemovePYCs</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#transferring-files" id="id273">Transferring Files</a></p>
<ul>
<li><p><a class="reference internal" href="#other-parameters" id="id274">Other Parameters</a></p></li>
<li><p><a class="reference internal" href="#transferring-directories" id="id275">Transferring Directories</a></p></li>
<li><p><a class="reference internal" href="#transferring-multiple-files-at-once" id="id276">Transferring Multiple Files At Once</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#transferring-strings" id="id277">Transferring Strings</a></p></li>
<li><p><a class="reference internal" href="#running-commands-on-the-master" id="id278">Running Commands on the Master</a></p>
<ul>
<li><p><a class="reference internal" href="#logrenderable" id="id279">LogRenderable</a></p></li>
<li><p><a class="reference internal" href="#assert" id="id280">Assert</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#setting-properties" id="id281">Setting Properties</a></p>
<ul>
<li><p><a class="reference internal" href="#setproperty" id="id282">SetProperty</a></p></li>
<li><p><a class="reference internal" href="#setproperties-step" id="id283"><code class="xref py py-class docutils literal notranslate"><span class="pre">SetProperties</span></code> step</a></p></li>
<li><p><a class="reference internal" href="#setpropertyfromcommand" id="id284">SetPropertyFromCommand</a></p></li>
<li><p><a class="reference internal" href="#setpropertiesfromenv" id="id285">SetPropertiesFromEnv</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#triggering-schedulers" id="id286">Triggering Schedulers</a></p>
<ul>
<li><p><a class="reference internal" href="#dynamic-trigger" id="id287">Dynamic Trigger</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#rpm-related-steps" id="id288">RPM-Related Steps</a></p>
<ul>
<li><p><a class="reference internal" href="#rpmbuild" id="id289">RpmBuild</a></p></li>
<li><p><a class="reference internal" href="#rpmlint" id="id290">RpmLint</a></p></li>
<li><p><a class="reference internal" href="#mock-steps" id="id291">Mock Steps</a></p></li>
<li><p><a class="reference internal" href="#mockbuildsrpm-step" id="id292">MockBuildSRPM Step</a></p></li>
<li><p><a class="reference internal" href="#mockrebuild-step" id="id293">MockRebuild Step</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#debian-build-steps" id="id294">Debian Build Steps</a></p>
<ul>
<li><p><a class="reference internal" href="#debpbuilder" id="id295">DebPbuilder</a></p></li>
<li><p><a class="reference internal" href="#debcowbuilder" id="id296">DebCowbuilder</a></p></li>
<li><p><a class="reference internal" href="#deblintian" id="id297">DebLintian</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#miscellaneous-buildsteps" id="id298">Miscellaneous BuildSteps</a></p>
<ul>
<li><p><a class="reference internal" href="#hlint" id="id299">HLint</a></p></li>
<li><p><a class="reference internal" href="#maxq" id="id300">MaxQ</a></p></li>
<li><p><a class="reference internal" href="#http-requests" id="id301">HTTP Requests</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="common-parameters">
<span id="buildstep-common-parameters"></span><span id="index-0"></span><h2><a class="toc-backref" href="#id228"><span class="section-number">2.5.11.1. </span>Common Parameters</a><a class="headerlink" href="#common-parameters" title="Permalink to this headline">¶</a></h2>
<p>All <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>s accept some common parameters.
Some of these control how their individual status affects the overall build.
Others are used to specify which <cite>Locks</cite> (see <a class="reference internal" href="interlocks.html#interlocks"><span class="std std-ref">Interlocks</span></a>) should be acquired before allowing the step to run.</p>
<p>Arguments common to all <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> subclasses:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>the name used to describe the step on the status display.
Since 0.9.8, this argument might be renderable.</p>
</dd>
</dl>
<dl class="simple" id="index-1">
<dt><code class="docutils literal notranslate"><span class="pre">haltOnFailure</span></code></dt><dd><p>if <code class="docutils literal notranslate"><span class="pre">True</span></code>, a <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code> of this build step will cause the build to halt immediately.
Steps with <code class="docutils literal notranslate"><span class="pre">alwaysRun=True</span></code> are still run.
Generally speaking, <code class="docutils literal notranslate"><span class="pre">haltOnFailure</span></code> implies <code class="docutils literal notranslate"><span class="pre">flunkOnFailure</span></code> (the default for most <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>s).
In some cases, particularly series of tests, it makes sense to <code class="docutils literal notranslate"><span class="pre">haltOnFailure</span></code> if something fails early on but not <code class="docutils literal notranslate"><span class="pre">flunkOnFailure</span></code>.
This can be achieved with <code class="docutils literal notranslate"><span class="pre">haltOnFailure=True</span></code>, <code class="docutils literal notranslate"><span class="pre">flunkOnFailure=False</span></code>.</p>
</dd>
</dl>
<dl class="simple" id="index-2">
<dt><code class="docutils literal notranslate"><span class="pre">flunkOnWarnings</span></code></dt><dd><p>when <code class="docutils literal notranslate"><span class="pre">True</span></code>, a <code class="docutils literal notranslate"><span class="pre">WARNINGS</span></code> or <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code> of this build step will mark the overall build as <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code>.
The remaining steps will still be executed.</p>
</dd>
</dl>
<dl class="simple" id="index-3">
<dt><code class="docutils literal notranslate"><span class="pre">flunkOnFailure</span></code></dt><dd><p>when <code class="docutils literal notranslate"><span class="pre">True</span></code>, a <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code> of this build step will mark the overall build as a <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code>.
The remaining steps will still be executed.</p>
</dd>
</dl>
<dl class="simple" id="index-4">
<dt><code class="docutils literal notranslate"><span class="pre">warnOnWarnings</span></code></dt><dd><p>when <code class="docutils literal notranslate"><span class="pre">True</span></code>, a <code class="docutils literal notranslate"><span class="pre">WARNINGS</span></code> or <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code> of this build step will mark the overall build as having <code class="docutils literal notranslate"><span class="pre">WARNINGS</span></code>.
The remaining steps will still be executed.</p>
</dd>
</dl>
<dl class="simple" id="index-5">
<dt><code class="docutils literal notranslate"><span class="pre">warnOnFailure</span></code></dt><dd><p>when <code class="docutils literal notranslate"><span class="pre">True</span></code>, a <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code> of this build step will mark the overall build as having <code class="docutils literal notranslate"><span class="pre">WARNINGS</span></code>.
The remaining steps will still be executed.</p>
</dd>
</dl>
<dl class="simple" id="index-6">
<dt><code class="docutils literal notranslate"><span class="pre">alwaysRun</span></code></dt><dd><p>if <code class="docutils literal notranslate"><span class="pre">True</span></code>, this build step will always be run, even if a previous buildstep with <code class="docutils literal notranslate"><span class="pre">haltOnFailure=True</span></code> has failed.</p>
</dd>
</dl>
<dl class="simple" id="index-7">
<dt><code class="docutils literal notranslate"><span class="pre">description</span></code></dt><dd><p>This will be used to describe the command (on the Waterfall display) while the command is still running.
It should be a single imperfect-tense verb, like <cite>compiling</cite> or <cite>testing</cite>.
The preferred form is a single, short string, but for historical reasons a list of strings is also acceptable.</p>
</dd>
</dl>
<dl id="index-8">
<dt><code class="docutils literal notranslate"><span class="pre">descriptionDone</span></code></dt><dd><p>This will be used to describe the command once it has finished.
A simple noun like <cite>compile</cite> or <cite>tests</cite> should be used.
Like <code class="docutils literal notranslate"><span class="pre">description</span></code>, this may either be a string or a list of short strings.</p>
<p>If neither <code class="docutils literal notranslate"><span class="pre">description</span></code> nor <code class="docutils literal notranslate"><span class="pre">descriptionDone</span></code> are set, the actual command arguments will be used to construct the description.
This may be a bit too wide to fit comfortably on the Waterfall display.</p>
<p>All subclasses of <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> will contain the description attributes.
Consequently, you could add a <a href="#id4"><span class="problematic" id="id5">:bb:step:`ShellCommand`</span></a> step like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
                             <span class="n">description</span><span class="o">=</span><span class="s2">&quot;testing&quot;</span><span class="p">,</span>
                             <span class="n">descriptionDone</span><span class="o">=</span><span class="s2">&quot;tests&quot;</span><span class="p">))</span>
</pre></div>
</div>
</dd>
</dl>
<dl id="index-9">
<dt><code class="docutils literal notranslate"><span class="pre">descriptionSuffix</span></code></dt><dd><p>This is an optional suffix appended to the end of the description (ie, after <code class="docutils literal notranslate"><span class="pre">description</span></code> and <code class="docutils literal notranslate"><span class="pre">descriptionDone</span></code>).
This can be used to distinguish between build steps that would display the same descriptions in the waterfall.
This parameter may be a string, a list of short strings or <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>For example, a builder might use the <a href="#id6"><span class="problematic" id="id7">:bb:step:`Compile`</span></a> step to build two different codebases.
The <code class="docutils literal notranslate"><span class="pre">descriptionSuffix</span></code> could be set to <cite>projectFoo</cite> and <cite>projectBar</cite>, respectively for each step, which will result in the full descriptions <cite>compiling projectFoo</cite> and <cite>compiling projectBar</cite> to be shown in the waterfall.</p>
</dd>
</dl>
<dl class="simple" id="index-10">
<dt><code class="docutils literal notranslate"><span class="pre">doStepIf</span></code></dt><dd><p>A step can be configured to only run under certain conditions.
To do this, set the step’s <code class="docutils literal notranslate"><span class="pre">doStepIf</span></code> to a boolean value, or to a function that returns a boolean value or Deferred.
If the value or function result is false, then the step will return <code class="docutils literal notranslate"><span class="pre">SKIPPED</span></code> without doing anything.
Otherwise, the step will be executed normally.
If you set <code class="docutils literal notranslate"><span class="pre">doStepIf</span></code> to a function, that function should accept one parameter, which will be the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> object itself.</p>
</dd>
</dl>
<dl id="index-11">
<dt><code class="docutils literal notranslate"><span class="pre">hideStepIf</span></code></dt><dd><p>A step can be optionally hidden from the waterfall and build details web pages.
To do this, set the step’s <code class="docutils literal notranslate"><span class="pre">hideStepIf</span></code> to a boolean value, or to a function that takes two parameters – the results and the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> – and returns a boolean value.
Steps are always shown while they execute, however after the step has finished, this parameter is evaluated (if a function) and if the value is True, the step is hidden.
For example, in order to hide the step if the step has been skipped:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Foo</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">hideStepIf</span><span class="o">=</span><span class="k">lambda</span> <span class="n">results</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="n">results</span><span class="o">==</span><span class="n">SKIPPED</span><span class="p">))</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="simple" id="index-12">
<dt><code class="docutils literal notranslate"><span class="pre">locks</span></code></dt><dd><p>a list of <code class="docutils literal notranslate"><span class="pre">Locks</span></code> (instances of <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.locks.WorkerLock</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.locks.MasterLock</span></code>) that should be acquired before starting this <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>.
Alternatively this could be a renderable that returns this list during build execution.
This lets you defer picking the locks to acquire until the build step is about to start running.
The <code class="docutils literal notranslate"><span class="pre">Locks</span></code> will be released when the step is complete.
Note that this is a list of actual <code class="xref py py-class docutils literal notranslate"><span class="pre">Lock</span></code> instances, not names.
Also note that all Locks must have unique names.
See <a class="reference internal" href="interlocks.html#interlocks"><span class="std std-ref">Interlocks</span></a>.</p>
</dd>
</dl>
<dl class="simple" id="index-13">
<dt><code class="docutils literal notranslate"><span class="pre">logEncoding</span></code></dt><dd><p>The character encoding to use to decode logs produced during the execution of this step.
This overrides the default <a href="#id8"><span class="problematic" id="id9">:bb:cfg:`logEncoding`</span></a>; see <a class="reference internal" href="global.html#log-encodings"><span class="std std-ref">Log Handling</span></a>.</p>
</dd>
</dl>
<dl id="index-14">
<dt><code class="docutils literal notranslate"><span class="pre">updateBuildSummaryPolicy</span></code></dt><dd><p>The policy to use to propagate the step summary to the build summary.
If False, the build summary will never include step summary
If True, the build summary will always include step summary
If set to a list (e.g. <code class="docutils literal notranslate"><span class="pre">[FAILURE,</span> <span class="pre">EXCEPTION]</span></code>), it will propagate if the step results id is present in that list.
If not set or None, the default is computed according to other BuildStep parameters using following algorithm:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">updateBuildSummaryPolicy</span> <span class="o">=</span> <span class="p">[</span><span class="n">EXCEPTION</span><span class="p">,</span> <span class="n">RETRY</span><span class="p">,</span> <span class="n">CANCELLED</span><span class="p">]</span>
<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flunkOnFailure</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">haltOnFailure</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">warnOnFailure</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">updateBuildSummaryPolicy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FAILURE</span><span class="p">)</span>
<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warnOnWarnings</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">flunkOnWarnings</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">updateBuildSummaryPolicy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WARNINGS</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that in a custom step, if <code class="xref py py-meth docutils literal notranslate"><span class="pre">BuildStep.getResultSummary()</span></code> is overridden and setting the <code class="docutils literal notranslate"><span class="pre">build</span></code> summary, <code class="docutils literal notranslate"><span class="pre">updateBuildSummaryPolicy</span></code> is ignored and <code class="docutils literal notranslate"><span class="pre">build</span></code> summary will be used regardless.</p>
</dd>
</dl>
</div>
<div class="section" id="module-buildbot.steps.source">
<span id="id10"></span><span id="source-checkout"></span><h2><a class="toc-backref" href="#id229"><span class="section-number">2.5.11.2. </span>Source Checkout</a><a class="headerlink" href="#module-buildbot.steps.source" title="Permalink to this headline">¶</a></h2>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Support for the old worker-side source checkout steps was removed in Buildbot-0.9.0.</p>
<p>The old source steps used to be imported like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.steps.source.oldsource</span> <span class="kn">import</span> <span class="n">Git</span>

<span class="o">...</span> <span class="n">Git</span> <span class="o">...</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.steps.source</span> <span class="kn">import</span> <span class="n">Git</span>
</pre></div>
</div>
<p>while new source steps are in separate Python modules for each version-control system and, using the plugin infrastructure are available as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="o">...</span> <span class="n">steps</span><span class="o">.</span><span class="n">Git</span> <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="common-parameters-of-source-checkout-operations">
<h3><a class="toc-backref" href="#id230">Common Parameters of source checkout operations</a><a class="headerlink" href="#common-parameters-of-source-checkout-operations" title="Permalink to this headline">¶</a></h3>
<p>All source checkout steps accept some common parameters to control how they get the sources and where they should be placed.
The remaining per-VC-system parameters are mostly to specify where exactly the sources are coming from.</p>
<p><code class="docutils literal notranslate"><span class="pre">mode</span></code>
<code class="docutils literal notranslate"><span class="pre">method</span></code></p>
<blockquote>
<div><p>These two parameters specify the means by which the source is checked out.
<code class="docutils literal notranslate"><span class="pre">mode</span></code> specifies the type of checkout and <code class="docutils literal notranslate"><span class="pre">method</span></code> tells about the way to implement it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">factory</span> <span class="o">=</span> <span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Mercurial</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;path/to/repo&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span>
                                <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fresh&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">mode</span></code> parameter a string describing the kind of VC operation that is desired, defaulting to <code class="docutils literal notranslate"><span class="pre">incremental</span></code>.
The options are</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">incremental</span></code></dt><dd><p>Update the source to the desired revision, but do not remove any other files generated by previous builds.
This allows compilers to take advantage of object files from previous builds.
This mode is exactly same as the old <code class="docutils literal notranslate"><span class="pre">update</span></code> mode.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">full</span></code></dt><dd><p>Update the source, but delete remnants of previous builds.
Build steps that follow will need to regenerate all object files.</p>
</dd>
</dl>
<p>Methods are specific to the version-control system in question, as they may take advantage of special behaviors in that version-control system that can make checkouts more efficient or reliable.</p>
</div></blockquote>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">workdir</span></code></dt><dd><p>like all Steps, this indicates the directory where the build will take place.
Source Steps are special in that they perform some operations outside of the workdir (like creating the workdir itself).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code></dt><dd><p>if True, bypass the usual behavior of checking out the revision in the source stamp, and always update to the latest revision in the repository instead.
If the specific VC system supports branches and a specific branch is specified in the step parameters via <code class="docutils literal notranslate"><span class="pre">branch</span></code> or <code class="docutils literal notranslate"><span class="pre">defaultBranch</span></code> parameters then the latest revision on that branch is checked out.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">retry</span></code></dt><dd><p>If set, this specifies a tuple of <code class="docutils literal notranslate"><span class="pre">(delay,</span> <span class="pre">repeats)</span></code> which means that when a full VC checkout fails, it should be retried up to <code class="docutils literal notranslate"><span class="pre">repeats</span></code> times, waiting <code class="docutils literal notranslate"><span class="pre">delay</span></code> seconds between attempts.
If you don’t provide this, it defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>, which means VC operations should not be retried.
This is provided to make life easier for workers which are stuck behind poor network connections.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">repository</span></code></dt><dd><p>The name of this parameter might vary depending on the Source step you are running.
The concept explained here is common to all steps and applies to <code class="docutils literal notranslate"><span class="pre">repourl</span></code> as well as for <code class="docutils literal notranslate"><span class="pre">baseURL</span></code> (when applicable).</p>
<p>A common idiom is to pass <code class="docutils literal notranslate"><span class="pre">Property('repository',</span> <span class="pre">'url://default/repo/path')</span></code> as repository.
This grabs the repository from the source stamp of the build.
This can be a security issue, if you allow force builds from the web, or have the <code class="xref py py-class docutils literal notranslate"><span class="pre">WebStatus</span></code> change hooks enabled; as the worker will download code from an arbitrary repository.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">codebase</span></code></dt><dd><p>This specifies which codebase the source step should use to select the right source stamp.
The default codebase value is <code class="docutils literal notranslate"><span class="pre">''</span></code>.
The codebase must correspond to a codebase assigned by the <a href="#id11"><span class="problematic" id="id12">:bb:cfg:`codebaseGenerator`</span></a>.
If there is no codebaseGenerator defined in the master then codebase doesn’t need to be set, the default value will then match all changes.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">timeout</span></code></dt><dd><p>Specifies the timeout for worker-side operations, in seconds.
If your repositories are particularly large, then you may need to increase this  value from its default of 1200 (20 minutes).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">logEnviron</span></code></dt><dd><p>If this option is true (the default), then the step’s logfile will describe the environment variables on the worker.
In situations where the environment is not relevant and is long, it may be easier to set <code class="docutils literal notranslate"><span class="pre">logEnviron=False</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">env</span></code></dt><dd><p>a dictionary of environment strings which will be added to the child command’s environment.
The usual property interpolations can be used in environment variable names and values - see <a class="reference internal" href="properties.html#properties"><span class="std std-ref">Properties</span></a>.</p>
</dd>
</dl>
</div>
<div class="section" id="mercurial">
<span id="step-mercurial"></span><h3><a class="toc-backref" href="#id231">Mercurial</a><a class="headerlink" href="#mercurial" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.mercurial.Mercurial">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.source.mercurial.</code><code class="sig-name descname">Mercurial</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.mercurial.Mercurial" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a href="#id13"><span class="problematic" id="id14">:bb:step:`Mercurial`</span></a> build step performs a <a class="reference external" href="https://www.mercurial-scm.org/">Mercurial</a> (aka <code class="docutils literal notranslate"><span class="pre">hg</span></code>) checkout or update.</p>
<p>Branches are available in two modes: <code class="docutils literal notranslate"><span class="pre">dirname</span></code>, where the name of the branch is a suffix of the name of the repository, or <code class="docutils literal notranslate"><span class="pre">inrepo</span></code>, which uses Hg’s named-branches support.
Make sure this setting matches your changehook, if you have that installed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Mercurial</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;path/to/repo&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span>
                                <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fresh&#39;</span><span class="p">,</span> <span class="n">branchType</span><span class="o">=</span><span class="s1">&#39;inrepo&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The Mercurial step takes the following arguments:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">repourl</span></code></dt><dd><p>where the Mercurial source repository is available.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">defaultBranch</span></code></dt><dd><p>this specifies the name of the branch to use when a Build does not provide one of its own.
This will be appended to <code class="docutils literal notranslate"><span class="pre">repourl</span></code> to create the string that will be passed to the <code class="docutils literal notranslate"><span class="pre">hg</span> <span class="pre">clone</span></code> command.
If <code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> then the branch and revision information that comes with the Build is ignored and branch specified in this parameter is used.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branchType</span></code></dt><dd><p>either ‘dirname’ (default) or ‘inrepo’ depending on whether the branch name should be appended to the <code class="docutils literal notranslate"><span class="pre">repourl</span></code> or the branch is a Mercurial named branch and can be found within the <code class="docutils literal notranslate"><span class="pre">repourl</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clobberOnBranchChange</span></code></dt><dd><p>boolean, defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>.
If set and using inrepos branches, clobber the tree at each branch change.
Otherwise, just update to the branch.</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">mode</span></code>
<code class="docutils literal notranslate"><span class="pre">method</span></code></p>
<blockquote>
<div><p>Mercurial’s incremental mode does not require a method.
The full mode has three methods defined:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">clobber</span></code></dt><dd><p>It removes the build directory entirely then makes full clone from repo.
This can be slow as it need to clone whole repository</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fresh</span></code></dt><dd><p>This remove all other files except those tracked by VCS.
First it does <strong class="command">hg purge --all</strong> then pull/update</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clean</span></code></dt><dd><p>All the files which are tracked by Mercurial and listed ignore files are not deleted.
Remaining all other files will be deleted before pull/update.
This is equivalent to <strong class="command">hg purge</strong> then pull/update.</p>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="git">
<span id="step-git"></span><h3><a class="toc-backref" href="#id232">Git</a><a class="headerlink" href="#git" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.git.Git">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.source.git.</code><code class="sig-name descname">Git</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.git.Git" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a href="#id16"><span class="problematic" id="id17">:bb:step:`Git`</span></a> build step clones or updates a <a class="reference external" href="http://git.or.cz/">Git</a> repository and checks out the specified branch or revision.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Buildbot supports Git version 1.2.0 and later: earlier versions (such as the one shipped in Ubuntu ‘Dapper’) do not support the <strong class="command">git init</strong> command that the Buildbot uses.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Git</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;git://path/to/repo&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span>
                          <span class="n">method</span><span class="o">=</span><span class="s1">&#39;clobber&#39;</span><span class="p">,</span> <span class="n">submodules</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
</pre></div>
</div>
<p>The Git step takes the following arguments:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">repourl</span></code> (required)</dt><dd><p>The URL of the upstream Git repository.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branch</span></code> (optional)</dt><dd><p>This specifies the name of the branch or the tag to use when a Build does not provide one of its own.
If this parameter is not specified, and the Build does not provide a branch, the default branch of the remote repository will be used.
If <code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> then the branch and revision information that comes with the Build is ignored and branch specified in this parameter is used.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">submodules</span></code> (optional, default: <code class="docutils literal notranslate"><span class="pre">False</span></code>)</dt><dd><p>When initializing/updating a Git repository, this tells Buildbot whether to handle Git submodules.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">shallow</span></code> (optional)</dt><dd><p>Instructs Git to attempt shallow clones (<code class="docutils literal notranslate"><span class="pre">--depth</span> <span class="pre">1</span></code>).
The depth defaults to 1 and can be changed by passing an integer instead of <code class="docutils literal notranslate"><span class="pre">True</span></code>.
This option can be used only in full builds with clobber method.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reference</span></code> (optional)</dt><dd><p>Use the specified string as a path to a reference repository on the local machine.
Git will try to grab objects from this path first instead of the main repository, if they exist.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">origin</span></code> (optional)</dt><dd><p>By default, any clone will use the name “origin” as the remote repository (eg, “origin/master”).
This renderable option allows that to be configured to an alternate name.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">progress</span></code> (optional)</dt><dd><p>Passes the (<code class="docutils literal notranslate"><span class="pre">--progress</span></code>) flag to (<strong class="command">git fetch</strong>).
This solves issues of long fetches being killed due to lack of output, but requires Git 1.7.2 or later.
Its value is True on Git 1.7.2 or later.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">retryFetch</span></code> (optional, default: <code class="docutils literal notranslate"><span class="pre">False</span></code>)</dt><dd><p>If true, if the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">fetch</span></code> fails then Buildbot retries to fetch again instead of failing the entire source checkout.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clobberOnFailure</span></code> (optional, default: <code class="docutils literal notranslate"><span class="pre">False</span></code>)</dt><dd><p>If a fetch or full clone fails we can checkout source removing everything.
This way new repository will be cloned.
If retry fails it fails the source checkout step.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mode</span></code> (optional, default: <code class="docutils literal notranslate"><span class="pre">'incremental'</span></code>)</dt><dd><p>Specifies whether to clean the build tree or not.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">incremental</span></code></dt><dd><p>The source is update, but any built files are left untouched.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">full</span></code></dt><dd><p>The build tree is clean of any built files.
The exact method for doing this is controlled by the <code class="docutils literal notranslate"><span class="pre">method</span></code> argument.</p>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">method</span></code> (optional, default: <code class="docutils literal notranslate"><span class="pre">fresh</span></code> when mode is <code class="docutils literal notranslate"><span class="pre">full</span></code>)</dt><dd><p>Git’s incremental mode does not require a method.
The full mode has four methods defined:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">clobber</span></code></dt><dd><p>It removes the build directory entirely then makes full clone from repo.
This can be slow as it need to clone whole repository.
To make faster clones enable <code class="docutils literal notranslate"><span class="pre">shallow</span></code> option.
If shallow options is enabled and build request have unknown revision value, then this step fails.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fresh</span></code></dt><dd><p>This remove all other files except those tracked by Git.
First it does <strong class="command">git clean -d -f -f -x</strong> then fetch/checkout to a specified revision(if any).
This option is equal to update mode with <code class="docutils literal notranslate"><span class="pre">ignore_ignores=True</span></code> in old steps.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clean</span></code></dt><dd><p>All the files which are tracked by Git and listed ignore files are not deleted.
Remaining all other files will be deleted before fetch/checkout.
This is equivalent to <strong class="command">git clean -d -f -f</strong> then fetch.
This is equivalent to <code class="docutils literal notranslate"><span class="pre">ignore_ignores=False</span></code> in old steps.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">copy</span></code></dt><dd><p>This first checkout source into source directory then copy the <code class="docutils literal notranslate"><span class="pre">source</span></code> directory to <code class="docutils literal notranslate"><span class="pre">build</span></code> directory then performs the build operation in the copied directory.
This way we make fresh builds with very less bandwidth to download source.
The behavior of source checkout follows exactly same as incremental.
It performs all the incremental checkout behavior in <code class="docutils literal notranslate"><span class="pre">source</span></code> directory.</p>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">getDescription</span></code> (optional)</dt><dd><p>After checkout, invoke a <cite>git describe</cite> on the revision and save the result in a property; the property’s name is either <code class="docutils literal notranslate"><span class="pre">commit-description</span></code> or <code class="docutils literal notranslate"><span class="pre">commit-description-foo</span></code>, depending on whether the <code class="docutils literal notranslate"><span class="pre">codebase</span></code> argument was also provided.
The argument should either be a <code class="docutils literal notranslate"><span class="pre">bool</span></code> or <code class="docutils literal notranslate"><span class="pre">dict</span></code>, and will change how <cite>git describe</cite> is called:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">getDescription=False</span></code>: disables this feature explicitly</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getDescription=True</span></code> or empty <code class="docutils literal notranslate"><span class="pre">dict()</span></code>: Run <cite>git describe</cite> with no args</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getDescription={...}</span></code>: a dict with keys named the same as the Git option.
Each key’s value can be <code class="docutils literal notranslate"><span class="pre">False</span></code> or <code class="docutils literal notranslate"><span class="pre">None</span></code> to explicitly skip that argument.</p>
<p>For the following keys, a value of <code class="docutils literal notranslate"><span class="pre">True</span></code> appends the same-named Git argument:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">all</span></code> : <cite>–all</cite></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">always</span></code>: <cite>–always</cite></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">contains</span></code>: <cite>–contains</cite></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">debug</span></code>: <cite>–debug</cite></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">long</span></code>: <cite>–long`</cite></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exact-match</span></code>: <cite>–exact-match</cite></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tags</span></code>: <cite>–tags</cite></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dirty</span></code>: <cite>–dirty</cite></p></li>
</ul>
</div></blockquote>
<p>For the following keys, an integer or string value (depending on what Git expects) will set the argument’s parameter appropriately.
Examples show the key-value pair:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">match=foo</span></code>: <cite>–match foo</cite></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">abbrev=7</span></code>: <cite>–abbrev=7</cite></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">candidates=7</span></code>: <cite>–candidates=7</cite></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dirty=foo</span></code>: <cite>–dirty=foo</cite></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">config</span></code> (optional)</dt><dd><p>A dict of Git configuration settings to pass to the remote Git commands.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sshPrivateKey</span></code> (optional)</dt><dd><p>The private key to use when running Git for fetch operations.
The ssh utility must be in the system path in order to use this option.
On Windows only Git distribution that embeds MINGW has been tested (as of July 2017 the official distribution is MINGW-based).
The worker must either have the host in the known hosts file or the host key must be specified via the <cite>sshHostKey</cite> option.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sshHostKey</span></code> (optional)</dt><dd><p>Specifies public host key to match when authenticating with SSH public key authentication.
This may be either a <a class="reference internal" href="../secretsmanagement.html#secret"><span class="std std-ref">Secret</span></a> or just a string.
<cite>sshPrivateKey</cite> must be specified in order to use this option.
The host key must be in the form of <cite>&lt;key type&gt; &lt;base64-encoded string&gt;</cite>, e.g. <cite>ssh-rsa AAAAB3N&lt;…&gt;FAaQ==</cite>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sshKnownHosts</span></code> (optional)</dt><dd><p>Specifies the contents of the SSH known_hosts file to match when authenticating with SSH public key authentication.
This may be either a <a class="reference internal" href="../secretsmanagement.html#secret"><span class="std std-ref">Secret</span></a> or just a string.
<cite>sshPrivateKey</cite> must be specified in order to use this option.
<cite>sshHostKey</cite> must not be specified in order to use this option.</p>
</dd>
</dl>
</div>
<div class="section" id="svn">
<span id="step-svn"></span><h3><a class="toc-backref" href="#id233">SVN</a><a class="headerlink" href="#svn" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.svn.SVN">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.source.svn.</code><code class="sig-name descname">SVN</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.svn.SVN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a href="#id19"><span class="problematic" id="id20">:bb:step:`SVN`</span></a> build step performs a <a class="reference external" href="http://subversion.tigris.org">Subversion</a> checkout or update.
There are two basic ways of setting up the checkout step, depending upon whether you are using multiple branches or not.</p>
<p>The <a href="#id21"><span class="problematic" id="id22">:bb:step:`SVN`</span></a> step should be created with the <code class="docutils literal notranslate"><span class="pre">repourl</span></code> argument:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">repourl</span></code></dt><dd><p>(required): this specifies the <code class="docutils literal notranslate"><span class="pre">URL</span></code> argument that will be given to the <strong class="command">svn checkout</strong> command.
It dictates both where the repository is located and which sub-tree should be extracted.
One way to specify the branch is to use <code class="docutils literal notranslate"><span class="pre">Interpolate</span></code>.
For example, if you wanted to check out the trunk repository, you could use <code class="docutils literal notranslate"><span class="pre">repourl=Interpolate(&quot;http://svn.example.com/repos/%(src::branch)s&quot;)</span></code>.
Alternatively, if you are using a remote Subversion repository which is accessible through HTTP at a URL of <code class="docutils literal notranslate"><span class="pre">http://svn.example.com/repos</span></code>, and you wanted to check out the <code class="docutils literal notranslate"><span class="pre">trunk/calc</span></code> sub-tree, you would directly use <code class="docutils literal notranslate"><span class="pre">repourl=&quot;http://svn.example.com/repos/trunk/calc&quot;</span></code> as an argument to your <a href="#id23"><span class="problematic" id="id24">:bb:step:`SVN`</span></a> step.</p>
</dd>
</dl>
<p>If you are building from multiple branches, then you should create the <a href="#id25"><span class="problematic" id="id26">:bb:step:`SVN`</span></a> step with the <code class="docutils literal notranslate"><span class="pre">repourl</span></code> and provide branch information with <a class="reference internal" href="properties.html#interpolate"><span class="std std-ref">Interpolate</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">SVN</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">,</span>
              <span class="n">repourl</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span>
                  <span class="s1">&#39;svn://svn.example.org/svn/%(src::branch)s/myproject&#39;</span><span class="p">)))</span>
</pre></div>
</div>
<p>Alternatively, the <code class="docutils literal notranslate"><span class="pre">repourl</span></code> argument can be used to create the <a href="#id27"><span class="problematic" id="id28">:bb:step:`SVN`</span></a> step without <a class="reference internal" href="properties.html#interpolate"><span class="std std-ref">Interpolate</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">SVN</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span>
                <span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;svn://svn.example.org/svn/myproject/trunk&#39;</span><span class="p">))</span>
</pre></div>
</div>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">username</span></code></dt><dd><p>(optional): if specified, this will be passed to the <code class="docutils literal notranslate"><span class="pre">svn</span></code> binary with a <code class="docutils literal notranslate"><span class="pre">--username</span></code> option.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">password</span></code></dt><dd><p>(optional): if specified, this will be passed to the <code class="docutils literal notranslate"><span class="pre">svn</span></code> binary with a <code class="docutils literal notranslate"><span class="pre">--password</span></code> option.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">extra_args</span></code></dt><dd><p>(optional): if specified, an array of strings that will be passed as extra arguments to the <code class="docutils literal notranslate"><span class="pre">svn</span></code> binary.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">keep_on_purge</span></code></dt><dd><p>(optional): specific files or directories to keep between purges, like some build outputs that can be reused between builds.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">depth</span></code></dt><dd><p>(optional): Specify depth argument to achieve sparse checkout.
Only available if worker has Subversion 1.5 or higher.</p>
<p>If set to <code class="docutils literal notranslate"><span class="pre">empty</span></code> updates will not pull in any files or subdirectories not already present.
If set to <code class="docutils literal notranslate"><span class="pre">files</span></code>, updates will pull in any files not already present, but not directories.
If set to <code class="docutils literal notranslate"><span class="pre">immediates</span></code>, updates will pull in any files or subdirectories not already present, the new subdirectories will have depth: empty.
If set to <code class="docutils literal notranslate"><span class="pre">infinity</span></code>, updates will pull in any files or subdirectories not already present; the new subdirectories will have depth-infinity.
Infinity is equivalent to SVN default update behavior, without specifying any depth argument.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">preferLastChangedRev</span></code></dt><dd><p>(optional): By default, the <code class="docutils literal notranslate"><span class="pre">got_revision</span></code> property is set to the repository’s global revision (“Revision” in the <cite>svn info</cite> output).
Set this parameter to <code class="docutils literal notranslate"><span class="pre">True</span></code> to have it set to the “Last Changed Rev” instead.</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">mode</span></code>
<code class="docutils literal notranslate"><span class="pre">method</span></code></p>
<blockquote>
<div><p>SVN’s incremental mode does not require a method.
The full mode has five methods defined:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">clobber</span></code></dt><dd><p>It removes the working directory for each build then makes full checkout.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fresh</span></code></dt><dd><p>This always always purges local changes before updating.
This deletes unversioned files and reverts everything that would appear in a <strong class="command">svn status --no-ignore</strong>.
This is equivalent to the old update mode with <code class="docutils literal notranslate"><span class="pre">always_purge</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clean</span></code></dt><dd><p>This is same as fresh except that it deletes all unversioned files generated by <strong class="command">svn status</strong>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">copy</span></code></dt><dd><p>This first checkout source into source directory then copy the <code class="docutils literal notranslate"><span class="pre">source</span></code> directory to <code class="docutils literal notranslate"><span class="pre">build</span></code> directory then performs the build operation in the copied directory.
This way we make fresh builds with very less bandwidth to download source.
The behavior of source checkout follows exactly same as incremental.
It performs all the incremental checkout behavior in <code class="docutils literal notranslate"><span class="pre">source</span></code> directory.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">export</span></code></dt><dd><p>Similar to <code class="docutils literal notranslate"><span class="pre">method='copy'</span></code>, except using <code class="docutils literal notranslate"><span class="pre">svn</span> <span class="pre">export</span></code> to create build directory so that there are no <code class="docutils literal notranslate"><span class="pre">.svn</span></code> directories in the build directory.</p>
</dd>
</dl>
</div></blockquote>
<p>If you are using branches, you must also make sure your <code class="docutils literal notranslate"><span class="pre">ChangeSource</span></code> will report the correct branch names.</p>
</div>
<div class="section" id="cvs">
<span id="step-cvs"></span><h3><a class="toc-backref" href="#id234">CVS</a><a class="headerlink" href="#cvs" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.cvs.CVS">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.source.cvs.</code><code class="sig-name descname">CVS</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.cvs.CVS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a href="#id29"><span class="problematic" id="id30">:bb:step:`CVS`</span></a> build step performs a <a class="reference external" href="http://www.nongnu.org/cvs/">CVS</a> checkout or update.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">CVS</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">,</span>
                <span class="n">cvsroot</span><span class="o">=</span><span class="s1">&#39;:pserver:me@cvs.example.net:/cvsroot/myproj&#39;</span><span class="p">,</span>
                <span class="n">cvsmodule</span><span class="o">=</span><span class="s1">&#39;buildbot&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>This step takes the following arguments:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">cvsroot</span></code></dt><dd><p>(required): specify the CVSROOT value, which points to a CVS repository, probably on a remote machine.
For example, if Buildbot was hosted in CVS then the CVSROOT value you would use to get a copy of the Buildbot source code might be <code class="docutils literal notranslate"><span class="pre">:pserver:anonymous&#64;cvs.example.net:/cvsroot/buildbot</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cvsmodule</span></code></dt><dd><p>(required): specify the cvs <code class="docutils literal notranslate"><span class="pre">module</span></code>, which is generally a subdirectory of the <code class="file docutils literal notranslate"><span class="pre">CVSROOT</span></code>.
The cvsmodule for the Buildbot source code is <code class="docutils literal notranslate"><span class="pre">buildbot</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branch</span></code></dt><dd><p>a string which will be used in a <code class="docutils literal notranslate"><span class="pre">-r</span></code> argument.
This is most useful for specifying a branch to work on.
Defaults to <code class="docutils literal notranslate"><span class="pre">HEAD</span></code>.
If <code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> then the branch and revision information that comes with the Build is ignored and branch specified in this parameter is used.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">global_options</span></code></dt><dd><p>a list of flags to be put before the argument <code class="docutils literal notranslate"><span class="pre">checkout</span></code> in the CVS command.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">extra_options</span></code></dt><dd><p>a list of flags to be put after the <code class="docutils literal notranslate"><span class="pre">checkout</span></code> in the CVS command.</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">mode</span></code>
<code class="docutils literal notranslate"><span class="pre">method</span></code></p>
<blockquote>
<div><p>No method is needed for incremental mode.
For full mode, <code class="docutils literal notranslate"><span class="pre">method</span></code> can take the values shown below.
If no value is given, it defaults to <code class="docutils literal notranslate"><span class="pre">fresh</span></code>.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">clobber</span></code></dt><dd><p>This specifies to remove the <code class="docutils literal notranslate"><span class="pre">workdir</span></code> and make a full checkout.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fresh</span></code></dt><dd><p>This method first runs <code class="docutils literal notranslate"><span class="pre">cvsdisard</span></code> in the build directory, then updates it.
This requires <code class="docutils literal notranslate"><span class="pre">cvsdiscard</span></code> which is a part of the cvsutil package.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clean</span></code></dt><dd><p>This method is the same as <code class="docutils literal notranslate"><span class="pre">method='fresh'</span></code>, but it runs <code class="docutils literal notranslate"><span class="pre">cvsdiscard</span> <span class="pre">--ignore</span></code> instead of <code class="docutils literal notranslate"><span class="pre">cvsdiscard</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">copy</span></code></dt><dd><p>This maintains a <code class="docutils literal notranslate"><span class="pre">source</span></code> directory for source, which it updates copies to the build directory.
This allows Buildbot to start with a fresh directory, without downloading the entire repository on every build.</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">login</span></code></dt><dd><p>Password to use while performing login to the remote CVS server.
Default is <code class="docutils literal notranslate"><span class="pre">None</span></code> meaning that no login needs to be performed.</p>
</dd>
</dl>
</div>
<div class="section" id="bzr">
<span id="step-bzr"></span><h3><a class="toc-backref" href="#id235">Bzr</a><a class="headerlink" href="#bzr" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.bzr.Bzr">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.source.bzr.</code><code class="sig-name descname">Bzr</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.bzr.Bzr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="http://bazaar.canonical.com/en/">bzr</a> is a descendant of Arch/Baz, and is frequently referred to as simply <cite>Bazaar</cite>.
The repository-vs-workspace model is similar to Darcs, but it uses a strictly linear sequence of revisions (one history per branch) like Arch.
Branches are put in subdirectories.
This makes it look very much like Mercurial.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Bzr</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">,</span>
                          <span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;lp:~knielsen/maria/tmp-buildbot-test&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The step takes the following arguments:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">repourl</span></code></dt><dd><p>(required unless <code class="docutils literal notranslate"><span class="pre">baseURL</span></code> is provided): the URL at which the Bzr source repository is available.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseURL</span></code></dt><dd><p>(required unless <code class="docutils literal notranslate"><span class="pre">repourl</span></code> is provided): the base repository URL, to which a branch name will be appended.
It should probably end in a slash.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">defaultBranch</span></code></dt><dd><p>(allowed if and only if <code class="docutils literal notranslate"><span class="pre">baseURL</span></code> is provided): this specifies the name of the branch to use when a Build does not provide one of its own.
This will be appended to <code class="docutils literal notranslate"><span class="pre">baseURL</span></code> to create the string that will be passed to the <code class="docutils literal notranslate"><span class="pre">bzr</span> <span class="pre">checkout</span></code> command.
If <code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> then the branch and revision information that comes with the Build is ignored and branch specified in this parameter is used.</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">mode</span></code>
<code class="docutils literal notranslate"><span class="pre">method</span></code></p>
<blockquote>
<div><p>No method is needed for incremental mode.
For full mode, <code class="docutils literal notranslate"><span class="pre">method</span></code> can take the values shown below.
If no value is given, it defaults to <code class="docutils literal notranslate"><span class="pre">fresh</span></code>.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">clobber</span></code></dt><dd><p>This specifies to remove the <code class="docutils literal notranslate"><span class="pre">workdir</span></code> and make a full checkout.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fresh</span></code></dt><dd><p>This method first runs <code class="docutils literal notranslate"><span class="pre">bzr</span> <span class="pre">clean-tree</span></code> to remove all the unversioned files then <code class="docutils literal notranslate"><span class="pre">update</span></code> the repo.
This remove all unversioned files including those in .bzrignore.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clean</span></code></dt><dd><p>This is same as fresh except that it doesn’t remove the files mentioned in <code class="file docutils literal notranslate"><span class="pre">.bzrginore</span></code> i.e, by running <code class="docutils literal notranslate"><span class="pre">bzr</span> <span class="pre">clean-tree</span> <span class="pre">--ignore</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">copy</span></code></dt><dd><p>A local bzr repository is maintained and the repo is copied to <code class="docutils literal notranslate"><span class="pre">build</span></code> directory for each build.
Before each build the local bzr repo is updated then copied to <code class="docutils literal notranslate"><span class="pre">build</span></code> for next steps.</p>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="p4">
<h3><a class="toc-backref" href="#id236">P4</a><a class="headerlink" href="#p4" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.p4.P4">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.source.p4.</code><code class="sig-name descname">P4</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.p4.P4" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a href="#id33"><span class="problematic" id="id34">:bb:step:`P4`</span></a> build step creates a <a class="reference external" href="http://www.perforce.com/">Perforce</a> client specification and performs an update.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">P4</span><span class="p">(</span>
    <span class="n">p4port</span><span class="o">=</span><span class="n">p4port</span><span class="p">,</span>
    <span class="n">p4client</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">WithProperties</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(P4USER)s</span><span class="s1">-</span><span class="si">%(workername)s</span><span class="s1">-</span><span class="si">%(buildername)s</span><span class="s1">&#39;</span><span class="p">),</span>
    <span class="n">p4user</span><span class="o">=</span><span class="n">p4user</span><span class="p">,</span>
    <span class="n">p4base</span><span class="o">=</span><span class="s1">&#39;//depot&#39;</span><span class="p">,</span>
    <span class="n">p4viewspec</span><span class="o">=</span><span class="n">p4viewspec</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>You can specify the client spec in two different ways.
You can use the <code class="docutils literal notranslate"><span class="pre">p4base</span></code>, <code class="docutils literal notranslate"><span class="pre">p4branch</span></code>, and (optionally) <code class="docutils literal notranslate"><span class="pre">p4extra_views</span></code> to build up the viewspec, or you can utilize the <code class="docutils literal notranslate"><span class="pre">p4viewspec</span></code> to specify the whole viewspec as a set of tuples.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">p4viewspec</span></code> will allow you to add lines such as:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//depot/branch/mybranch/...             //&lt;p4client&gt;/...
-//depot/branch/mybranch/notthisdir/... //&lt;p4client&gt;/notthisdir/...
</pre></div>
</div>
<p>If you specify <code class="docutils literal notranslate"><span class="pre">p4viewspec</span></code> and any of <code class="docutils literal notranslate"><span class="pre">p4base</span></code>, <code class="docutils literal notranslate"><span class="pre">p4branch</span></code>, and/or <code class="docutils literal notranslate"><span class="pre">p4extra_views</span></code> you will receive a configuration error exception.</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">p4base</span></code></dt><dd><p>A view into the Perforce depot without branch name or trailing <code class="docutils literal notranslate"><span class="pre">/...</span></code>.
Typically <code class="docutils literal notranslate"><span class="pre">//depot/proj</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4branch</span></code></dt><dd><p>(optional): A single string, which is appended to the p4base as follows <code class="docutils literal notranslate"><span class="pre">&lt;p4base&gt;/&lt;p4branch&gt;/...</span></code> to form the first line in the viewspec</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4extra_views</span></code></dt><dd><p>(optional): a list of <code class="docutils literal notranslate"><span class="pre">(depotpath,</span> <span class="pre">clientpath)</span></code> tuples containing extra views to be mapped into the client specification.
Both will have <code class="docutils literal notranslate"><span class="pre">/...</span></code> appended automatically.
The client name and source directory will be prepended to the client path.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4viewspec</span></code></dt><dd><p>This will override any p4branch, p4base, and/or p4extra_views specified.
The viewspec will be an array of tuples as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="s1">&#39;//depot/main/&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>It yields a viewspec with just:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//depot/main/... //&lt;p4client&gt;/...
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4viewspec_suffix</span></code></dt><dd><p>(optional): The <code class="docutils literal notranslate"><span class="pre">p4viewspec</span></code> lets you customize the client spec for a builder but, as the previous example shows, it automatically adds <code class="docutils literal notranslate"><span class="pre">...</span></code> at the end of each line.
If you need to also specify file-level remappings, you can set the <code class="docutils literal notranslate"><span class="pre">p4viewspec_suffix</span></code> to <code class="docutils literal notranslate"><span class="pre">None</span></code> so that nothing is added to your viewspec:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="s1">&#39;//depot/main/...&#39;</span><span class="p">,</span> <span class="s1">&#39;...&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;-//depot/main/config.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;config.xml&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;//depot/main/config.vancouver.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;config.xml&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>It yields a viewspec with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//depot/main/...                  //&lt;p4client&gt;/...
-//depot/main/config.xml          //&lt;p4client/main/config.xml
//depot/main/config.vancouver.xml //&lt;p4client&gt;/main/config.xml
</pre></div>
</div>
<p>Note how, with <code class="docutils literal notranslate"><span class="pre">p4viewspec_suffix</span></code> set to <code class="docutils literal notranslate"><span class="pre">None</span></code>, you need to manually add <code class="docutils literal notranslate"><span class="pre">...</span></code> where you need it.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4client_spec_options</span></code></dt><dd><p>(optional): By default, clients are created with the <code class="docutils literal notranslate"><span class="pre">allwrite</span> <span class="pre">rmdir</span></code> options.
This string lets you change that.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4port</span></code></dt><dd><p>(optional): the <code class="samp docutils literal notranslate"><em><span class="pre">host</span></em><span class="pre">:</span><em><span class="pre">port</span></em></code> string describing how to get to the P4 Depot (repository), used as the option <cite>-p</cite> argument for all p4 commands.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4user</span></code></dt><dd><p>(optional): the Perforce user, used as the option <cite>-u</cite> argument to all p4 commands.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4passwd</span></code></dt><dd><p>(optional): the Perforce password, used as the option <cite>-p</cite> argument to all p4 commands.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4client</span></code></dt><dd><p>(optional): The name of the client to use.
In <code class="docutils literal notranslate"><span class="pre">mode='full'</span></code> and <code class="docutils literal notranslate"><span class="pre">mode='incremental'</span></code>, it’s particularly important that a unique name is used for each checkout directory to avoid incorrect synchronization.
For this reason, Python percent substitution will be performed on this value to replace <code class="docutils literal notranslate"><span class="pre">%(prop:workername)s</span></code> with the worker name and <code class="docutils literal notranslate"><span class="pre">%(prop:buildername)s</span></code> with the builder name.
The default is <code class="docutils literal notranslate"><span class="pre">buildbot_%(prop:workername)s_%(prop:buildername)s</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4line_end</span></code></dt><dd><p>(optional): The type of line ending handling P4 should use.
This is added directly to the client spec’s <code class="docutils literal notranslate"><span class="pre">LineEnd</span></code> property.
The default is <code class="docutils literal notranslate"><span class="pre">local</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4extra_args</span></code></dt><dd><p>(optional): Extra arguments to be added to the P4 command-line for the <code class="docutils literal notranslate"><span class="pre">sync</span></code> command.
So for instance if you want to sync only to populate a Perforce proxy (without actually syncing files to disk), you can do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">P4</span><span class="p">(</span><span class="n">p4extra_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-Zproxyload&#39;</span><span class="p">],</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">use_tickets</span></code></dt><dd><p>Set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to use ticket-based authentication, instead of passwords (but you still need to specify <code class="docutils literal notranslate"><span class="pre">p4passwd</span></code>).</p>
</dd>
</dl>
</div>
<div class="section" id="repo">
<h3><a class="toc-backref" href="#id237">Repo</a><a class="headerlink" href="#repo" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.repo.Repo">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.source.repo.</code><code class="sig-name descname">Repo</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.repo.Repo" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a href="#id35"><span class="problematic" id="id36">:bb:step:`Repo`</span></a> build step performs a <a class="reference external" href="http://lwn.net/Articles/304488/">Repo</a> init and sync.</p>
<p>The Repo step takes the following arguments:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">manifestURL</span></code></dt><dd><p>(required): the URL at which the Repo’s manifests source repository is available.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">manifestBranch</span></code></dt><dd><p>(optional, defaults to <code class="docutils literal notranslate"><span class="pre">master</span></code>): the manifest repository branch on which repo will take its manifest.
Corresponds to the <code class="docutils literal notranslate"><span class="pre">-b</span></code> argument to the <strong class="command">repo init</strong> command.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">manifestFile</span></code></dt><dd><p>(optional, defaults to <code class="docutils literal notranslate"><span class="pre">default.xml</span></code>): the manifest filename.
Corresponds to the <code class="docutils literal notranslate"><span class="pre">-m</span></code> argument to the <strong class="command">repo init</strong> command.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tarball</span></code></dt><dd><p>(optional, defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>): the repo tarball used for fast bootstrap.
If not present the tarball will be created automatically after first sync.
It is a copy of the <code class="docutils literal notranslate"><span class="pre">.repo</span></code> directory which contains all the Git objects.
This feature helps to minimize network usage on very big projects with lots of workers.</p>
<p>The suffix of the tarball determines if the tarball is compressed and which compressor is chosen.
Supported suffixes are <code class="docutils literal notranslate"><span class="pre">bz2</span></code>, <code class="docutils literal notranslate"><span class="pre">gz</span></code>, <code class="docutils literal notranslate"><span class="pre">lzma</span></code>, <code class="docutils literal notranslate"><span class="pre">lzop</span></code>, and <code class="docutils literal notranslate"><span class="pre">pigz</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">jobs</span></code></dt><dd><p>(optional, defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>): Number of projects to fetch simultaneously while syncing.
Passed to repo sync subcommand with “-j”.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">syncAllBranches</span></code></dt><dd><p>(optional, defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>): renderable boolean to control whether <code class="docutils literal notranslate"><span class="pre">repo</span></code> syncs all branches.
I.e. <code class="docutils literal notranslate"><span class="pre">repo</span> <span class="pre">sync</span> <span class="pre">-c</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">depth</span></code></dt><dd><p>(optional, defaults to 0): Depth argument passed to repo init.
Specifies the amount of git history to store.
A depth of 1 is useful for shallow clones.
This can save considerable disk space on very large projects.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">updateTarballAge</span></code></dt><dd><p>(optional, defaults to “one week”): renderable to control the policy of updating of the tarball given properties.
Returns: max age of tarball in seconds, or <code class="docutils literal notranslate"><span class="pre">None</span></code>, if we want to skip tarball update.
The default value should be good trade off on size of the tarball, and update frequency compared to cost of tarball creation</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">repoDownloads</span></code></dt><dd><p>(optional, defaults to None): list of <code class="docutils literal notranslate"><span class="pre">repo</span> <span class="pre">download</span></code> commands to perform at the end of the Repo step each string in the list will be prefixed <code class="docutils literal notranslate"><span class="pre">repo</span> <span class="pre">download</span></code>, and run as is.
This means you can include parameter in the string.
For example:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[&quot;-c</span> <span class="pre">project</span> <span class="pre">1234/4&quot;]</span></code> will cherry-pick patchset 4 of patch 1234 in project <code class="docutils literal notranslate"><span class="pre">project</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[&quot;-f</span> <span class="pre">project</span> <span class="pre">1234/4&quot;]</span></code> will enforce fast-forward on patchset 4 of patch 1234 in project <code class="docutils literal notranslate"><span class="pre">project</span></code></p></li>
</ul>
</dd>
</dl>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.repo.RepoDownloadsFromProperties">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.source.repo.</code><code class="sig-name descname">RepoDownloadsFromProperties</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.repo.RepoDownloadsFromProperties" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">util.repo.DownloadsFromProperties</span></code> can be used as a renderable of the <code class="docutils literal notranslate"><span class="pre">repoDownload</span></code> parameter it will look in passed properties for string with following possible format:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">repo</span> <span class="pre">download</span> <span class="pre">project</span> <span class="pre">change_number/patchset_number</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">project</span> <span class="pre">change_number/patchset_number</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">project/change_number/patchset_number</span></code></p></li>
</ul>
<p>All of these properties will be translated into a <strong class="command">repo download</strong>.
This feature allows integrators to build with several pending interdependent changes, which at the moment cannot be described properly in Gerrit, and can only be described by humans.</p>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.repo.RepoDownloadsFromChangeSource">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.source.repo.</code><code class="sig-name descname">RepoDownloadsFromChangeSource</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.repo.RepoDownloadsFromChangeSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">util.repo.DownloadsFromChangeSource</span></code> can be used as a renderable of the <code class="docutils literal notranslate"><span class="pre">repoDownload</span></code> parameter</p>
<p>This rendereable integrates with <a href="#id38"><span class="problematic" id="id39">:bb:chsrc:`GerritChangeSource`</span></a>, and will automatically use the <strong class="command">repo download</strong> command of repo to download the additional changes introduced by a pending changeset.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can use the two above Rendereable in conjunction by using the class <code class="docutils literal notranslate"><span class="pre">buildbot.process.properties.FlattenList</span></code></p>
</div>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Repo</span><span class="p">(</span><span class="n">manifestURL</span><span class="o">=</span><span class="s1">&#39;git://gerrit.example.org/manifest.git&#39;</span><span class="p">,</span>
                           <span class="n">repoDownloads</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">FlattenList</span><span class="p">([</span>
                                <span class="n">util</span><span class="o">.</span><span class="n">RepoDownloadsFromChangeSource</span><span class="p">(),</span>
                                <span class="n">util</span><span class="o">.</span><span class="n">RepoDownloadsFromProperties</span><span class="p">(</span><span class="s2">&quot;repo_downloads&quot;</span><span class="p">)</span>
                           <span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="section" id="gerrit">
<span id="step-gerrit"></span><h3><a class="toc-backref" href="#id238">Gerrit</a><a class="headerlink" href="#gerrit" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.gerrit.Gerrit">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.source.gerrit.</code><code class="sig-name descname">Gerrit</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.gerrit.Gerrit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a href="#id40"><span class="problematic" id="id41">:bb:step:`Gerrit`</span></a> step is exactly like the <a href="#id42"><span class="problematic" id="id43">:bb:step:`Git`</span></a> step, except that it integrates with <a href="#id44"><span class="problematic" id="id45">:bb:chsrc:`GerritChangeSource`</span></a>, and will automatically checkout the additional changes.</p>
<p>Gerrit integration can be also triggered using forced build with property named <code class="docutils literal notranslate"><span class="pre">gerrit_change</span></code> with values in format <code class="docutils literal notranslate"><span class="pre">change_number/patchset_number</span></code>.
This property will be translated into a branch name.
This feature allows integrators to build with several pending interdependent changes, which at the moment cannot be described properly in Gerrit, and can only be described by humans.</p>
</div>
<div class="section" id="github">
<span id="step-github"></span><h3><a class="toc-backref" href="#id239">GitHub</a><a class="headerlink" href="#github" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.github.GitHub">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.source.github.</code><code class="sig-name descname">GitHub</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.github.GitHub" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a href="#id46"><span class="problematic" id="id47">:bb:step:`GitHub`</span></a> step is exactly like the <a href="#id48"><span class="problematic" id="id49">:bb:step:`Git`</span></a> step, except that it will ignore the revision sent by <a href="#id50"><span class="problematic" id="id51">:bb:chsrc:`GitHub`</span></a> change hook, and rather take the branch if the branch ends with /merge.</p>
<p>This allows to test github pull requests merged directly into the mainline.</p>
<p>GitHub indeed provides <code class="docutils literal notranslate"><span class="pre">refs/origin/pull/NNN/merge</span></code> on top of <code class="docutils literal notranslate"><span class="pre">refs/origin/pull/NNN/head</span></code> which is a magic ref that always create a merge commit to the latest version of the mainline (i.e. the target branch for the pull request).</p>
<p>The revision in the GitHub event points to <code class="docutils literal notranslate"><span class="pre">/head</span></code> is important for the GitHub reporter as this is the revision that will be tagged with a CI status when the build is finished.</p>
<p>If you want to use  <a href="#id52"><span class="problematic" id="id53">:bb:step:`Trigger`</span></a> to create sub tests and want to have the GitHub reporter still update the original revision, make sure you set <code class="docutils literal notranslate"><span class="pre">updateSourceStamp=False</span></code> in the <a href="#id54"><span class="problematic" id="id55">:bb:step:`Trigger`</span></a> configuration.</p>
</div>
<div class="section" id="gitlab">
<span id="step-gitlab"></span><h3><a class="toc-backref" href="#id240">GitLab</a><a class="headerlink" href="#gitlab" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.gitlab.GitLab">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.source.gitlab.</code><code class="sig-name descname">GitLab</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.gitlab.GitLab" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a href="#id56"><span class="problematic" id="id57">:bb:step:`GitLab`</span></a> step is exactly like the <a href="#id58"><span class="problematic" id="id59">:bb:step:`Git`</span></a> step, except that it uses the source repo and branch sent by the <a href="#id60"><span class="problematic" id="id61">:bb:chsrc:`GitLab`</span></a> change hook when processing merge requests.</p>
<p>When configuring builders, you can use a ChangeFilter with <code class="docutils literal notranslate"><span class="pre">category</span> <span class="pre">=</span> <span class="pre">&quot;push&quot;</span></code>
to select normal commits, and <code class="docutils literal notranslate"><span class="pre">category</span> <span class="pre">=</span> <span class="pre">&quot;merge_request&quot;</span></code> to select merge requests.</p>
<p>See <code class="file docutils literal notranslate"><span class="pre">master/docs/examples/gitlab.cfg</span></code> in the Buildbot distribution
for a tutorial example of integrating Buildbot with GitLab.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Your build worker will need access to the source project of the
changeset, or it won’t be able to check out the source.  This means
authenticating the build worker via ssh credentials in the usual
way, then granting it access [via a GitLab deploy key
or GitLab project membership](<a class="reference external" href="https://docs.gitlab.com/ee/ssh/">https://docs.gitlab.com/ee/ssh/</a>).
This needs to be done not only for the main git repo, but also for
each fork that wants to be able to submit merge requests against
the main repo.</p>
</div>
</div>
<div class="section" id="darcs">
<span id="step-darcs"></span><h3><a class="toc-backref" href="#id241">Darcs</a><a class="headerlink" href="#darcs" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.darcs.Darcs">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.source.darcs.</code><code class="sig-name descname">Darcs</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.darcs.Darcs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a href="#id62"><span class="problematic" id="id63">:bb:step:`Darcs`</span></a> build step performs a <a class="reference external" href="http://darcs.net/">Darcs</a> checkout or update.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Darcs</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;http://path/to/repo&#39;</span><span class="p">,</span>
                            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;clobber&#39;</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
<p>Darcs step takes the following arguments:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">repourl</span></code></dt><dd><p>(required): The URL at which the Darcs source repository is available.</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">mode</span></code></p>
<blockquote>
<div><p>(optional): defaults to <code class="docutils literal notranslate"><span class="pre">'incremental'</span></code>.
Specifies whether to clean the build tree or not.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">incremental</span></code></dt><dd><p>The source is update, but any built files are left untouched.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">full</span></code></dt><dd><p>The build tree is clean of any built files.
The exact method for doing this is controlled by the <code class="docutils literal notranslate"><span class="pre">method</span></code> argument.</p>
</dd>
</dl>
</div></blockquote>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">method</span></code></dt><dd><p>(optional): defaults to <code class="docutils literal notranslate"><span class="pre">copy</span></code> when mode is <code class="docutils literal notranslate"><span class="pre">full</span></code>.
Darcs’ incremental mode does not require a method.
The full mode has two methods defined:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">clobber</span></code></dt><dd><p>It removes the working directory for each build then makes full checkout.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">copy</span></code></dt><dd><p>This first checkout source into source directory then copy the <code class="docutils literal notranslate"><span class="pre">source</span></code> directory to <code class="docutils literal notranslate"><span class="pre">build</span></code> directory then performs the build operation in the copied directory.
This way we make fresh builds with very less bandwidth to download source.
The behavior of source checkout follows exactly same as incremental.
It performs all the incremental checkout behavior in <code class="docutils literal notranslate"><span class="pre">source</span></code> directory.</p>
</dd>
</dl>
</dd>
</dl>
</div>
<div class="section" id="monotone">
<span id="step-monotone"></span><h3><a class="toc-backref" href="#id242">Monotone</a><a class="headerlink" href="#monotone" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.mtn.Monotone">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.source.mtn.</code><code class="sig-name descname">Monotone</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.mtn.Monotone" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a href="#id65"><span class="problematic" id="id66">:bb:step:`Monotone`</span></a> build step performs a <a class="reference external" href="http://www.monotone.ca/">Monotone</a> checkout or update.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Monotone</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;http://path/to/repo&#39;</span><span class="p">,</span>
                               <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;clobber&#39;</span><span class="p">,</span>
                               <span class="n">branch</span><span class="o">=</span><span class="s1">&#39;some.branch.name&#39;</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
<p>Monotone step takes the following arguments:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">repourl</span></code></dt><dd><p>the URL at which the Monotone source repository is available.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branch</span></code></dt><dd><p>this specifies the name of the branch to use when a Build does not provide one of its own.
If <code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> then the branch and revision information that comes with the Build is ignored and branch specified in this parameter is used.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">progress</span></code></dt><dd><p>this is a boolean that has a pull from the repository use <code class="docutils literal notranslate"><span class="pre">--ticker=dot</span></code> instead of the default <code class="docutils literal notranslate"><span class="pre">--ticker=none</span></code>.</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">mode</span></code></p>
<blockquote>
<div><p>(optional): defaults to <code class="docutils literal notranslate"><span class="pre">'incremental'</span></code>.
Specifies whether to clean the build tree or not.
In any case, the worker first pulls from the given remote repository
to synchronize (or possibly initialize) its local database. The mode
and method only affect how the build tree is checked-out or updated
from the local database.</p>
<blockquote>
<div><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">incremental</span></code></dt><dd><p>The source is update, but any built files are left untouched.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">full</span></code></dt><dd><p>The build tree is clean of any built files.
The exact method for doing this is controlled by the <code class="docutils literal notranslate"><span class="pre">method</span></code> argument.
Even in this mode, the revisions already pulled remain in the database
and a fresh pull is rarely needed.</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">method</span></code></p>
<blockquote>
<div><p>(optional): defaults to <code class="docutils literal notranslate"><span class="pre">copy</span></code> when mode is <code class="docutils literal notranslate"><span class="pre">full</span></code>.
Monotone’s incremental mode does not require a method.
The full mode has four methods defined:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">clobber</span></code></dt><dd><p>It removes the build directory entirely then makes fresh checkout from
the database.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clean</span></code></dt><dd><p>This remove all other files except those tracked and ignored by Monotone.
It will remove all the files that appear in <strong class="command">mtn ls unknown</strong>.
Then it will pull from remote and update the working directory.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fresh</span></code></dt><dd><p>This remove all other files except those tracked by Monotone.
It will remove all the files that appear in <strong class="command">mtn ls ignored</strong> and <strong class="command">mtn ls unknows</strong>.
Then pull and update similar to <code class="docutils literal notranslate"><span class="pre">clean</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">copy</span></code></dt><dd><p>This first checkout source into source directory then copy the <code class="docutils literal notranslate"><span class="pre">source</span></code> directory to <code class="docutils literal notranslate"><span class="pre">build</span></code> directory then performs the build operation in the copied directory.
This way we make fresh builds with very less bandwidth to download source.
The behavior of source checkout follows exactly same as incremental.
It performs all the incremental checkout behavior in <code class="docutils literal notranslate"><span class="pre">source</span></code> directory.</p>
</dd>
</dl>
</div></blockquote>
</div>
</div>
<div class="section" id="other-source-operations">
<h2><a class="toc-backref" href="#id243"><span class="section-number">2.5.11.3. </span>Other Source operations</a><a class="headerlink" href="#other-source-operations" title="Permalink to this headline">¶</a></h2>
<p>Currently the only non-checkout steps that are related to version control are <code class="docutils literal notranslate"><span class="pre">GitCommit</span></code>, <code class="docutils literal notranslate"><span class="pre">GitPush</span></code> and <code class="docutils literal notranslate"><span class="pre">GitTag</span></code>.</p>
<div class="section" id="gitcommit">
<h3><a class="toc-backref" href="#id244">GitCommit</a><a class="headerlink" href="#gitcommit" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.git.GitCommit">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.source.git.</code><code class="sig-name descname">GitCommit</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.git.GitCommit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a href="#id68"><span class="problematic" id="id69">:bb:step:`GitCommit`</span></a> build step add files and commit modifications in your local <a class="reference external" href="http://git.or.cz/">Git</a> repository.</p>
<p>The GitCommit step takes the following arguments:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">workdir</span></code></dt><dd><p>(required) The path to the local repository to push commits from.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">messages</span></code></dt><dd><p>(required) List of message that will be created with the commit.
Correspond to the <code class="docutils literal notranslate"><span class="pre">-m</span></code> flag of the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span></code> command.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">paths</span></code></dt><dd><p>(required) List of path that will be added to the commit.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">logEnviron</span></code></dt><dd><p>(optional) If this option is true (the default), then the step’s logfile will describe the environment variables on the worker.
In situations where the environment is not relevant and is long, it may be easier to set <code class="docutils literal notranslate"><span class="pre">logEnviron=False</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">env</span></code></dt><dd><p>(optional) A dictionary of environment strings which will be added to the child command’s environment.
The usual property interpolations can be used in environment variable names and values - see <a class="reference internal" href="properties.html#properties"><span class="std std-ref">Properties</span></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">timeout</span></code></dt><dd><p>(optional) Specifies the timeout for worker-side operations, in seconds.
If your repositories are particularly large, then you may need to increase this  value from its default of 1200 (20 minutes).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">config</span></code></dt><dd><p>(optional) A dict of git configuration settings to pass to the remote git commands.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">emptyCommits</span></code></dt><dd><p>(optional) One of the values <code class="docutils literal notranslate"><span class="pre">disallow</span></code> (default), <code class="docutils literal notranslate"><span class="pre">create-empty-commit</span></code>, and <code class="docutils literal notranslate"><span class="pre">ignore</span></code>. Decides the behavior when there is nothing to be committed.
The value <code class="docutils literal notranslate"><span class="pre">disallow</span></code> will make the buildstep fail.
The value <code class="docutils literal notranslate"><span class="pre">create-empty-commit</span></code> will create an empty commit.
The value <code class="docutils literal notranslate"><span class="pre">ignore</span></code> will create no commit.</p>
</dd>
</dl>
</div>
<div class="section" id="gitpush">
<h3><a class="toc-backref" href="#id245">GitPush</a><a class="headerlink" href="#gitpush" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.git.GitPush">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.source.git.</code><code class="sig-name descname">GitPush</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.git.GitPush" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a href="#id71"><span class="problematic" id="id72">:bb:step:`GitPush`</span></a> build step pushes new commits to a <a class="reference external" href="http://git.or.cz/">Git</a> repository.</p>
<p>The GitPush step takes the following arguments:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">workdir</span></code></dt><dd><p>(required) The path to the local repository to push commits from.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">repourl</span></code></dt><dd><p>(required) The URL of the upstream Git repository.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branch</span></code></dt><dd><p>(required) The branch to push.
The branch should already exist on the local repository.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">force</span></code></dt><dd><p>(optional) If <code class="docutils literal notranslate"><span class="pre">True</span></code>, forces overwrite of refs on the remote repository.
Corresponds to the <code class="docutils literal notranslate"><span class="pre">--force</span></code> flag of the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code> command.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">logEnviron</span></code></dt><dd><p>(optional) If this option is true (the default), then the step’s logfile will describe the environment variables on the worker.
In situations where the environment is not relevant and is long, it may be easier to set <code class="docutils literal notranslate"><span class="pre">logEnviron=False</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">env</span></code></dt><dd><p>(optional) A dictionary of environment strings which will be added to the child command’s environment.
The usual property interpolations can be used in environment variable names and values - see <a class="reference internal" href="properties.html#properties"><span class="std std-ref">Properties</span></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">timeout</span></code></dt><dd><p>(optional) Specifies the timeout for worker-side operations, in seconds.
If your repositories are particularly large, then you may need to increase this  value from its default of 1200 (20 minutes).</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">config</span></code></p>
<blockquote>
<div><p>(optional) A dict of git configuration settings to pass to the remote git commands.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">sshPrivateKey</span></code></p>
<blockquote>
<div><p>(optional) The private key to use when running git for fetch operations.
The ssh utility must be in the system path in order to use this option.
On Windows only git distribution that embeds MINGW has been tested (as of July 2017 the official distribution is MINGW-based).
The worker must either have the host in the known hosts file or the host key must be specified via the <code class="docutils literal notranslate"><span class="pre">sshHostKey</span></code> option.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">sshHostKey</span></code></p>
<blockquote>
<div><p>(optional) Specifies public host key to match when authenticating with SSH public key authentication.
This may be either a <a class="reference internal" href="../secretsmanagement.html#secret"><span class="std std-ref">Secret</span></a> or just a string.
<code class="docutils literal notranslate"><span class="pre">sshPrivateKey</span></code> must be specified in order to use this option.
The host key must be in the form of <code class="docutils literal notranslate"><span class="pre">&lt;key</span> <span class="pre">type&gt;</span> <span class="pre">&lt;base64-encoded</span> <span class="pre">string&gt;</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">ssh-rsa</span> <span class="pre">AAAAB3N&lt;...&gt;FAaQ==</span></code>.</p>
</div></blockquote>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">sshKnownHosts</span></code> (optional)</dt><dd><p>Specifies the contents of the SSH known_hosts file to match when authenticating with SSH public key authentication.
This may be either a <a class="reference internal" href="../secretsmanagement.html#secret"><span class="std std-ref">Secret</span></a> or just a string.
<cite>sshPrivateKey</cite> must be specified in order to use this option.
<cite>sshHostKey</cite> must not be specified in order to use this option.</p>
</dd>
</dl>
</div>
<div class="section" id="gittag">
<h3><a class="toc-backref" href="#id246">GitTag</a><a class="headerlink" href="#gittag" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.git.GitTag">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.source.git.</code><code class="sig-name descname">GitTag</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.git.GitTag" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a href="#id74"><span class="problematic" id="id75">:bb:step:`GitTag`</span></a> build step create a tag in your local <a class="reference external" href="http://git.or.cz/">Git</a> repository.</p>
<p>The GitTag step takes the following arguments:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">workdir</span></code></dt><dd><p>(required) The path to the local repository to push commits from.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tagName</span></code></dt><dd><p>(required) The name of the tag.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">annotated</span></code></dt><dd><p>(optional) If <code class="docutils literal notranslate"><span class="pre">True</span></code>, create an annotated tag.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">messages</span></code></dt><dd><p>(optional) List of message that will be created with the annotated tag.
Must be set only if annotated parameter is <code class="docutils literal notranslate"><span class="pre">True</span></code>.
Correspond to the <code class="docutils literal notranslate"><span class="pre">-m</span></code> flag of the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">tag</span></code> command.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">force</span></code></dt><dd><p>(optional) If <code class="docutils literal notranslate"><span class="pre">True</span></code>, forces overwrite of tags on the local repository.
Corresponds to the <code class="docutils literal notranslate"><span class="pre">--force</span></code> flag of the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">tag</span></code> command.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">logEnviron</span></code></dt><dd><p>(optional) If this option is true (the default), then the step’s logfile will describe the environment variables on the worker.
In situations where the environment is not relevant and is long, it may be easier to set <code class="docutils literal notranslate"><span class="pre">logEnviron=False</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">env</span></code></dt><dd><p>(optional) A dictionary of environment strings which will be added to the child command’s environment.
The usual property interpolations can be used in environment variable names and values - see <a class="reference internal" href="properties.html#properties"><span class="std std-ref">Properties</span></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">timeout</span></code></dt><dd><p>(optional) Specifies the timeout for worker-side operations, in seconds.
If your repositories are particularly large, then you may need to increase this  value from its default of 1200 (20 minutes).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">config</span></code></dt><dd><p>(optional) A dict of git configuration settings to pass to the remote git commands.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="shellcommand">
<h2><a class="toc-backref" href="#id247"><span class="section-number">2.5.11.4. </span>ShellCommand</a><a class="headerlink" href="#shellcommand" title="Permalink to this headline">¶</a></h2>
<p>Most interesting steps involve executing a process of some sort on the worker.
The <a href="#id77"><span class="problematic" id="id78">:bb:step:`ShellCommand`</span></a> class handles this activity.</p>
<p>Several subclasses of <a href="#id79"><span class="problematic" id="id80">:bb:step:`ShellCommand`</span></a> are provided as starting points for common build steps.</p>
<div class="section" id="using-shellcommands">
<h3><a class="toc-backref" href="#id248">Using ShellCommands</a><a class="headerlink" href="#using-shellcommands" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.shell.ShellCommand">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.shell.</code><code class="sig-name descname">ShellCommand</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.shell.ShellCommand" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This is a useful base class for just about everything you might want to do during a build (except for the initial source checkout).
It runs a single command in a child shell on the worker.
All stdout/stderr is recorded into a <code class="xref py py-class docutils literal notranslate"><span class="pre">LogFile</span></code>.
The step usually finishes with a status of <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code> if the command’s exit code is non-zero, otherwise it has a status of <code class="docutils literal notranslate"><span class="pre">SUCCESS</span></code>.</p>
<p>The preferred way to specify the command is with a list of argv strings, since this allows for spaces in filenames and avoids doing any fragile shell-escaping.
You can also specify the command with a single string, in which case the string is given to <code class="samp docutils literal notranslate"><span class="pre">/bin/sh</span> <span class="pre">-c</span> <em><span class="pre">COMMAND</span></em></code> for parsing.</p>
<p>On Windows, commands are run via <code class="docutils literal notranslate"><span class="pre">cmd.exe</span> <span class="pre">/c</span></code> which works well.
However, if you’re running a batch file, the error level does not get propagated correctly unless you add ‘call’ before your batch file’s name: <code class="docutils literal notranslate"><span class="pre">cmd=['call',</span> <span class="pre">'myfile.bat',</span> <span class="pre">...]</span></code>.</p>
<p>The <a href="#id81"><span class="problematic" id="id82">:bb:step:`ShellCommand`</span></a> arguments are:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">command</span></code></dt><dd><p>a list of strings (preferred) or single string (discouraged) which specifies the command to be run.
A list of strings is preferred because it can be used directly as an argv array.
Using a single string (with embedded spaces) requires the worker to pass the string to <strong class="command">/bin/sh</strong> for interpretation, which raises all sorts of difficult questions about how to escape or interpret shell metacharacters.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">command</span></code> contains nested lists (for example, from a properties substitution), then that list will be flattened before it is executed.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">workdir</span></code></dt><dd><p>All ShellCommands are run by default in the <code class="docutils literal notranslate"><span class="pre">workdir</span></code>, which defaults to the <code class="file docutils literal notranslate"><span class="pre">build</span></code> subdirectory of the worker builder’s base directory.
The absolute path of the workdir will thus be the worker’s basedir (set as an option to <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span></code>, <a class="reference internal" href="../installation/worker.html#creating-a-worker"><span class="std std-ref">Creating a worker</span></a>) plus the builder’s basedir (set in the builder’s <code class="docutils literal notranslate"><span class="pre">builddir</span></code> key in <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code>) plus the workdir itself (a class-level attribute of the BuildFactory, defaults to <code class="file docutils literal notranslate"><span class="pre">build</span></code>).</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
                             <span class="n">workdir</span><span class="o">=</span><span class="s2">&quot;build/tests&quot;</span><span class="p">))</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">env</span></code></dt><dd><p>a dictionary of environment strings which will be added to the child command’s environment.
For example, to run tests with a different i18n language setting, you might use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
                             <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;LANG&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">}))</span>
</pre></div>
</div>
<p>These variable settings will override any existing ones in the worker’s environment or the environment specified in the <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>.
The exception is <span class="target" id="index-16"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>, which is merged with (actually prepended to) any existing <span class="target" id="index-17"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> setting.
The following example will prepend <code class="file docutils literal notranslate"><span class="pre">/home/buildbot/lib/python</span></code> to any existing <span class="target" id="index-18"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
              <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
              <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;PYTHONPATH&#39;</span><span class="p">:</span> <span class="s2">&quot;/home/buildbot/lib/python&quot;</span><span class="p">}))</span>
</pre></div>
</div>
<p>To avoid the need of concatenating path together in the master config file, if the value is a list, it will be joined together using the right platform dependent separator.</p>
<p>Those variables support expansion so that if you just want to prepend <code class="file docutils literal notranslate"><span class="pre">/home/buildbot/bin</span></code> to the <span class="target" id="index-19"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code> environment variable, you can do it by putting the value <code class="docutils literal notranslate"><span class="pre">${PATH}</span></code> at the end of the value like in the example below.
Variables that don’t exist on the worker will be replaced by <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
              <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
              <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;PATH&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/home/buildbot/bin&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;${PATH}&quot;</span><span class="p">]}))</span>
</pre></div>
</div>
<p>Note that environment values must be strings (or lists that are turned into strings).
In particular, numeric properties such as <code class="docutils literal notranslate"><span class="pre">buildnumber</span></code> must be substituted using <a class="reference internal" href="properties.html#interpolate"><span class="std std-ref">Interpolate</span></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">want_stdout</span></code></dt><dd><p>if <code class="docutils literal notranslate"><span class="pre">False</span></code>, stdout from the child process is discarded rather than being sent to the buildmaster for inclusion in the step’s <code class="xref py py-class docutils literal notranslate"><span class="pre">LogFile</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">want_stderr</span></code></dt><dd><p>like <code class="docutils literal notranslate"><span class="pre">want_stdout</span></code> but for <code class="file docutils literal notranslate"><span class="pre">stderr</span></code>.
Note that commands run through a PTY do not have separate <code class="file docutils literal notranslate"><span class="pre">stdout</span></code>/<code class="file docutils literal notranslate"><span class="pre">stderr</span></code> streams: both are merged into <code class="file docutils literal notranslate"><span class="pre">stdout</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">usePTY</span></code></dt><dd><p>Should this command be run in a <code class="docutils literal notranslate"><span class="pre">pty</span></code>?
<code class="docutils literal notranslate"><span class="pre">False</span></code> by default.
This option is not available on Windows.</p>
<p>In general, you do not want to use a pseudo-terminal.
This is <em>only</em> useful for running commands that require a terminal - for example, testing a command-line application that will only accept passwords read from a terminal.
Using a pseudo-terminal brings lots of compatibility problems, and prevents Buildbot from distinguishing the standard error (red) and standard output (black) streams.</p>
<p>In previous versions, the advantage of using a pseudo-terminal was that <code class="docutils literal notranslate"><span class="pre">grandchild</span></code> processes were more likely to be cleaned up if the build was interrupted or times out.
This occurred because using a pseudo-terminal incidentally puts the command into its own process group.</p>
<p>As of Buildbot-0.8.4, all commands are placed in process groups, and thus grandchild processes will be cleaned up properly.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">logfiles</span></code></dt><dd><p>Sometimes commands will log interesting data to a local file, rather than emitting everything to stdout or stderr.
For example, Twisted’s <strong class="command">trial</strong> command (which runs unit tests) only presents summary information to stdout, and puts the rest into a file named <code class="file docutils literal notranslate"><span class="pre">_trial_temp/test.log</span></code>.
It is often useful to watch these files as the command runs, rather than using <strong class="command">/bin/cat</strong> to dump their contents afterwards.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">logfiles=</span></code> argument allows you to collect data from these secondary logfiles in near-real-time, as the step is running.
It accepts a dictionary which maps from a local Log name (which is how the log data is presented in the build results) to either a remote filename (interpreted relative to the build’s working directory), or a dictionary of options.
Each named file will be polled on a regular basis (every couple of seconds) as the build runs, and any new text will be sent over to the buildmaster.</p>
<p>If you provide a dictionary of options instead of a string, you must specify the <code class="docutils literal notranslate"><span class="pre">filename</span></code> key.
You can optionally provide a <code class="docutils literal notranslate"><span class="pre">follow</span></code> key which is a boolean controlling whether a logfile is followed or concatenated in its entirety.
Following is appropriate for logfiles to which the build step will append, where the pre-existing contents are not interesting.
The default value for <code class="docutils literal notranslate"><span class="pre">follow</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>, which gives the same behavior as just providing a string filename.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
                   <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
                   <span class="n">logfiles</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;triallog&quot;</span><span class="p">:</span> <span class="s2">&quot;_trial_temp/test.log&quot;</span><span class="p">}))</span>
</pre></div>
</div>
<p>The above example will add a log named ‘triallog’ on the master, based on <code class="file docutils literal notranslate"><span class="pre">_trial_temp/test.log</span></code> on the worker.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
                             <span class="n">logfiles</span><span class="o">=</span><span class="p">{</span>
                                 <span class="s2">&quot;triallog&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;_trial_temp/test.log&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;follow&quot;</span><span class="p">:</span> <span class="bp">True</span>
                                 <span class="p">}</span>
                             <span class="p">}))</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lazylogfiles</span></code></dt><dd><p>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, logfiles will be tracked lazily, meaning that they will only be added when and if something is written to them.
This can be used to suppress the display of empty or missing log files.
The default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">timeout</span></code></dt><dd><p>if the command fails to produce any output for this many seconds, it is assumed to be locked up and will be killed.
This defaults to 1200 seconds.
Pass <code class="docutils literal notranslate"><span class="pre">None</span></code> to disable.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">maxTime</span></code></dt><dd><p>if the command takes longer than this many seconds, it will be killed.
This is disabled by default.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">logEnviron</span></code></dt><dd><p>If this option is <code class="docutils literal notranslate"><span class="pre">True</span></code> (the default), then the step’s logfile will describe the environment variables on the worker.
In situations where the environment is not relevant and is long, it may be easier to set <code class="docutils literal notranslate"><span class="pre">logEnviron=False</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">interruptSignal</span></code></dt><dd><p>If the command should be interrupted (either by buildmaster or timeout etc.), what signal should be sent to the process, specified by name.
By default this is “KILL” (9).
Specify “TERM” (15) to give the process a chance to cleanup.
This functionality requires a 0.8.6 worker or newer.</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">sigtermTime</span></code></p>
<blockquote>
<div><p>If set, when interrupting, try to kill the command with SIGTERM and wait for sigtermTime seconds before firing <code class="docutils literal notranslate"><span class="pre">interuptSignal</span></code>.
If None, <code class="docutils literal notranslate"><span class="pre">interruptSignal</span></code> will be fired immediately on interrupt.</p>
</div></blockquote>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">initialStdin</span></code></dt><dd><p>If the command expects input on stdin, that can be supplied a a string with this parameter.
This value should not be excessively large, as it is handled as a single string throughout Buildbot – for example, do not pass the contents of a tarball with this parameter.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">decodeRC</span></code></dt><dd><p>This is a dictionary that decodes exit codes into results value.
For example, <code class="docutils literal notranslate"><span class="pre">{0:SUCCESS,1:FAILURE,2:WARNINGS}</span></code>, will treat the exit code <code class="docutils literal notranslate"><span class="pre">2</span></code> as WARNINGS.
The default is to treat just 0 as successful.
(<code class="docutils literal notranslate"><span class="pre">{0:SUCCESS}</span></code>) any exit code not present in the dictionary will be treated as <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code></p>
</dd>
</dl>
</div>
<div class="section" id="shell-sequence">
<h3><a class="toc-backref" href="#id249">Shell Sequence</a><a class="headerlink" href="#shell-sequence" title="Permalink to this headline">¶</a></h3>
<p>Some steps have a specific purpose, but require multiple shell commands to implement them.
For example, a build is often <code class="docutils literal notranslate"><span class="pre">configure;</span> <span class="pre">make;</span> <span class="pre">make</span> <span class="pre">install</span></code>.
We have two ways to handle that:</p>
<ul class="simple">
<li><p>Create one shell command with all these.
To put the logs of each commands in separate logfiles, we need to re-write the script as <code class="docutils literal notranslate"><span class="pre">configure</span> <span class="pre">1&gt;</span> <span class="pre">configure_log;</span> <span class="pre">...</span></code> and to add these <code class="docutils literal notranslate"><span class="pre">configure_log</span></code> files as <code class="docutils literal notranslate"><span class="pre">logfiles</span></code> argument of the buildstep.
This has the drawback of complicating the shell script, and making it harder to maintain as the logfile name is put in different places.</p></li>
<li><p>Create three <a href="#id83"><span class="problematic" id="id84">:bb:step:`ShellCommand`</span></a> instances, but this loads the build UI unnecessarily.</p></li>
</ul>
<p><a href="#id85"><span class="problematic" id="id86">:bb:step:`ShellSequence`</span></a> is a class to execute not one but a sequence of shell commands during a build.
It takes as argument a renderable, or list of commands which are <a class="reference internal" href="#buildbot.steps.source.buildbot.steps.shellsequence.ShellArg" title="buildbot.steps.source.buildbot.steps.shellsequence.ShellArg"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShellArg</span></code></a> objects.
Each such object represents a shell invocation.</p>
<p>The single <a href="#id87"><span class="problematic" id="id88">:bb:step:`ShellSequence`</span></a> argument aside from the common parameters is:</p>
<p><code class="docutils literal notranslate"><span class="pre">commands</span></code></p>
<p>A list of <a class="reference internal" href="#buildbot.steps.source.buildbot.steps.shellsequence.ShellArg" title="buildbot.steps.source.buildbot.steps.shellsequence.ShellArg"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShellArg</span></code></a> objects or a renderable the returns a list of <a class="reference internal" href="#buildbot.steps.source.buildbot.steps.shellsequence.ShellArg" title="buildbot.steps.source.buildbot.steps.shellsequence.ShellArg"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShellArg</span></code></a> objects.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellSequence</span><span class="p">(</span>
    <span class="n">commands</span><span class="o">=</span><span class="p">[</span>
        <span class="n">util</span><span class="o">.</span><span class="n">ShellArg</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;configure&#39;</span><span class="p">]),</span>
        <span class="n">util</span><span class="o">.</span><span class="n">ShellArg</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">],</span> <span class="n">logfile</span><span class="o">=</span><span class="s1">&#39;make&#39;</span><span class="p">),</span>
        <span class="n">util</span><span class="o">.</span><span class="n">ShellArg</span><span class="p">(</span>
            <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="s1">&#39;check_warning&#39;</span><span class="p">],</span> <span class="n">logfile</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">,</span> <span class="n">warnOnFailure</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">util</span><span class="o">.</span><span class="n">ShellArg</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">],</span> <span class="n">logfile</span><span class="o">=</span><span class="s1">&#39;make install&#39;</span><span class="p">)</span>
    <span class="p">]))</span>
</pre></div>
</div>
<p>All these commands share the same configuration of <code class="docutils literal notranslate"><span class="pre">environment</span></code>, <code class="docutils literal notranslate"><span class="pre">workdir</span></code> and <code class="docutils literal notranslate"><span class="pre">pty</span></code> usage that can be setup the same way as in <a href="#id89"><span class="problematic" id="id90">:bb:step:`ShellCommand`</span></a>.</p>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.shellsequence.ShellArg">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.shellsequence.</code><code class="sig-name descname">ShellArg</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">command=None</em>, <em class="sig-param">logfile=None</em>, <em class="sig-param">haltOnFailure=False</em>, <em class="sig-param">flunkOnWarnings=False</em>, <em class="sig-param">flunkOnFailure=False</em>, <em class="sig-param">warnOnWarnings=False</em>, <em class="sig-param">warnOnFailure=False</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.shellsequence.ShellArg" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>command</strong> – (see the <a href="#id91"><span class="problematic" id="id92">:bb:step:`ShellCommand`</span></a> <code class="docutils literal notranslate"><span class="pre">command</span></code> argument),</p></li>
<li><p><strong>logfile</strong> – optional log file name, used as the stdio log of the command</p></li>
</ul>
</dd>
</dl>
<p>The <code class="docutils literal notranslate"><span class="pre">haltOnFailure</span></code>, <code class="docutils literal notranslate"><span class="pre">flunkOnWarnings</span></code>, <code class="docutils literal notranslate"><span class="pre">flunkOnFailure</span></code>, <code class="docutils literal notranslate"><span class="pre">warnOnWarnings</span></code>, <code class="docutils literal notranslate"><span class="pre">warnOnFailure</span></code> parameters drive the execution of the sequence, the same way steps are scheduled in the build.
They have the same default values as for buildsteps - see <a class="reference internal" href="#buildstep-common-parameters"><span class="std std-ref">Common Parameters</span></a>.</p>
<p>Any of the arguments to this class can be renderable.</p>
<p>Note that if <code class="docutils literal notranslate"><span class="pre">logfile</span></code> name does not start with the prefix <code class="docutils literal notranslate"><span class="pre">stdio</span></code>, that prefix will be set like <code class="docutils literal notranslate"><span class="pre">stdio</span> <span class="pre">&lt;logfile&gt;</span></code>.</p>
</dd></dl>

<p>The two <a href="#id93"><span class="problematic" id="id94">:bb:step:`ShellSequence`</span></a> methods below tune the behavior of how the list of shell commands are executed, and can be overridden in subclasses.</p>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.shellsequence.ShellSequence">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.shellsequence.</code><code class="sig-name descname">ShellSequence</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.shellsequence.ShellSequence" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.steps.source.buildbot.steps.shellsequence.ShellSequence.shouldRunTheCommand">
<code class="sig-name descname">shouldRunTheCommand</code><span class="sig-paren">(</span><em class="sig-param">oneCmd</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.shellsequence.ShellSequence.shouldRunTheCommand" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>oneCmd</strong> – a string or a list of strings, as rendered from a <a class="reference internal" href="#buildbot.steps.source.buildbot.steps.shellsequence.ShellArg" title="buildbot.steps.source.buildbot.steps.shellsequence.ShellArg"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShellArg</span></code></a> instance’s <code class="docutils literal notranslate"><span class="pre">command</span></code> argument.</p>
</dd>
</dl>
<p>Determine whether the command <code class="docutils literal notranslate"><span class="pre">oneCmd</span></code> should be executed.
If <code class="docutils literal notranslate"><span class="pre">shouldRunTheCommand</span></code> returns <code class="docutils literal notranslate"><span class="pre">False</span></code>, the result of the command will be recorded as SKIPPED.
The default methods skips all empty strings and empty lists.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.steps.source.buildbot.steps.shellsequence.ShellSequence.getFinalState">
<code class="sig-name descname">getFinalState</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.shellsequence.ShellSequence.getFinalState" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the status text of the step in the end.
The default value is to set the text describing the execution of the last shell command.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="sig-name descname">runShellSequence(commands):</code></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>commands</strong> – list of shell args</p>
</dd>
</dl>
<p>This method actually runs the shell sequence.
The default <code class="docutils literal notranslate"><span class="pre">run</span></code> method calls <code class="docutils literal notranslate"><span class="pre">runShellSequence</span></code>, but subclasses can override <code class="docutils literal notranslate"><span class="pre">run</span></code> to perform other operations, if desired.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="configure">
<h3><a class="toc-backref" href="#id250">Configure</a><a class="headerlink" href="#configure" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.shell.Configure">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.shell.</code><code class="sig-name descname">Configure</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.shell.Configure" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This is intended to handle the <strong class="command">./configure</strong> step from autoconf-style projects, or the <code class="docutils literal notranslate"><span class="pre">perl</span> <span class="pre">Makefile.PL</span></code> step from perl <code class="file docutils literal notranslate"><span class="pre">MakeMaker.pm</span></code>-style modules.
The default command is <strong class="command">./configure</strong> but you can change this by providing a <code class="docutils literal notranslate"><span class="pre">command=</span></code> parameter.
The arguments are identical to <a href="#id95"><span class="problematic" id="id96">:bb:step:`ShellCommand`</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Configure</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="cmake">
<h3><a class="toc-backref" href="#id251">CMake</a><a class="headerlink" href="#cmake" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.cmake.CMake">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.cmake.</code><code class="sig-name descname">CMake</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.cmake.CMake" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This is intended to handle the <strong class="command">cmake</strong> step for projects that use <a class="reference external" href="http://cmake.org">CMake-based build systems</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Links below point to the latest CMake documentation.
Make sure that you check the documentation for the CMake you use.</p>
</div>
<p>In addition to the parameters <a href="#id97"><span class="problematic" id="id98">:bb:step:`ShellCommand`</span></a> supports, this step accepts the following parameters:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">path</span></code></dt><dd><p>Either a path to a source directory to (re-)generate a build system for it in the current working directory.
Or an existing build directory to re-generate its build system.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">generator</span></code></dt><dd><p>A build system generator.
See <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/cmake-generators.7.html">cmake-generators(7)</a> for available options.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">definitions</span></code></dt><dd><p>A dictionary that contains parameters that will be converted to <code class="docutils literal notranslate"><span class="pre">-D{name}={value}</span></code> when passed to CMake.
A renderable which renders to a dictionary can also be provided, see <a class="reference internal" href="properties.html#properties"><span class="std std-ref">Properties</span></a>.
Refer to <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/cmake.1.html">cmake(1)</a> for more information.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">options</span></code></dt><dd><p>A list or a tuple that contains options that will be passed to CMake as is.
A renderable which renders to a tuple or list can also be provided, see <a class="reference internal" href="properties.html#properties"><span class="std std-ref">Properties</span></a>.
Refer to <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/cmake.1.html">cmake(1)</a> for more information.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cmake</span></code></dt><dd><p>Path to the CMake binary.
Default is <strong class="command">cmake</strong></p>
</dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="o">...</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">CMake</span><span class="p">(</span>
        <span class="n">generator</span><span class="o">=</span><span class="s1">&#39;Ninja&#39;</span><span class="p">,</span>
        <span class="n">definitions</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;CMAKE_BUILD_TYPE&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="s1">&#39;BUILD_TYPE&#39;</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="n">options</span><span class="o">=</span><span class="p">[</span>
            <span class="s1">&#39;-Wno-dev&#39;</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="compile">
<h3><a class="toc-backref" href="#id252">Compile</a><a class="headerlink" href="#compile" title="Permalink to this headline">¶</a></h3>
<p id="index-20">This is meant to handle compiling or building a project written in C.
The default command is <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code>.
When the compilation is finished, the log file is scanned for GCC warning messages, a summary log is created with any problems that were seen, and the step is marked as WARNINGS if any were discovered.
Through the <code class="xref py py-class docutils literal notranslate"><span class="pre">WarningCountingShellCommand</span></code> superclass, the number of warnings is stored in a Build Property named <cite>warnings-count</cite>, which is accumulated over all <a href="#id100"><span class="problematic" id="id101">:bb:step:`Compile`</span></a> steps (so if two warnings are found in one step, and three are found in another step, the overall build will have a <cite>warnings-count</cite> property of 5).
Each step can be optionally given a maximum number of warnings via the maxWarnCount parameter.
If this limit is exceeded, the step will be marked as a failure.</p>
<p>The default regular expression used to detect a warning is <code class="docutils literal notranslate"><span class="pre">'.*warning[:</span> <span class="pre">].*'</span></code> , which is fairly liberal and may cause false-positives.
To use a different regexp, provide a <code class="docutils literal notranslate"><span class="pre">warningPattern=</span></code> argument, or use a subclass which sets the <code class="docutils literal notranslate"><span class="pre">warningPattern</span></code> attribute:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Compile</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
                        <span class="n">warningPattern</span><span class="o">=</span><span class="s2">&quot;^Warning: &quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">warningPattern=</span></code> can also be a pre-compiled Python regexp object: this makes it possible to add flags like <code class="docutils literal notranslate"><span class="pre">re.I</span></code> (to use case-insensitive matching).</p>
<p>Note that the compiled <code class="docutils literal notranslate"><span class="pre">warningPattern</span></code> will have its <code class="xref py py-meth docutils literal notranslate"><span class="pre">match()</span></code> method called, which is subtly different from a <code class="xref py py-meth docutils literal notranslate"><span class="pre">search()</span></code>.
Your regular expression must match the from the beginning of the line.
This means that to look for the word “warning” in the middle of a line, you will need to prepend <code class="docutils literal notranslate"><span class="pre">'.*'</span></code> to your regular expression.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">suppressionFile=</span></code> argument can be specified as the (relative) path of a file inside the workdir defining warnings to be suppressed from the warning counting and log file.
The file will be uploaded to the master from the worker before compiling, and any warning matched by a line in the suppression file will be ignored.
This is useful to accept certain warnings (e.g. in some special module of the source tree or in cases where the compiler is being particularly stupid), yet still be able to easily detect and fix the introduction of new warnings.</p>
<p>The file must contain one line per pattern of warnings to ignore.
Empty lines and lines beginning with <code class="docutils literal notranslate"><span class="pre">#</span></code> are ignored.
Other lines must consist of a regexp matching the file name, followed by a colon (<code class="docutils literal notranslate"><span class="pre">:</span></code>), followed by a regexp matching the text of the warning.
Optionally this may be followed by another colon and a line number range.
For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Sample warning suppression file

mi_packrec.c : .*result of 32-bit shift implicitly converted to 64 bits.* : 560-600
DictTabInfo.cpp : .*invalid access to non-static.*
kernel_types.h : .*only defines private constructors and has no friends.* : 51
</pre></div>
</div>
<p>If no line number range is specified, the pattern matches the whole file; if only one number is given it matches only on that line.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">suppressionList=</span></code> argument can be specified as a list of four-tuples as addition or instead of <code class="docutils literal notranslate"><span class="pre">suppressionFile=</span></code>.
The tuple should be <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">FILE-RE,</span> <span class="pre">WARNING-RE,</span> <span class="pre">START,</span> <span class="pre">END</span> <span class="pre">]</span></code>.
If <code class="docutils literal notranslate"><span class="pre">FILE-RE</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>, then the suppression applies to any file.
<code class="docutils literal notranslate"><span class="pre">START</span></code> and <code class="docutils literal notranslate"><span class="pre">END</span></code> can be specified as in suppression file, or <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>The default warningPattern regexp only matches the warning text, so line numbers and file names are ignored.
To enable line number and file name matching, provide a different regexp and provide a function (callable) as the argument of <code class="docutils literal notranslate"><span class="pre">warningExtractor=</span></code>.
The function is called with three arguments: the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> object, the line in the log file with the warning, and the <code class="docutils literal notranslate"><span class="pre">SRE_Match</span></code> object of the regexp search for <code class="docutils literal notranslate"><span class="pre">warningPattern</span></code>.
It should return a tuple <code class="docutils literal notranslate"><span class="pre">(filename,</span> <span class="pre">linenumber,</span> <span class="pre">warning_test)</span></code>.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Compile</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">],</span>
                  <span class="n">warningPattern</span><span class="o">=</span><span class="s2">&quot;^(.\*?):([0-9]+): [Ww]arning: (.\*)$&quot;</span><span class="p">,</span>
                  <span class="n">warningExtractor</span><span class="o">=</span><span class="n">Compile</span><span class="o">.</span><span class="n">warnExtractFromRegexpGroups</span><span class="p">,</span>
                  <span class="n">suppressionFile</span><span class="o">=</span><span class="s2">&quot;support-files/compiler_warnings.supp&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>(<code class="docutils literal notranslate"><span class="pre">Compile.warnExtractFromRegexpGroups</span></code> is a pre-defined function that returns the filename, linenumber, and text from groups (1,2,3) of the regexp match).</p>
<p>In projects with source files in multiple directories, it is possible to get full path names for file names matched in the suppression file, as long as the build command outputs the names of directories as they are entered into and left again.
For this, specify regexps for the arguments <code class="docutils literal notranslate"><span class="pre">directoryEnterPattern=</span></code> and <code class="docutils literal notranslate"><span class="pre">directoryLeavePattern=</span></code>.
The <code class="docutils literal notranslate"><span class="pre">directoryEnterPattern=</span></code> regexp should return the name of the directory entered into in the first matched group.
The defaults, which are suitable for GNU Make, are these:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">directoryEnterPattern</span><span class="o">=</span><span class="s2">&quot;make.*: Entering directory [</span><span class="se">\&quot;</span><span class="s2">`&#39;](.*)[&#39;`</span><span class="se">\&quot;</span><span class="s2">]&quot;</span>
<span class="n">directoryLeavePattern</span><span class="o">=</span><span class="s2">&quot;make.*: Leaving directory&quot;</span>
</pre></div>
</div>
<p>(TODO: this step needs to be extended to look for GCC error messages as well, and collect them into a separate logfile, along with the source code filenames involved).</p>
</div>
<div class="section" id="visual-c">
<h3><a class="toc-backref" href="#id253">Visual C++</a><a class="headerlink" href="#visual-c" title="Permalink to this headline">¶</a></h3>
<p>These steps are meant to handle compilation using Microsoft compilers.
VC++ 6-141 (aka Visual Studio 2003-2015 and VCExpress9) are supported via calling <code class="docutils literal notranslate"><span class="pre">devenv</span></code>.
Msbuild as well as Windows Driver Kit 8 are supported via the <code class="docutils literal notranslate"><span class="pre">MsBuild4</span></code>, <code class="docutils literal notranslate"><span class="pre">MsBuild12</span></code>, <code class="docutils literal notranslate"><span class="pre">MsBuild14</span></code> and  <code class="docutils literal notranslate"><span class="pre">MsBuild141</span></code> steps.
These steps will take care of setting up a clean compilation environment, parsing the generated output in real time, and delivering as detailed as possible information about the compilation executed.</p>
<p>All of the classes are in <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.steps.vstudio</span></code>.
The available classes are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">VC6</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VC7</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VC8</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VC9</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VC10</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VC11</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VC12</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VC14</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VC141</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VS2003</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VS2005</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VS2008</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VS2010</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VS2012</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VS2013</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VS2015</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VS2017</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VCExpress9</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MsBuild4</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MsBuild12</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MsBuild14</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MsBuild141</span></code></p></li>
</ul>
<p>The available constructor arguments are</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">mode</span></code></dt><dd><p>The mode default to <code class="docutils literal notranslate"><span class="pre">rebuild</span></code>, which means that first all the remaining object files will be cleaned by the compiler.
The alternate values are <code class="docutils literal notranslate"><span class="pre">build</span></code>, where only the updated files will be recompiled, and <code class="docutils literal notranslate"><span class="pre">clean</span></code>, where the current build files are removed and no compilation occurs.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">projectfile</span></code></dt><dd><p>This is a mandatory argument which specifies the project file to be used during the compilation.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">config</span></code></dt><dd><p>This argument defaults to <code class="docutils literal notranslate"><span class="pre">release</span></code> an gives to the compiler the configuration to use.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">installdir</span></code></dt><dd><p>This is the place where the compiler is installed.
The default value is compiler specific and is the default place where the compiler is installed.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">useenv</span></code></dt><dd><p>This boolean parameter, defaulting to <code class="docutils literal notranslate"><span class="pre">False</span></code> instruct the compiler to use its own settings or the one defined through the environment variables <span class="target" id="index-22"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code>, <span class="target" id="index-23"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">INCLUDE</span></code>, and <span class="target" id="index-24"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">LIB</span></code>.
If any of the <code class="docutils literal notranslate"><span class="pre">INCLUDE</span></code> or  <code class="docutils literal notranslate"><span class="pre">LIB</span></code> parameter is defined, this parameter automatically switches to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PATH</span></code></dt><dd><p>This is a list of path to be added to the <span class="target" id="index-25"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code> environment variable.
The default value is the one defined in the compiler options.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">INCLUDE</span></code></dt><dd><p>This is a list of path where the compiler will first look for include files.
Then comes the default paths defined in the compiler options.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">LIB</span></code></dt><dd><p>This is a list of path where the compiler will first look for libraries.
Then comes the default path defined in the compiler options.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">arch</span></code></dt><dd><p>That one is only available with the class VS2005 (VC8).
It gives the target architecture of the built artifact.
It defaults to <code class="docutils literal notranslate"><span class="pre">x86</span></code> and does not apply to <code class="docutils literal notranslate"><span class="pre">MsBuild4</span></code> or <code class="docutils literal notranslate"><span class="pre">MsBuild12</span></code>.
Please see <code class="docutils literal notranslate"><span class="pre">platform</span></code> below.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">project</span></code></dt><dd><p>This gives the specific project to build from within a workspace.
It defaults to building all projects.
This is useful for building cmake generate projects.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">platform</span></code></dt><dd><p>This is a mandatory argument for <code class="docutils literal notranslate"><span class="pre">MsBuild4</span></code> and <code class="docutils literal notranslate"><span class="pre">MsBuild12</span></code> specifying the target platform such as ‘Win32’, ‘x64’ or ‘Vista Debug’.
The last one is an example of driver targets that appear once Windows Driver Kit 8 is installed.</p>
</dd>
</dl>
<p>Here is an example on how to drive compilation with Visual Studio 2013:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">VS2013</span><span class="p">(</span><span class="n">projectfile</span><span class="o">=</span><span class="s2">&quot;project.sln&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s2">&quot;release&quot;</span><span class="p">,</span>
        <span class="n">arch</span><span class="o">=</span><span class="s2">&quot;x64&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;build&quot;</span><span class="p">,</span>
           <span class="n">INCLUDE</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s1">&#39;C:\3rd-party\libmagic\include&#39;</span><span class="p">],</span>
           <span class="n">LIB</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s1">&#39;C:\3rd-party\libmagic\lib-x64&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p>Here is a similar example using “MsBuild12”:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="c1"># Build one project in Release mode for Win32</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">MsBuild12</span><span class="p">(</span><span class="n">projectfile</span><span class="o">=</span><span class="s2">&quot;trunk.sln&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s2">&quot;Release&quot;</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="s2">&quot;Win32&quot;</span><span class="p">,</span>
            <span class="n">workdir</span><span class="o">=</span><span class="s2">&quot;trunk&quot;</span><span class="p">,</span>
            <span class="n">project</span><span class="o">=</span><span class="s2">&quot;tools</span><span class="se">\\</span><span class="s2">protoc&quot;</span><span class="p">))</span>

<span class="c1"># Build the entire solution in Debug mode for x64</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">MsBuild12</span><span class="p">(</span><span class="n">projectfile</span><span class="o">=</span><span class="s2">&quot;trunk.sln&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s1">&#39;Debug&#39;</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="s1">&#39;x64&#39;</span><span class="p">,</span>
            <span class="n">workdir</span><span class="o">=</span><span class="s2">&quot;trunk&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="cppcheck">
<h3><a class="toc-backref" href="#id254">Cppcheck</a><a class="headerlink" href="#cppcheck" title="Permalink to this headline">¶</a></h3>
<p>This step runs <code class="docutils literal notranslate"><span class="pre">cppcheck</span></code>, analyse its output, and set the outcome in <a class="reference internal" href="properties.html#properties"><span class="std std-ref">Properties</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Cppcheck</span><span class="p">(</span><span class="n">enable</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">],</span> <span class="n">inconclusive</span><span class="o">=</span><span class="bp">True</span><span class="p">]))</span>
</pre></div>
</div>
<p>This class adds the following arguments:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">binary</span></code></dt><dd><p>(Optional, default to <code class="docutils literal notranslate"><span class="pre">cppcheck</span></code>)
Use this if you need to give the full path to the cppcheck binary or if your binary is called differently.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">source</span></code></dt><dd><p>(Optional, default to <code class="docutils literal notranslate"><span class="pre">['.']</span></code>)
This is the list of paths for the sources to be checked by this step.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enable</span></code></dt><dd><p>(Optional)
Use this to give a list of the message classes that should be in cppcheck report.
See the cppcheck man page for more information.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">inconclusive</span></code></dt><dd><p>(Optional)
Set this to <code class="docutils literal notranslate"><span class="pre">True</span></code> if you want cppcheck to also report inconclusive results.
See the cppcheck man page for more information.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">extra_args</span></code></dt><dd><p>(Optional)
This is the list of extra arguments to be given to the cppcheck command.</p>
</dd>
</dl>
<p>All other arguments are identical to <a href="#id102"><span class="problematic" id="id103">:bb:step:`ShellCommand`</span></a>.</p>
</div>
<div class="section" id="robocopy">
<h3><a class="toc-backref" href="#id255">Robocopy</a><a class="headerlink" href="#robocopy" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.mswin.Robocopy">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.mswin.</code><code class="sig-name descname">Robocopy</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.mswin.Robocopy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This step runs <code class="docutils literal notranslate"><span class="pre">robocopy</span></code> on Windows.</p>
<p><a class="reference external" href="https://technet.microsoft.com/en-us/library/cc733145.aspx">Robocopy</a> is available in versions of Windows starting with Windows Vista and Windows Server 2008.
For previous versions of Windows, it’s available as part of the <a class="reference external" href="https://www.microsoft.com/en-us/download/details.aspx?id=17657">Windows Server 2003 Resource Kit Tools</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">Robocopy</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;deploy_binaries&#39;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Deploying binaries...&#39;</span><span class="p">,</span>
        <span class="n">descriptionDone</span><span class="o">=</span><span class="s1">&#39;Deployed binaries.&#39;</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;Build</span><span class="se">\\</span><span class="s1">Bin</span><span class="se">\\</span><span class="s1">%(prop:configuration)s&#39;</span><span class="p">),</span>
        <span class="n">destination</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;%(prop:deploy_dir)</span><span class="se">\\</span><span class="s1">Bin</span><span class="se">\\</span><span class="s1">%(prop:configuration)s&#39;</span><span class="p">),</span>
        <span class="n">mirror</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Available constructor arguments are:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">source</span></code></dt><dd><p>The path to the source directory (mandatory).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">destination</span></code></dt><dd><p>The path to the destination directory (mandatory).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">files</span></code></dt><dd><p>An array of file names or patterns to copy.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">recursive</span></code></dt><dd><p>Copy files and directories recursively (<code class="docutils literal notranslate"><span class="pre">/E</span></code> parameter).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mirror</span></code></dt><dd><p>Mirror the source directory in the destination directory, including removing files that don’t exist anymore (<code class="docutils literal notranslate"><span class="pre">/MIR</span></code> parameter).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">move</span></code></dt><dd><p>Delete the source directory after the copy is complete (<code class="docutils literal notranslate"><span class="pre">/MOVE</span></code> parameter).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">exclude_files</span></code></dt><dd><p>An array of file names or patterns to exclude from the copy (<code class="docutils literal notranslate"><span class="pre">/XF</span></code> parameter).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">exclude_dirs</span></code></dt><dd><p>An array of directory names or patterns to exclude from the copy (<code class="docutils literal notranslate"><span class="pre">/XD</span></code> parameter).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">custom_opts</span></code></dt><dd><p>An array of custom parameters to pass directly to the <code class="docutils literal notranslate"><span class="pre">robocopy</span></code> command.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">verbose</span></code></dt><dd><p>Whether to output verbose information (<code class="docutils literal notranslate"><span class="pre">/V</span> <span class="pre">/TS</span> <span class="pre">/FP</span></code> parameters).</p>
</dd>
</dl>
<p>Note that parameters <code class="docutils literal notranslate"><span class="pre">/TEE</span> <span class="pre">/NP</span></code> will always be appended to the command to signify, respectively, to output logging to the console, use Unicode logging, and not print any percentage progress information for each file.</p>
</div>
<div class="section" id="test">
<h3><a class="toc-backref" href="#id256">Test</a><a class="headerlink" href="#test" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Test</span><span class="p">())</span>
</pre></div>
</div>
<p>This is meant to handle unit tests.
The default command is <strong class="command">make test</strong>, and the <code class="docutils literal notranslate"><span class="pre">warnOnFailure</span></code> flag is set.
The other arguments are identical to <a href="#id105"><span class="problematic" id="id106">:bb:step:`ShellCommand`</span></a>.</p>
</div>
<div class="section" id="treesize">
<span id="index-26"></span><h3><a class="toc-backref" href="#id257">TreeSize</a><a class="headerlink" href="#treesize" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">TreeSize</span><span class="p">())</span>
</pre></div>
</div>
<p>This is a simple command that uses the <strong class="command">du</strong> tool to measure the size of the code tree.
It puts the size (as a count of 1024-byte blocks, aka ‘KiB’ or ‘kibibytes’) on the step’s status text, and sets a build property named <code class="docutils literal notranslate"><span class="pre">tree-size-KiB</span></code> with the same value.
All arguments are identical to <a href="#id107"><span class="problematic" id="id108">:bb:step:`ShellCommand`</span></a>.</p>
</div>
<div class="section" id="perlmoduletest">
<h3><a class="toc-backref" href="#id258">PerlModuleTest</a><a class="headerlink" href="#perlmoduletest" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">PerlModuleTest</span><span class="p">())</span>
</pre></div>
</div>
<p>This is a simple command that knows how to run tests of perl modules.
It parses the output to determine the number of tests passed and failed and total number executed, saving the results for later query.
The command is <code class="docutils literal notranslate"><span class="pre">prove</span> <span class="pre">--lib</span> <span class="pre">lib</span> <span class="pre">-r</span> <span class="pre">t</span></code>, although this can be overridden with the <code class="docutils literal notranslate"><span class="pre">command</span></code> argument.
All other arguments are identical to those for <a href="#id109"><span class="problematic" id="id110">:bb:step:`ShellCommand`</span></a>.</p>
</div>
<div class="section" id="mtr-mysql-test-run">
<h3><a class="toc-backref" href="#id259">MTR (mysql-test-run)</a><a class="headerlink" href="#mtr-mysql-test-run" title="Permalink to this headline">¶</a></h3>
<p>The <a href="#id111"><span class="problematic" id="id112">:bb:step:`MTR`</span></a> class is a subclass of <a href="#id113"><span class="problematic" id="id114">:bb:step:`Test`</span></a>.
It is used to run test suites using the mysql-test-run program, as used in MySQL, Drizzle, MariaDB, and MySQL storage engine plugins.</p>
<p>The shell command to run the test suite is specified in the same way as for the <a href="#id115"><span class="problematic" id="id116">:bb:step:`Test`</span></a> class.
The <a href="#id117"><span class="problematic" id="id118">:bb:step:`MTR`</span></a> class will parse the output of running the test suite, and use the count of tests executed so far to provide more accurate completion time estimates.
Any test failures that occur during the test are summarized on the Waterfall Display.</p>
<p>Server error logs are added as additional log files, useful to debug test failures.</p>
<p>Optionally, data about the test run and any test failures can be inserted into a database for further analysis and report generation.
To use this facility, create an instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.enterprise.adbapi.ConnectionPool</span></code> with connections to the database.
The necessary tables can be created automatically by setting <code class="docutils literal notranslate"><span class="pre">autoCreateTables</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>, or manually using the SQL found in the <a href="#id119"><span class="problematic" id="id120">:src:`mtrlogobserver.py &lt;master/buildbot/steps/mtrlogobserver.py&gt;`</span></a> source file.</p>
<p>One problem with specifying a database is that each reload of the configuration will get a new instance of <code class="docutils literal notranslate"><span class="pre">ConnectionPool</span></code> (even if the connection parameters are the same).
To avoid that Buildbot thinks the builder configuration has changed because of this, use the <code class="xref py py-class docutils literal notranslate"><span class="pre">steps.mtrlogobserver.EqConnectionPool</span></code> subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPool</span></code>, which implements an equality operation that avoids this problem.</p>
<p>Example use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">myPool</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">EqConnectionPool</span><span class="p">(</span><span class="s2">&quot;MySQLdb&quot;</span><span class="p">,</span> <span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;buildbot&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="s2">&quot;db&quot;</span><span class="p">)</span>
<span class="n">myFactory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MTR</span><span class="p">(</span><span class="n">workdir</span><span class="o">=</span><span class="s2">&quot;mysql-test&quot;</span><span class="p">,</span> <span class="n">dbpool</span><span class="o">=</span><span class="n">myPool</span><span class="p">,</span>
                            <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;perl&quot;</span><span class="p">,</span> <span class="s2">&quot;mysql-test-run.pl&quot;</span><span class="p">,</span> <span class="s2">&quot;--force&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>The <a href="#id121"><span class="problematic" id="id122">:bb:step:`MTR`</span></a> step’s arguments are:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">textLimit</span></code></dt><dd><p>Maximum number of test failures to show on the waterfall page (to not flood the page in case of a large number of test failures.
Defaults to 5.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">testNameLimit</span></code></dt><dd><p>Maximum length of test names to show unabbreviated in the waterfall page, to avoid excessive column width.
Defaults to 16.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">parallel</span></code></dt><dd><p>Value of option <cite>–parallel</cite> option used for <code class="file docutils literal notranslate"><span class="pre">mysql-test-run.pl</span></code> (number of processes used to run the test suite in parallel).
Defaults to 4.
This is used to determine the number of server error log files to download from the worker.
Specifying a too high value does not hurt (as nonexistent error logs will be ignored), however if using option <cite>–parallel</cite> value greater than the default it needs to be specified, or some server error logs will be missing.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dbpool</span></code></dt><dd><p>An instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.enterprise.adbapi.ConnectionPool</span></code>, or <code class="docutils literal notranslate"><span class="pre">None</span></code>.
Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>.
If specified, results are inserted into the database using the <code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPool</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">autoCreateTables</span></code></dt><dd><p>Boolean, defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.
If <code class="docutils literal notranslate"><span class="pre">True</span></code> (and <code class="docutils literal notranslate"><span class="pre">dbpool</span></code> is specified), the necessary database tables will be created automatically if they do not exist already.
Alternatively, the tables can be created manually from the SQL statements found in the <a href="#id123"><span class="problematic" id="id124">:src:`mtrlogobserver.py &lt;master/buildbot/steps/mtrlogobserver.py&gt;`</span></a> source file.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">test_type</span></code></dt><dd><p>Short string that will be inserted into the database in the row for the test run.
Defaults to the empty string, but can be specified to identify different types of test runs.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">test_info</span></code></dt><dd><p>Descriptive string that will be inserted into the database in the row for the test run.
Defaults to the empty string, but can be specified as a user-readable description of this particular test run.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mtr_subdir</span></code></dt><dd><p>The subdirectory in which to look for server error log files.
Defaults to <code class="file docutils literal notranslate"><span class="pre">mysql-test</span></code>, which is usually correct.
<a class="reference internal" href="properties.html#interpolate"><span class="std std-ref">Interpolate</span></a> is supported.</p>
</dd>
</dl>
</div>
<div class="section" id="subunitshellcommand">
<span id="step-subunitshellcommand"></span><h3><a class="toc-backref" href="#id260">SubunitShellCommand</a><a class="headerlink" href="#subunitshellcommand" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.subunit.SubunitShellCommand">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.subunit.</code><code class="sig-name descname">SubunitShellCommand</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.subunit.SubunitShellCommand" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This buildstep is similar to <a href="#id125"><span class="problematic" id="id126">:bb:step:`ShellCommand`</span></a>, except that it runs the log content through a subunit filter to extract test and failure counts.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">SubunitShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s2">&quot;make test&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This runs <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> and filters it through subunit.
The ‘tests’ and ‘test failed’ progress metrics will now accumulate test data from the test run.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">failureOnNoTests</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, this step will fail if no test is run.
By default <code class="docutils literal notranslate"><span class="pre">failureOnNoTests</span></code> is False.</p>
</div>
</div>
<div class="section" id="worker-filesystem-steps">
<span id="id127"></span><h2><a class="toc-backref" href="#id261"><span class="section-number">2.5.11.5. </span>Worker Filesystem Steps</a><a class="headerlink" href="#worker-filesystem-steps" title="Permalink to this headline">¶</a></h2>
<p>Here are some buildsteps for manipulating the worker’s filesystem.</p>
<div class="section" id="fileexists">
<h3><a class="toc-backref" href="#id262">FileExists</a><a class="headerlink" href="#fileexists" title="Permalink to this headline">¶</a></h3>
<p>This step will assert that a given file exists, failing if it does not.
The filename can be specified with a property.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">FileExists</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;test_data&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>This step requires worker version 0.8.4 or later.</p>
</div>
<div class="section" id="copydirectory">
<h3><a class="toc-backref" href="#id263">CopyDirectory</a><a class="headerlink" href="#copydirectory" title="Permalink to this headline">¶</a></h3>
<p>This command copies a directory on the worker.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">CopyDirectory</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s2">&quot;build/data&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;tmp/data&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This step requires worker version 0.8.5 or later.</p>
<p>The CopyDirectory step takes the following arguments:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">timeout</span></code></dt><dd><p>if the copy command fails to produce any output for this many seconds, it is assumed to be locked up and will be killed.
This defaults to 120 seconds.
Pass <code class="docutils literal notranslate"><span class="pre">None</span></code> to disable.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">maxTime</span></code></dt><dd><p>if the command takes longer than this many seconds, it will be killed.
This is disabled by default.</p>
</dd>
</dl>
</div>
<div class="section" id="removedirectory">
<h3><a class="toc-backref" href="#id264">RemoveDirectory</a><a class="headerlink" href="#removedirectory" title="Permalink to this headline">¶</a></h3>
<p>This command recursively deletes a directory on the worker.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">RemoveDirectory</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="s2">&quot;build/build&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This step requires worker version 0.8.4 or later.</p>
</div>
<div class="section" id="makedirectory">
<h3><a class="toc-backref" href="#id265">MakeDirectory</a><a class="headerlink" href="#makedirectory" title="Permalink to this headline">¶</a></h3>
<p>This command creates a directory on the worker.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MakeDirectory</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="s2">&quot;build/build&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This step requires worker version 0.8.5 or later.</p>
</div>
</div>
<div class="section" id="python-buildsteps">
<span id="id128"></span><h2><a class="toc-backref" href="#id266"><span class="section-number">2.5.11.6. </span>Python BuildSteps</a><a class="headerlink" href="#python-buildsteps" title="Permalink to this headline">¶</a></h2>
<p>Here are some <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>s that are specifically useful for projects
implemented in Python.</p>
<div class="section" id="buildepydoc">
<span id="step-buildepydoc"></span><h3><a class="toc-backref" href="#id267">BuildEPYDoc</a><a class="headerlink" href="#buildepydoc" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.python.BuildEPYDoc">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.python.</code><code class="sig-name descname">BuildEPYDoc</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.python.BuildEPYDoc" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="http://epydoc.sourceforge.net/">epydoc</a> is a tool for generating
API documentation for Python modules from their docstrings.
It reads all the <code class="file docutils literal notranslate"><span class="pre">.py</span></code> files from your source tree, processes the docstrings therein, and creates a large tree of <code class="file docutils literal notranslate"><span class="pre">.html</span></code> files (or a single <code class="file docutils literal notranslate"><span class="pre">.pdf</span></code> file).</p>
<p>The <a href="#id129"><span class="problematic" id="id130">:bb:step:`BuildEPYDoc`</span></a> step will run <strong class="command">epydoc</strong> to produce this API documentation, and will count the errors and warnings from its output.</p>
<p>You must supply the command line to be used.
The default is <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">epydocs</span></code>, which assumes that your project has a <code class="file docutils literal notranslate"><span class="pre">Makefile</span></code> with an <cite>epydocs</cite> target.
You might wish to use something like <code class="samp docutils literal notranslate"><span class="pre">epydoc</span> <span class="pre">-o</span> <span class="pre">apiref</span> <span class="pre">source/</span><em><span class="pre">PKGNAME</span></em></code> instead.
You might also want to add option <cite>–pdf</cite> to generate a PDF file instead of a large tree of HTML files.</p>
<p>The API docs are generated in-place in the build tree (under the workdir, in the subdirectory controlled by the option <cite>-o</cite> argument).
To make them useful, you will probably have to copy them to somewhere they can be read.
For example if you have server with configured nginx web server, you can place generated docs to it’s public folder with command like <code class="docutils literal notranslate"><span class="pre">rsync</span> <span class="pre">-ad</span> <span class="pre">apiref/</span> <span class="pre">dev.example.com:~/usr/share/nginx/www/current-apiref/</span></code>.
You might instead want to bundle them into a tarball and publish it in the same place where the generated install tarball is placed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">BuildEPYDoc</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;epydoc&quot;</span><span class="p">,</span> <span class="s2">&quot;-o&quot;</span><span class="p">,</span> <span class="s2">&quot;apiref&quot;</span><span class="p">,</span> <span class="s2">&quot;source/mypkg&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="section" id="pyflakes">
<span id="step-pyflake"></span><h3><a class="toc-backref" href="#id268">PyFlakes</a><a class="headerlink" href="#pyflakes" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.python.PyFlakes">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.python.</code><code class="sig-name descname">PyFlakes</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.python.PyFlakes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="https://launchpad.net/pyflakes">PyFlakes</a> is a tool to perform basic static analysis of Python code to look for simple errors, like missing imports and references of undefined names.
It is like a fast and simple form of the C <strong class="command">lint</strong> program.
Other tools (like <a class="reference external" href="http://pychecker.sourceforge.net/">pychecker</a>) provide more detailed results but take longer to run.</p>
<p>The <a href="#id132"><span class="problematic" id="id133">:bb:step:`PyFlakes`</span></a> step will run pyflakes and count the various kinds of errors and warnings it detects.</p>
<p>You must supply the command line to be used.
The default is <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">pyflakes</span></code>, which assumes you have a top-level <code class="file docutils literal notranslate"><span class="pre">Makefile</span></code> with a <code class="docutils literal notranslate"><span class="pre">pyflakes</span></code> target.
You might want to use something like <code class="docutils literal notranslate"><span class="pre">pyflakes</span> <span class="pre">.</span></code> or <code class="docutils literal notranslate"><span class="pre">pyflakes</span> <span class="pre">src</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">PyFlakes</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pyflakes&quot;</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="section" id="sphinx">
<span id="step-sphinx"></span><h3><a class="toc-backref" href="#id269">Sphinx</a><a class="headerlink" href="#sphinx" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.python.Sphinx">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.python.</code><code class="sig-name descname">Sphinx</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.python.Sphinx" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="https://www.sphinx-doc.org/en/master/">Sphinx</a> is the Python Documentation Generator.
It uses <a class="reference external" href="http://docutils.sourceforge.net/rst.html">RestructuredText</a> as input format.</p>
<p>The <a href="#id135"><span class="problematic" id="id136">:bb:step:`Sphinx`</span></a> step will run <strong class="program">sphinx-build</strong> or any other program specified in its <code class="docutils literal notranslate"><span class="pre">sphinx</span></code> argument and count the various warnings and error it detects.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Sphinx</span><span class="p">(</span><span class="n">sphinx_builddir</span><span class="o">=</span><span class="s2">&quot;_build&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This step takes the following arguments:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">sphinx_builddir</span></code></dt><dd><p>(required) Name of the directory where the documentation will be generated.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sphinx_sourcedir</span></code></dt><dd><p>(optional, defaulting to <code class="docutils literal notranslate"><span class="pre">.</span></code>), Name the directory where the <code class="file docutils literal notranslate"><span class="pre">conf.py</span></code> file will be found</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sphinx_builder</span></code></dt><dd><p>(optional) Indicates the builder to use.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sphinx</span></code></dt><dd><p>(optional, defaulting to <strong class="program">sphinx-build</strong>) Indicates the executable to run.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tags</span></code></dt><dd><p>(optional) List of <code class="docutils literal notranslate"><span class="pre">tags</span></code> to pass to <strong class="program">sphinx-build</strong></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">defines</span></code></dt><dd><p>(optional) Dictionary of defines to overwrite values of the <code class="file docutils literal notranslate"><span class="pre">conf.py</span></code> file.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">strict_warnings</span></code></dt><dd><p>(optional) Boolean, defaults to False. Treat all warnings as errors.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mode</span></code></dt><dd><p>(optional) String, one of <code class="docutils literal notranslate"><span class="pre">full</span></code> or <code class="docutils literal notranslate"><span class="pre">incremental</span></code> (the default).
If set to <code class="docutils literal notranslate"><span class="pre">full</span></code>, indicates to Sphinx to rebuild everything without re-using the previous build results.</p>
</dd>
</dl>
</div>
<div class="section" id="pylint">
<span id="step-pylint"></span><h3><a class="toc-backref" href="#id270">PyLint</a><a class="headerlink" href="#pylint" title="Permalink to this headline">¶</a></h3>
<p>Similarly, the <a href="#id137"><span class="problematic" id="id138">:bb:step:`PyLint`</span></a> step will run <strong class="command">pylint</strong> and analyze the results.</p>
<p>You must supply the command line to be used.
There is no default.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">PyLint</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pylint&quot;</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="section" id="trial">
<span id="step-trial"></span><h3><a class="toc-backref" href="#id271">Trial</a><a class="headerlink" href="#trial" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.python_twisted.Trial">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.python_twisted.</code><code class="sig-name descname">Trial</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.python_twisted.Trial" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This step runs a unit test suite using <strong class="command">trial</strong>, a unittest-like testing framework that is a component of Twisted Python.
Trial is used to implement Twisted’s own unit tests, and is the unittest-framework of choice for many projects that use Twisted internally.</p>
<p>Projects that use trial typically have all their test cases in a ‘test’ subdirectory of their top-level library directory.
For example, for a package <code class="docutils literal notranslate"><span class="pre">petmail</span></code>, the tests might be in <code class="file docutils literal notranslate"><span class="pre">petmail/test/test_*.py</span></code>.
More complicated packages (like Twisted itself) may have multiple test directories, like <code class="file docutils literal notranslate"><span class="pre">twisted/test/test_*.py</span></code> for the core functionality and <code class="file docutils literal notranslate"><span class="pre">twisted/mail/test/test_*.py</span></code> for the email-specific tests.</p>
<p>To run trial tests manually, you run the <strong class="command">trial</strong> executable and tell it where the test cases are located.
The most common way of doing this is with a module name.
For petmail, this might look like <strong class="command">trial petmail.test</strong>, which would locate all the <code class="file docutils literal notranslate"><span class="pre">test_*.py</span></code> files under <code class="file docutils literal notranslate"><span class="pre">petmail/test/</span></code>, running every test case it could find in them.
Unlike the <code class="docutils literal notranslate"><span class="pre">unittest.py</span></code> that comes with Python, it is not necessary to run the <code class="file docutils literal notranslate"><span class="pre">test_foo.py</span></code> as a script; you always let trial do the importing and running.
The step’s <code class="docutils literal notranslate"><span class="pre">tests`</span></code> parameter controls which tests trial will run: it can be a string or a list of strings.</p>
<p>To find the test cases, the Python search path must allow something like <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">petmail.test</span></code> to work.
For packages that don’t use a separate top-level <code class="file docutils literal notranslate"><span class="pre">lib</span></code> directory, <code class="docutils literal notranslate"><span class="pre">PYTHONPATH=.</span></code> will work, and will use the test cases (and the code they are testing) in-place.
<code class="docutils literal notranslate"><span class="pre">PYTHONPATH=build/lib</span></code> or <code class="docutils literal notranslate"><span class="pre">PYTHONPATH=build/lib.somearch</span></code> are also useful when you do a <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">build</span></code> step first.
The <code class="docutils literal notranslate"><span class="pre">testpath</span></code> attribute of this class controls what <span class="target" id="index-27"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> is set to before running <strong class="command">trial</strong>.</p>
<p>Trial has the ability, through the <code class="docutils literal notranslate"><span class="pre">--testmodule</span></code> flag, to run only the set of test cases named by special <code class="docutils literal notranslate"><span class="pre">test-case-name</span></code> tags in source files.
We can get the list of changed source files from our parent Build and provide them to trial, thus running the minimal set of test cases needed to cover the Changes.
This is useful for quick builds, especially in trees with a lot of test cases.
The <code class="docutils literal notranslate"><span class="pre">testChanges</span></code> parameter controls this feature: if set, it will override <code class="docutils literal notranslate"><span class="pre">tests</span></code>.</p>
<p>The trial executable itself is typically just <strong class="command">trial</strong>, and is typically found in the shell search path.
It can be overridden with the <code class="docutils literal notranslate"><span class="pre">trial</span></code> parameter.
This is useful for Twisted’s own unittests, which want to use the copy of bin/trial that comes with the sources.</p>
<p>To influence the version of Python being used for the tests, or to add flags to the command, set the <code class="docutils literal notranslate"><span class="pre">python</span></code> parameter.
This can be a string (like <code class="docutils literal notranslate"><span class="pre">python2.2</span></code>) or a list (like <code class="docutils literal notranslate"><span class="pre">['python2.3',</span> <span class="pre">'-Wall']</span></code>).</p>
<p>Trial creates and switches into a directory named <code class="file docutils literal notranslate"><span class="pre">_trial_temp/</span></code> before running the tests, and sends the twisted log (which includes all exceptions) to a file named <code class="file docutils literal notranslate"><span class="pre">test.log</span></code>.
This file will be pulled up to the master where it can be seen as part of the status output.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Trial</span><span class="p">(</span><span class="n">tests</span><span class="o">=</span><span class="s1">&#39;petmail.test&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Trial has the ability to run tests on several workers in parallel (beginning with Twisted 12.3.0).
Set <code class="docutils literal notranslate"><span class="pre">jobs</span></code> to the number of workers you want to run.
Note that running <strong class="command">trial</strong> in this way will create multiple log files (named <code class="file docutils literal notranslate"><span class="pre">test.N.log</span></code>, <code class="file docutils literal notranslate"><span class="pre">err.N.log</span></code> and <code class="file docutils literal notranslate"><span class="pre">out.N.log</span></code> starting with <code class="docutils literal notranslate"><span class="pre">N=0</span></code>) rather than a single <code class="file docutils literal notranslate"><span class="pre">test.log</span></code>.</p>
<p>This step takes the following arguments:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">jobs</span></code></dt><dd><p>(optional) Number of worker-resident trial workers to use when running the tests.
Defaults to 1 worker.
Only works with Twisted&gt;=12.3.0.</p>
</dd>
</dl>
</div>
<div class="section" id="removepycs">
<h3><a class="toc-backref" href="#id272">RemovePYCs</a><a class="headerlink" href="#removepycs" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.python_twisted.RemovePYCs">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.python_twisted.</code><code class="sig-name descname">RemovePYCs</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.python_twisted.RemovePYCs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This is a simple built-in step that will remove <code class="docutils literal notranslate"><span class="pre">.pyc</span></code> files from the workdir.
This is useful in builds that update their source (and thus do not automatically delete <code class="docutils literal notranslate"><span class="pre">.pyc</span></code> files) but where some part of the build process is dynamically searching for Python modules.
Notably, trial has a bad habit of finding old test modules.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">RemovePYCs</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="transferring-files">
<h2><a class="toc-backref" href="#id273"><span class="section-number">2.5.11.7. </span>Transferring Files</a><a class="headerlink" href="#transferring-files" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.FileUpload">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.transfer.</code><code class="sig-name descname">FileUpload</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.FileUpload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.FileDownload">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.transfer.</code><code class="sig-name descname">FileDownload</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.FileDownload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Most of the work involved in a build will take place on the worker.
But occasionally it is useful to do some work on the buildmaster side.
The most basic way to involve the buildmaster is simply to move a file from the worker to the master, or vice versa.
There are a pair of steps named <a href="#id139"><span class="problematic" id="id140">:bb:step:`FileUpload`</span></a> and <a href="#id141"><span class="problematic" id="id142">:bb:step:`FileDownload`</span></a> to provide this functionality.
<a href="#id143"><span class="problematic" id="id144">:bb:step:`FileUpload`</span></a> moves a file <em>up to</em> the master, while <a href="#id145"><span class="problematic" id="id146">:bb:step:`FileDownload`</span></a> moves a file <em>down from</em> the master.</p>
<p>As an example, let’s assume that there is a step which produces an HTML file within the source tree that contains some sort of generated project documentation.
And let’s assume that we run nginx web server on buildmaster host for serving static files.
We want to move this file to the buildmaster, into a <code class="file docutils literal notranslate"><span class="pre">/usr/share/nginx/www/</span></code> directory, so it can be visible to developers.
This file will wind up in the worker-side working directory under the name <code class="file docutils literal notranslate"><span class="pre">docs/reference.html</span></code>.
We want to put it into the master-side <code class="file docutils literal notranslate"><span class="pre">/usr/share/nginx/www/ref.html</span></code>, and add a link to the HTML status to the uploaded file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;docs&quot;</span><span class="p">]))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">FileUpload</span><span class="p">(</span><span class="n">workersrc</span><span class="o">=</span><span class="s2">&quot;docs/reference.html&quot;</span><span class="p">,</span>
                           <span class="n">masterdest</span><span class="o">=</span><span class="s2">&quot;/usr/share/nginx/www/ref.html&quot;</span><span class="p">,</span>
                           <span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://somesite/~buildbot/ref.html&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">masterdest=</span></code> argument will be passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">os.path.expanduser()</span></code>, so things like <code class="docutils literal notranslate"><span class="pre">~</span></code> will be expanded properly.
Non-absolute paths will be interpreted relative to the buildmaster’s base directory.
Likewise, the <code class="docutils literal notranslate"><span class="pre">workersrc=</span></code> argument will be expanded and interpreted relative to the builder’s working directory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The copied file will have the same permissions on the master as on the worker, look at the <code class="docutils literal notranslate"><span class="pre">mode=</span></code> parameter to set it differently.</p>
</div>
<p>To move a file from the master to the worker, use the <a href="#id147"><span class="problematic" id="id148">:bb:step:`FileDownload`</span></a> command.
For example, let’s assume that some step requires a configuration file that, for whatever reason, could not be recorded in the source code repository or generated on the worker side:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">FileDownload</span><span class="p">(</span><span class="n">mastersrc</span><span class="o">=</span><span class="s2">&quot;~/todays_build_config.txt&quot;</span><span class="p">,</span>
                             <span class="n">workerdest</span><span class="o">=</span><span class="s2">&quot;build_config.txt&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>Like <a href="#id149"><span class="problematic" id="id150">:bb:step:`FileUpload`</span></a>, the <code class="docutils literal notranslate"><span class="pre">mastersrc=</span></code> argument is interpreted relative to the buildmaster’s base directory, and the <code class="docutils literal notranslate"><span class="pre">workerdest=</span></code> argument is relative to the builder’s working directory.
If the worker is running in <code class="file docutils literal notranslate"><span class="pre">~worker</span></code>, and the builder’s <code class="docutils literal notranslate"><span class="pre">builddir</span></code> is something like <code class="file docutils literal notranslate"><span class="pre">tests-i386</span></code>, then the workdir is going to be <code class="file docutils literal notranslate"><span class="pre">~worker/tests-i386/build</span></code>, and a <code class="docutils literal notranslate"><span class="pre">workerdest=</span></code> of <code class="file docutils literal notranslate"><span class="pre">foo/bar.html</span></code> will get put in <code class="file docutils literal notranslate"><span class="pre">~worker/tests-i386/build/foo/bar.html</span></code>.
Both of these commands will create any missing intervening directories.</p>
<div class="section" id="other-parameters">
<h3><a class="toc-backref" href="#id274">Other Parameters</a><a class="headerlink" href="#other-parameters" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">maxsize=</span></code> argument lets you set a maximum size for the file to be transferred.
This may help to avoid surprises: transferring a 100MB coredump when you were expecting to move a 10kB status file might take an awfully long time.
The <code class="docutils literal notranslate"><span class="pre">blocksize=</span></code> argument controls how the file is sent over the network: larger blocksizes are slightly more efficient but also consume more memory on each end, and there is a hard-coded limit of about 640kB.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">mode=</span></code> argument allows you to control the access permissions of the target file, traditionally expressed as an octal integer.
The most common value is probably <code class="docutils literal notranslate"><span class="pre">0755</span></code>, which sets the <cite>x</cite> executable bit on the file (useful for shell scripts and the like).
The default value for <code class="docutils literal notranslate"><span class="pre">mode=</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>, which means the permission bits will default to whatever the umask of the writing process is.
The default umask tends to be fairly restrictive, but at least on the worker you can make it less restrictive with a <code class="docutils literal notranslate"><span class="pre">--umask</span></code> command-line option at creation time (<a class="reference internal" href="../installation/worker.html#worker-options"><span class="std std-ref">Worker Options</span></a>).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">keepstamp=</span></code> argument is a boolean that, when <code class="docutils literal notranslate"><span class="pre">True</span></code>, forces the modified and accessed time of the destination file to match the times of the source file.
When <code class="docutils literal notranslate"><span class="pre">False</span></code> (the default), the modified and accessed times of the destination file are set to the current time on the buildmaster.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">url=</span></code> argument allows you to specify an url that will be displayed in the HTML status.
The title of the url will be the name of the item transferred (directory for <code class="xref py py-class docutils literal notranslate"><span class="pre">DirectoryUpload</span></code> or file for <code class="xref py py-class docutils literal notranslate"><span class="pre">FileUpload</span></code>).
This allows the user to add a link to the uploaded item if that one is uploaded to an accessible place.</p>
<p>For <a href="#id151"><span class="problematic" id="id152">:bb:step:`FileUpload`</span></a>, the <code class="docutils literal notranslate"><span class="pre">urlText=</span></code> argument allows you to specify the url title that will be displayed in the web UI.</p>
</div>
<div class="section" id="transferring-directories">
<h3><a class="toc-backref" href="#id275">Transferring Directories</a><a class="headerlink" href="#transferring-directories" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.DirectoryUpload">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.transfer.</code><code class="sig-name descname">DirectoryUpload</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.DirectoryUpload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>To transfer complete directories from the worker to the master, there is a <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> named <a href="#id153"><span class="problematic" id="id154">:bb:step:`DirectoryUpload`</span></a>.
It works like <a href="#id155"><span class="problematic" id="id156">:bb:step:`FileUpload`</span></a>, just for directories.
However it does not support the <code class="docutils literal notranslate"><span class="pre">maxsize</span></code>, <code class="docutils literal notranslate"><span class="pre">blocksize</span></code> and <code class="docutils literal notranslate"><span class="pre">mode</span></code> arguments.
As an example, let’s assume an generated project documentation, which consists of many files (like the output of <strong class="command">doxygen</strong> or <strong class="command">epydoc</strong>).
And let’s assume that we run nginx web server on buildmaster host for serving static files.
We want to move the entire documentation to the buildmaster, into a <code class="file docutils literal notranslate"><span class="pre">/usr/share/nginx/www/docs</span></code> directory, and add a link to the uploaded documentation on the HTML status page.
On the worker-side the directory can be found under <code class="file docutils literal notranslate"><span class="pre">docs</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;docs&quot;</span><span class="p">]))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">DirectoryUpload</span><span class="p">(</span><span class="n">workersrc</span><span class="o">=</span><span class="s2">&quot;docs&quot;</span><span class="p">,</span>
                                <span class="n">masterdest</span><span class="o">=</span><span class="s2">&quot;/usr/share/nginx/www/docs&quot;</span><span class="p">,</span>
                                <span class="n">url</span><span class="o">=</span><span class="s2">&quot;~buildbot/docs&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The <a href="#id157"><span class="problematic" id="id158">:bb:step:`DirectoryUpload`</span></a> step will create all necessary directories and transfers empty directories, too.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">maxsize</span></code> and <code class="docutils literal notranslate"><span class="pre">blocksize</span></code> parameters are the same as for <a href="#id159"><span class="problematic" id="id160">:bb:step:`FileUpload`</span></a>, although note that the size of the transferred data is implementation-dependent, and probably much larger than you expect due to the encoding used (currently tar).</p>
<p>The optional <code class="docutils literal notranslate"><span class="pre">compress</span></code> argument can be given as <code class="docutils literal notranslate"><span class="pre">'gz'</span></code> or <code class="docutils literal notranslate"><span class="pre">'bz2'</span></code> to compress the datastream.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The permissions on the copied files will be the same on the master as originally on the worker, see option <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span> <span class="pre">--umask</span></code> to change the default one.</p>
</div>
</div>
<div class="section" id="transferring-multiple-files-at-once">
<h3><a class="toc-backref" href="#id276">Transferring Multiple Files At Once</a><a class="headerlink" href="#transferring-multiple-files-at-once" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.MultipleFileUpload">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.transfer.</code><code class="sig-name descname">MultipleFileUpload</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.MultipleFileUpload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>In addition to the <a href="#id161"><span class="problematic" id="id162">:bb:step:`FileUpload`</span></a> and <a href="#id163"><span class="problematic" id="id164">:bb:step:`DirectoryUpload`</span></a> steps there is the <a href="#id165"><span class="problematic" id="id166">:bb:step:`MultipleFileUpload`</span></a> step for uploading a bunch of files (and directories) in a single <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>.
The step supports all arguments that are supported by <a href="#id167"><span class="problematic" id="id168">:bb:step:`FileUpload`</span></a> and <a href="#id169"><span class="problematic" id="id170">:bb:step:`DirectoryUpload`</span></a>, but instead of a the single <code class="docutils literal notranslate"><span class="pre">workersrc</span></code> parameter it takes a (plural) <code class="docutils literal notranslate"><span class="pre">workersrcs</span></code> parameter.
This parameter should either be a list, something that can be rendered as a list or a string which will be converted to a list.
Additionally it supports the <code class="docutils literal notranslate"><span class="pre">glob</span></code> parameter if this parameter is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> all arguments in <code class="docutils literal notranslate"><span class="pre">workersrcs</span></code> will be parsed through <code class="docutils literal notranslate"><span class="pre">glob</span></code> and the results will be uploaded to <code class="docutils literal notranslate"><span class="pre">masterdest</span></code>.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">]))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;docs&quot;</span><span class="p">]))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MultipleFileUpload</span><span class="p">(</span><span class="n">workersrcs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;docs&quot;</span><span class="p">,</span> <span class="s2">&quot;test-results.html&quot;</span><span class="p">],</span>
                                   <span class="n">masterdest</span><span class="o">=</span><span class="s2">&quot;/usr/share/nginx/www/&quot;</span><span class="p">,</span>
                                   <span class="n">url</span><span class="o">=</span><span class="s2">&quot;~buildbot&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">url=</span></code> parameter, can be used to specify a link to be displayed in the HTML status of the step.</p>
<p>The way URLs are added to the step can be customized by extending the <a href="#id171"><span class="problematic" id="id172">:bb:step:`MultipleFileUpload`</span></a> class.
The <cite>allUploadsDone</cite> method is called after all files have been uploaded and sets the URL.
The <cite>uploadDone</cite> method is called once for each uploaded file and can be used to create file-specific links.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="k">class</span> <span class="nc">CustomFileUpload</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MultipleFileUpload</span><span class="p">):</span>
    <span class="n">linkTypes</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;.html&#39;</span><span class="p">,</span> <span class="s1">&#39;.txt&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">linkFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basename</span><span class="p">):</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkTypes</span>

    <span class="k">def</span> <span class="nf">uploadDone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">masterdest</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkFile</span><span class="p">(</span><span class="n">basename</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addURL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">basename</span><span class="p">,</span> <span class="n">basename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">allUploadsDone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">masterdest</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
            <span class="n">notLinked</span> <span class="o">=</span> <span class="p">[</span><span class="n">src</span> <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">sources</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkFile</span><span class="p">(</span><span class="n">src</span><span class="p">)]</span>
            <span class="n">numFiles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">notLinked</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numFiles</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addURL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="s1">&#39;... </span><span class="si">%d</span><span class="s1"> more&#39;</span> <span class="o">%</span> <span class="n">numFiles</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="transferring-strings">
<h2><a class="toc-backref" href="#id277"><span class="section-number">2.5.11.8. </span>Transferring Strings</a><a class="headerlink" href="#transferring-strings" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.StringDownload">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.transfer.</code><code class="sig-name descname">StringDownload</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.StringDownload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.JSONStringDownload">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.transfer.</code><code class="sig-name descname">JSONStringDownload</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.JSONStringDownload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.JSONPropertiesDownload">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.transfer.</code><code class="sig-name descname">JSONPropertiesDownload</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.JSONPropertiesDownload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Sometimes it is useful to transfer a calculated value from the master to the worker.
Instead of having to create a temporary file and then use FileDownload, you can use one of the string download steps.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">StringDownload</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;%(src::branch)s-%(prop:got_revision)s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="n">workerdest</span><span class="o">=</span><span class="s2">&quot;buildid.txt&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p><a href="#id173"><span class="problematic" id="id174">:bb:step:`StringDownload`</span></a> works just like <a href="#id175"><span class="problematic" id="id176">:bb:step:`FileDownload`</span></a> except it takes a single argument, <code class="docutils literal notranslate"><span class="pre">s</span></code>, representing the string to download instead of a <code class="docutils literal notranslate"><span class="pre">mastersrc</span></code> argument.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">buildinfo</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;branch&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="s1">&#39;branch&#39;</span><span class="p">),</span>
    <span class="s1">&#39;got_revision&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="s1">&#39;got_revision&#39;</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">JSONStringDownload</span><span class="p">(</span><span class="n">buildinfo</span><span class="p">,</span> <span class="n">workerdest</span><span class="o">=</span><span class="s2">&quot;buildinfo.json&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p><a href="#id177"><span class="problematic" id="id178">:bb:step:`JSONStringDownload`</span></a> is similar, except it takes an <code class="docutils literal notranslate"><span class="pre">o</span></code> argument, which must be JSON serializable, and transfers that as a JSON-encoded string to the worker.</p>
<div class="highlight-python notranslate" id="index-29"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">JSONPropertiesDownload</span><span class="p">(</span><span class="n">workerdest</span><span class="o">=</span><span class="s2">&quot;build-properties.json&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p><a href="#id179"><span class="problematic" id="id180">:bb:step:`JSONPropertiesDownload`</span></a> transfers a json-encoded string that represents a dictionary where properties maps to a dictionary of build property <code class="docutils literal notranslate"><span class="pre">name</span></code> to property <code class="docutils literal notranslate"><span class="pre">value</span></code>; and <code class="docutils literal notranslate"><span class="pre">sourcestamp</span></code> represents the build’s sourcestamp.</p>
</div>
<div class="section" id="running-commands-on-the-master">
<h2><a class="toc-backref" href="#id278"><span class="section-number">2.5.11.9. </span>Running Commands on the Master</a><a class="headerlink" href="#running-commands-on-the-master" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.master.MasterShellCommand">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.master.</code><code class="sig-name descname">MasterShellCommand</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.master.MasterShellCommand" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Occasionally, it is useful to execute some task on the master, for example to create a directory, deploy a build result, or trigger some other centralized processing.
This is possible, in a limited fashion, with the <a href="#id181"><span class="problematic" id="id182">:bb:step:`MasterShellCommand`</span></a> step.</p>
<p>This step operates similarly to a regular <a href="#id183"><span class="problematic" id="id184">:bb:step:`ShellCommand`</span></a>, but executes on the master, instead of the worker.
To be clear, the enclosing <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> object must still have a worker object, just as for any other step – only, in this step, the worker does not do anything.</p>
<p>In this example, the step renames a tarball based on the day of the week.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">FileUpload</span><span class="p">(</span><span class="n">workersrc</span><span class="o">=</span><span class="s2">&quot;widgetsoft.tar.gz&quot;</span><span class="p">,</span>
                     <span class="n">masterdest</span><span class="o">=</span><span class="s2">&quot;/var/buildoutputs/widgetsoft-new.tar.gz&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MasterShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="s2">&quot;mv widgetsoft-new.tar.gz widgetsoft-`date +%a`.tar.gz&quot;</span><span class="p">,</span>
    <span class="n">workdir</span><span class="o">=</span><span class="s2">&quot;/var/buildoutputs&quot;</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, this step passes a copy of the buildmaster’s environment variables to the subprocess.
To pass an explicit environment instead, add an <code class="docutils literal notranslate"><span class="pre">env={..}</span></code> argument.</p>
</div>
<p>Environment variables constructed using the <code class="docutils literal notranslate"><span class="pre">env</span></code> argument support expansion so that if you just want to prepend  <code class="file docutils literal notranslate"><span class="pre">/home/buildbot/bin</span></code> to the <span class="target" id="index-30"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code> environment variable, you can do it by putting the value <code class="docutils literal notranslate"><span class="pre">${PATH}</span></code> at the end of the value like in the example below.
Variables that don’t exist on the master will be replaced by <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MasterShellCommand</span><span class="p">(</span>
              <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;www&quot;</span><span class="p">],</span>
              <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;PATH&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/home/buildbot/bin&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;${PATH}&quot;</span><span class="p">]}))</span>
</pre></div>
</div>
<p>Note that environment values must be strings (or lists that are turned into strings).
In particular, numeric properties such as <code class="docutils literal notranslate"><span class="pre">buildnumber</span></code> must be substituted using <a class="reference internal" href="properties.html#interpolate"><span class="std std-ref">Interpolate</span></a>.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">workdir</span></code></dt><dd><p>(optional) The directory from which the command will be ran.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">interruptSignal</span></code></dt><dd><p>(optional) Signal to use to end the process, if the step is interrupted.</p>
</dd>
</dl>
<div class="section" id="logrenderable">
<h3><a class="toc-backref" href="#id279">LogRenderable</a><a class="headerlink" href="#logrenderable" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.master.LogRenderable">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.master.</code><code class="sig-name descname">LogRenderable</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.master.LogRenderable" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This build step takes content which can be renderable and logs it in a pretty-printed format.
It can be useful for debugging properties during a build.</p>
</div>
<div class="section" id="assert">
<h3><a class="toc-backref" href="#id280">Assert</a><a class="headerlink" href="#assert" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.master.Assert">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.master.</code><code class="sig-name descname">Assert</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.master.Assert" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This build step takes a Renderable or constant passed in as first argument. It will test if the expression evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code> and succeed the step or fail the step otherwise.</p>
</div>
</div>
<div class="section" id="setting-properties">
<span id="index-31"></span><span id="id185"></span><h2><a class="toc-backref" href="#id281"><span class="section-number">2.5.11.10. </span>Setting Properties</a><a class="headerlink" href="#setting-properties" title="Permalink to this headline">¶</a></h2>
<p>These steps set properties on the master based on information from the worker.</p>
<div class="section" id="setproperty">
<span id="step-setproperty"></span><h3><a class="toc-backref" href="#id282">SetProperty</a><a class="headerlink" href="#setproperty" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.master.SetProperty">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.master.</code><code class="sig-name descname">SetProperty</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.master.SetProperty" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a href="#id186"><span class="problematic" id="id187">:bb:step:`SetProperty`</span></a> takes two arguments of <code class="docutils literal notranslate"><span class="pre">property</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code> where the <code class="docutils literal notranslate"><span class="pre">value</span></code> is to be assigned to the <code class="docutils literal notranslate"><span class="pre">property</span></code> key.
It is usually called with the <code class="docutils literal notranslate"><span class="pre">value</span></code> argument being specified as a <a class="reference internal" href="properties.html#interpolate"><span class="std std-ref">Interpolate</span></a> object which allows the value to be built from other property values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">SetProperty</span><span class="p">(</span>
        <span class="nb">property</span><span class="o">=</span><span class="s2">&quot;SomeProperty&quot;</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;sch=%(prop:scheduler)s, worker=%(prop:workername)s&quot;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="setproperties-step">
<span id="step-setproperties"></span><h3><a class="toc-backref" href="#id283"><code class="xref py py-class docutils literal notranslate"><span class="pre">SetProperties</span></code> step</a><a class="headerlink" href="#setproperties-step" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt>
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.master.</code><code class="sig-name descname">SetProperty</code></dt>
<dd></dd></dl>

<p><a href="#id188"><span class="problematic" id="id189">:bb:step:`SetProperties`</span></a> takes a dictionary to be turned into build properties.</p>
<p>It is similar to <a href="#id190"><span class="problematic" id="id191">:bb:step:`SetProperty`</span></a>, and meant to be used with a <a class="reference internal" href="properties.html#renderer"><span class="std std-ref">Renderer</span></a> function or a dictionary of  <a class="reference internal" href="properties.html#interpolate"><span class="std std-ref">Interpolate</span></a> objects which allows the value to be built from other property values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Example borrowed from Julia&#39;s master.cfg</span>
<span class="sd">   https://github.com/staticfloat/julia-buildbot (MIT)&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="o">*</span>

<span class="nd">@util.renderer</span>
<span class="k">def</span> <span class="nf">compute_artifact_filename</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
    <span class="c1"># Get the output of the `make print-BINARYDIST_FILENAME` step</span>
    <span class="n">reported_filename</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;artifact_filename&#39;</span><span class="p">)</span>

    <span class="c1"># First, see if we got a BINARYDIST_FILENAME output</span>
    <span class="k">if</span> <span class="n">reported_filename</span><span class="p">[:</span><span class="mi">26</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;BINARYDIST_FILENAME=&quot;</span><span class="p">:</span>
        <span class="n">local_filename</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="n">reported_filename</span><span class="p">[</span><span class="mi">26</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span>
                                          <span class="s2">&quot;%(prop:os_pkg_ext)s&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If not, use non-sf/consistent_distnames naming</span>
        <span class="k">if</span> <span class="n">is_mac</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
            <span class="n">template</span> <span class="o">=</span> \
                <span class="s2">&quot;path/to/Julia-%(prop:version)s-%(prop:shortcommit)s.%(prop:os_pkg_ext)s&quot;</span>
        <span class="k">elif</span> <span class="n">is_winnt</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
            <span class="n">template</span> <span class="o">=</span> \
                <span class="s2">&quot;julia-%(prop:version)s-%(prop:tar_arch)s.%(prop:os_pkg_ext)s&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> \
                <span class="s2">&quot;julia-%(prop:shortcommit)s-Linux-%(prop:tar_arch)s.%(prop:os_pkg_ext)s&quot;</span>

        <span class="n">local_filename</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>

    <span class="c1"># upload_filename always follows sf/consistent_distname rules</span>
    <span class="n">upload_filename</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span>
        <span class="s2">&quot;julia-%(prop:shortcommit)s-%(prop:os_name)s%(prop:bits)s.%(prop:os_pkg_ext)s&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;local_filename&quot;</span><span class="p">:</span> <span class="n">local_filename</span>
        <span class="s2">&quot;upload_filename&quot;</span><span class="p">:</span> <span class="n">upload_filename</span>
    <span class="p">}</span>

<span class="n">f1</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">SetProperties</span><span class="p">(</span><span class="n">properties</span><span class="o">=</span><span class="n">compute_artifact_filename</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="setpropertyfromcommand">
<h3><a class="toc-backref" href="#id284">SetPropertyFromCommand</a><a class="headerlink" href="#setpropertyfromcommand" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.shell.SetPropertyFromCommand">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.shell.</code><code class="sig-name descname">SetPropertyFromCommand</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.shell.SetPropertyFromCommand" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This buildstep is similar to <a href="#id192"><span class="problematic" id="id193">:bb:step:`ShellCommand`</span></a>, except that it captures the output of the command into a property.
It is usually used like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">SetPropertyFromCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s2">&quot;uname -a&quot;</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="s2">&quot;uname&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This runs <code class="docutils literal notranslate"><span class="pre">uname</span> <span class="pre">-a</span></code> and captures its stdout, stripped of leading and trailing whitespace, in the property <code class="docutils literal notranslate"><span class="pre">uname</span></code>.
To avoid stripping, add <code class="docutils literal notranslate"><span class="pre">strip=False</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">property</span></code> argument can be specified as a  <a class="reference internal" href="properties.html#interpolate"><span class="std std-ref">Interpolate</span></a> object, allowing the property name to be built from other property values.</p>
<p>Passing <code class="docutils literal notranslate"><span class="pre">includeStdout=False</span></code> (default <code class="docutils literal notranslate"><span class="pre">True</span></code>) stops capture from stdout.</p>
<p>Passing <code class="docutils literal notranslate"><span class="pre">includeStderr=True</span></code> (default <code class="docutils literal notranslate"><span class="pre">False</span></code>) allows capture from stderr.</p>
<p>The more advanced usage allows you to specify a function to extract properties from the command output.
Here you can use regular expressions, string interpolation, or whatever you would like.
In this form, <code class="xref py py-func docutils literal notranslate"><span class="pre">extract_fn()</span></code> should be passed, and not <code class="xref py py-class docutils literal notranslate"><span class="pre">Property</span></code>.
The <code class="xref py py-func docutils literal notranslate"><span class="pre">extract_fn()</span></code> function is called with three arguments: the exit status of the command, its standard output as a string, and its standard error as a string.
It should return a dictionary containing all new properties.</p>
<p>Note that passing in <code class="xref py py-func docutils literal notranslate"><span class="pre">extract_fn()</span></code> will set <code class="docutils literal notranslate"><span class="pre">includeStderr</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">glob2list</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">):</span>
    <span class="n">jpgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;jpgs&#39;</span><span class="p">:</span> <span class="n">jpgs</span><span class="p">}</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">SetPropertyFromCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s2">&quot;ls -1 *.jpg&quot;</span><span class="p">,</span> <span class="n">extract_fn</span><span class="o">=</span><span class="n">glob2list</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that any ordering relationship of the contents of stdout and stderr is lost.
For example, given:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">SetPropertyFromCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="s2">&quot;echo output1; echo error &gt;&amp;2; echo output2&quot;</span><span class="p">,</span>
    <span class="n">extract_fn</span><span class="o">=</span><span class="n">my_extract</span><span class="p">))</span>
</pre></div>
</div>
<p>Then <code class="docutils literal notranslate"><span class="pre">my_extract</span></code> will see <code class="docutils literal notranslate"><span class="pre">stdout=&quot;output1\noutput2\n&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">stderr=&quot;error\n&quot;</span></code>.</p>
<p>Avoid using the <code class="docutils literal notranslate"><span class="pre">extract_fn</span></code> form of this step with commands that produce a great deal of output, as the output is buffered in memory until complete.</p>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.worker.SetPropertiesFromEnv">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.worker.</code><code class="sig-name descname">SetPropertiesFromEnv</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.worker.SetPropertiesFromEnv" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="setpropertiesfromenv">
<h3><a class="toc-backref" href="#id285">SetPropertiesFromEnv</a><a class="headerlink" href="#setpropertiesfromenv" title="Permalink to this headline">¶</a></h3>
<p>Buildbot workers (later than version 0.8.3) provide their environment variables to the master on connect.
These can be copied into Buildbot properties with the <a href="#id194"><span class="problematic" id="id195">:bb:step:`SetPropertiesFromEnv`</span></a> step.
Pass a variable or list of variables in the <code class="docutils literal notranslate"><span class="pre">variables</span></code> parameter, then simply use the values as properties in a later step.</p>
<p>Note that on Windows, environment variables are case-insensitive, but Buildbot property names are case sensitive.
The property will have exactly the variable name you specify, even if the underlying environment variable is capitalized differently.
If, for example, you use <code class="docutils literal notranslate"><span class="pre">variables=['Tmp']</span></code>, the result will be a property named <code class="docutils literal notranslate"><span class="pre">Tmp</span></code>, even though the environment variable is displayed as <span class="target" id="index-32"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">TMP</span></code> in the Windows GUI.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">SetPropertiesFromEnv</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;SOME_JAVA_LIB_HOME&quot;</span><span class="p">,</span> <span class="s2">&quot;JAVAC&quot;</span><span class="p">]))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Compile</span><span class="p">(</span><span class="n">commands</span><span class="o">=</span><span class="p">[</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;%(prop:JAVAC)s&quot;</span><span class="p">),</span>
                                  <span class="s2">&quot;-cp&quot;</span><span class="p">,</span>
                                  <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;%(prop:SOME_JAVA_LIB_HOME)s&quot;</span><span class="p">)]))</span>
</pre></div>
</div>
<p>Note that this step requires that the worker be at least version 0.8.3.
For previous versions, no environment variables are available (the worker environment will appear to be empty).</p>
</div>
</div>
<div class="section" id="triggering-schedulers">
<span id="id196"></span><h2><a class="toc-backref" href="#id286"><span class="section-number">2.5.11.11. </span>Triggering Schedulers</a><a class="headerlink" href="#triggering-schedulers" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.trigger.Trigger">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.steps.trigger.</code><code class="sig-name descname">Trigger</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.trigger.Trigger" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The counterpart to the <a href="#id197"><span class="problematic" id="id198">:bb:Sched:`Triggerable`</span></a> scheduler is the <a href="#id199"><span class="problematic" id="id200">:bb:step:`Trigger`</span></a> build step:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">schedulerNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;build-prep&#39;</span><span class="p">],</span>
                        <span class="n">waitForFinish</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">updateSourceStamp</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">set_properties</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;quick&#39;</span> <span class="p">:</span> <span class="bp">False</span> <span class="p">}))</span>
</pre></div>
</div>
<p>The SourceStamps to use for the triggered build are controlled by the arguments <code class="docutils literal notranslate"><span class="pre">updateSourceStamp</span></code>, <code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code>, and <code class="docutils literal notranslate"><span class="pre">sourceStamps</span></code>.</p>
<p>Hyperlinks are added to the build detail web pages for each triggered build.</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">schedulerNames</span></code></dt><dd><p>lists the <a href="#id201"><span class="problematic" id="id202">:bb:sched:`Triggerable`</span></a> schedulers that should be triggered when this step is executed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is possible, but not advisable, to create a cycle where a build continually triggers itself, because the schedulers are specified by name.</p>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unimportantSchedulerNames</span></code></dt><dd><p>When <code class="docutils literal notranslate"><span class="pre">waitForFinish</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, all schedulers in this list will not cause the trigger step to fail. unimportantSchedulerNames must be a subset of schedulerNames
If <code class="docutils literal notranslate"><span class="pre">waitForFinish</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>, unimportantSchedulerNames will simply be ignored.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">waitForFinish</span></code></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, the step will not finish until all of the builds from the triggered schedulers have finished.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">False</span></code> (the default) or not given, then the buildstep succeeds immediately after triggering the schedulers.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">updateSourceStamp</span></code></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">True</span></code> (the default), then step updates the source stamps given to the <a href="#id203"><span class="problematic" id="id204">:bb:sched:`Triggerable`</span></a> schedulers to include <code class="docutils literal notranslate"><span class="pre">got_revision</span></code> (the revision actually used in this build) as <code class="docutils literal notranslate"><span class="pre">revision</span></code> (the revision to use in the triggered builds).
This is useful to ensure that all of the builds use exactly the same source stamps, even if other <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>s have occurred while the build was running.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">False</span></code> (and neither of the other arguments are specified), then the exact same SourceStamps are used.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then no SourceStamps are given, corresponding to using the latest revisions of the repositories specified in the Source steps.
This is useful if the triggered builds use to a different source repository.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sourceStamps</span></code></dt><dd><p>Accepts a list of dictionaries containing the keys <code class="docutils literal notranslate"><span class="pre">branch</span></code>, <code class="docutils literal notranslate"><span class="pre">revision</span></code>, <code class="docutils literal notranslate"><span class="pre">repository</span></code>, <code class="docutils literal notranslate"><span class="pre">project</span></code>, and optionally <code class="docutils literal notranslate"><span class="pre">patch_level</span></code>, <code class="docutils literal notranslate"><span class="pre">patch_body</span></code>, <code class="docutils literal notranslate"><span class="pre">patch_subdir</span></code>, <code class="docutils literal notranslate"><span class="pre">patch_author</span></code> and <code class="docutils literal notranslate"><span class="pre">patch_comment</span></code> and creates the corresponding SourceStamps.
If only one sourceStamp has to be specified then the argument <code class="docutils literal notranslate"><span class="pre">sourceStamp</span></code> can be used for a dictionary containing the keys mentioned above.
The arguments <code class="docutils literal notranslate"><span class="pre">updateSourceStamp</span></code>, <code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code>, and <code class="docutils literal notranslate"><span class="pre">sourceStamp</span></code> can be specified using properties.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">set_properties</span></code></dt><dd><p>allows control of the properties that are passed to the triggered scheduler.
The parameter takes a dictionary mapping property names to values.
You may use <a class="reference internal" href="properties.html#interpolate"><span class="std std-ref">Interpolate</span></a> here to dynamically construct new property values.
For the simple case of copying a property, this might look like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">set_properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;my_prop1&quot;</span> <span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="s2">&quot;my_prop1&quot;</span><span class="p">),</span>
                <span class="s2">&quot;my_prop2&quot;</span> <span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="s2">&quot;my_prop2&quot;</span><span class="p">)}</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">Property</span></code> is an instance of <code class="docutils literal notranslate"><span class="pre">buildbot.process.properties.Property</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">copy_properties</span></code> parameter, given a list of properties to copy into the new build request, has been deprecated in favor of explicit use of <code class="docutils literal notranslate"><span class="pre">set_properties</span></code>.</p>
</div>
</dd>
</dl>
<div class="section" id="dynamic-trigger">
<span id="id205"></span><h3><a class="toc-backref" href="#id287">Dynamic Trigger</a><a class="headerlink" href="#dynamic-trigger" title="Permalink to this headline">¶</a></h3>
<p>Sometimes it is desirable to select which scheduler to trigger, and which properties to set dynamically, at the time of the build.
For this purpose, Trigger step supports a method that you can customize in order to override statically defined <code class="docutils literal notranslate"><span class="pre">schedulernames</span></code>, <code class="docutils literal notranslate"><span class="pre">set_properties</span></code> and optionally <code class="docutils literal notranslate"><span class="pre">unimportant</span></code>.</p>
<dl class="method">
<dt id="buildbot.steps.source.getSchedulersAndProperties">
<code class="sig-prename descclassname">buildbot.steps.source.</code><code class="sig-name descname">getSchedulersAndProperties</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.steps.source.getSchedulersAndProperties" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>list of dictionaries containing the keys ‘sched_name’, ‘props_to_set’ and ‘unimportant’ optionally via deferred</p>
</dd>
</dl>
<p>This method returns a list of dictionaries describing what scheduler to trigger, with which properties and if the scheduler is unimportant.
Old style list of tuples is still supported, in which case unimportant is considered <code class="docutils literal notranslate"><span class="pre">False</span></code>.
The properties should already be rendered (ie, concrete value, not objects wrapped by <code class="docutils literal notranslate"><span class="pre">Interpolate</span></code> or
<code class="docutils literal notranslate"><span class="pre">Property</span></code>). Since this function happens at build-time, the property values are available from the
step and can be used to decide what schedulers or properties to use.</p>
<p>With this method, you can also trigger the same scheduler multiple times with different set of properties.
The sourcestamp configuration is however the same for each triggered build request.</p>
</dd></dl>

</div>
</div>
<div class="section" id="rpm-related-steps">
<h2><a class="toc-backref" href="#id288"><span class="section-number">2.5.11.12. </span>RPM-Related Steps</a><a class="headerlink" href="#rpm-related-steps" title="Permalink to this headline">¶</a></h2>
<p>These steps work with RPMs and spec files.</p>
<div class="section" id="rpmbuild">
<h3><a class="toc-backref" href="#id289">RpmBuild</a><a class="headerlink" href="#rpmbuild" title="Permalink to this headline">¶</a></h3>
<p>The <a href="#id206"><span class="problematic" id="id207">:bb:step:`RpmBuild`</span></a> step builds RPMs based on a spec file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">RpmBuild</span><span class="p">(</span><span class="n">specfile</span><span class="o">=</span><span class="s2">&quot;proj.spec&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;.el5&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The step takes the following parameters</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">specfile</span></code></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">.spec</span></code> file to build from</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">topdir</span></code></dt><dd><p>Definition for <code class="docutils literal notranslate"><span class="pre">_topdir</span></code>, defaulting to the workdir.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">builddir</span></code></dt><dd><p>Definition for <code class="docutils literal notranslate"><span class="pre">_builddir</span></code>, defaulting to the workdir.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rpmdir</span></code></dt><dd><p>Definition for <code class="docutils literal notranslate"><span class="pre">_rpmdir</span></code>, defaulting to the workdir.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sourcedir</span></code></dt><dd><p>Definition for <code class="docutils literal notranslate"><span class="pre">_sourcedir</span></code>, defaulting to the workdir.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">srcrpmdir</span></code></dt><dd><p>Definition for <code class="docutils literal notranslate"><span class="pre">_srcrpmdir</span></code>, defaulting to the workdir.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dist</span></code></dt><dd><p>Distribution to build, used as the definition for <code class="docutils literal notranslate"><span class="pre">_dist</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">define</span></code></dt><dd><p>A dictionary of additional definitions to declare.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">autoRelease</span></code></dt><dd><p>If true, use the auto-release mechanics.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">vcsRevision</span></code></dt><dd><p>If true, use the version-control revision mechanics.
This uses the <code class="docutils literal notranslate"><span class="pre">got_revision</span></code> property to determine the revision and define <code class="docutils literal notranslate"><span class="pre">_revision</span></code>.
Note that this will not work with multi-codebase builds.</p>
</dd>
</dl>
</div>
<div class="section" id="rpmlint">
<h3><a class="toc-backref" href="#id290">RpmLint</a><a class="headerlink" href="#rpmlint" title="Permalink to this headline">¶</a></h3>
<p>The <a href="#id208"><span class="problematic" id="id209">:bb:step:`RpmLint`</span></a> step checks for common problems in RPM packages or spec files:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">RpmLint</span><span class="p">())</span>
</pre></div>
</div>
<p>The step takes the following parameters</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">fileloc</span></code></dt><dd><p>The file or directory to check.
In case of a directory, it is recursively searched for RPMs and spec files to check.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">config</span></code></dt><dd><p>Path to a rpmlint config file.
This is passed as the user configuration file if present.</p>
</dd>
</dl>
</div>
<div class="section" id="mock-steps">
<h3><a class="toc-backref" href="#id291">Mock Steps</a><a class="headerlink" href="#mock-steps" title="Permalink to this headline">¶</a></h3>
<p>Mock (<a class="reference external" href="http://fedoraproject.org/wiki/Projects/Mock">http://fedoraproject.org/wiki/Projects/Mock</a>) creates chroots and builds packages in them.
It populates the changeroot with a basic system and the packages listed as build requirement.
The type of chroot to build is specified with the <code class="docutils literal notranslate"><span class="pre">root</span></code> parameter.
To use mock your Buildbot user must be added to the <code class="docutils literal notranslate"><span class="pre">mock</span></code> group.</p>
</div>
<div class="section" id="mockbuildsrpm-step">
<h3><a class="toc-backref" href="#id292">MockBuildSRPM Step</a><a class="headerlink" href="#mockbuildsrpm-step" title="Permalink to this headline">¶</a></h3>
<p>The <a href="#id210"><span class="problematic" id="id211">:bb:step:`MockBuildSRPM`</span></a> step builds a SourceRPM based on a spec file and optionally a source directory:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MockBuildSRPM</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="s1">&#39;mypkg.spec&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The step takes the following parameters</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">root</span></code></dt><dd><p>Use chroot configuration defined in <code class="docutils literal notranslate"><span class="pre">/etc/mock/&lt;root&gt;.cfg</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">resultdir</span></code></dt><dd><p>The directory where the logfiles and the SourceRPM are written to.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">spec</span></code></dt><dd><p>Build the SourceRPM from this spec file.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sources</span></code></dt><dd><p>Path to the directory containing the sources, defaulting to <code class="docutils literal notranslate"><span class="pre">.</span></code>.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is necessary to pass the <code class="docutils literal notranslate"><span class="pre">resultdir</span></code> parameter to let the master
watch for (and display) changes to <code class="file docutils literal notranslate"><span class="pre">build.log</span></code>,
<code class="file docutils literal notranslate"><span class="pre">root.log</span></code>, and <code class="file docutils literal notranslate"><span class="pre">state.log</span></code>.</p>
</div>
</div>
<div class="section" id="mockrebuild-step">
<h3><a class="toc-backref" href="#id293">MockRebuild Step</a><a class="headerlink" href="#mockrebuild-step" title="Permalink to this headline">¶</a></h3>
<p>The <a href="#id212"><span class="problematic" id="id213">:bb:step:`MockRebuild`</span></a> step rebuilds a SourceRPM package:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MockRebuild</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">srpm</span><span class="o">=</span><span class="s1">&#39;mypkg-1.0-1.src.rpm&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The step takes the following parameters</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">root</span></code></dt><dd><p>Uses chroot configuration defined in <code class="docutils literal notranslate"><span class="pre">/etc/mock/&lt;root&gt;.cfg</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">resultdir</span></code></dt><dd><p>The directory where the logfiles and the SourceRPM are written to.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">srpm</span></code></dt><dd><p>The path to the SourceRPM to rebuild.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is necessary to pass the <code class="docutils literal notranslate"><span class="pre">resultdir</span></code> parameter to let the master
watch for (and display) changes to <code class="file docutils literal notranslate"><span class="pre">build.log</span></code>,
<code class="file docutils literal notranslate"><span class="pre">root.log</span></code>, and <code class="file docutils literal notranslate"><span class="pre">state.log</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="debian-build-steps">
<h2><a class="toc-backref" href="#id294"><span class="section-number">2.5.11.13. </span>Debian Build Steps</a><a class="headerlink" href="#debian-build-steps" title="Permalink to this headline">¶</a></h2>
<div class="section" id="debpbuilder">
<h3><a class="toc-backref" href="#id295">DebPbuilder</a><a class="headerlink" href="#debpbuilder" title="Permalink to this headline">¶</a></h3>
<p>The <a href="#id214"><span class="problematic" id="id215">:bb:step:`DebPbuilder`</span></a> step builds Debian packages within a chroot built by <strong class="command">pbuilder</strong>.
It populates the chroot with a basic system and the packages listed as build requirement.
The type of the chroot to build is specified with the <code class="docutils literal notranslate"><span class="pre">distribution</span></code>, <code class="docutils literal notranslate"><span class="pre">distribution</span></code> and <code class="docutils literal notranslate"><span class="pre">mirror</span></code> parameter.
To use pbuilder your Buildbot user must have the right to run <strong class="command">pbuilder</strong> as root using <strong class="command">sudo</strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">DebPbuilder</span><span class="p">())</span>
</pre></div>
</div>
<p>The step takes the following parameters</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">architecture</span></code></dt><dd><p>Architecture to build chroot for.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">distribution</span></code></dt><dd><p>Name, or nickname, of the distribution.
Defaults to ‘stable’.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">basetgz</span></code></dt><dd><p>Path of the basetgz to use for building.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mirror</span></code></dt><dd><p>URL of the mirror used to download the packages from.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">extrapackages</span></code></dt><dd><p>List if packages to install in addition to the base system.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">keyring</span></code></dt><dd><p>Path to a gpg keyring to verify the downloaded packages.
This is necessary if you build for a foreign distribution.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">components</span></code></dt><dd><p>Repos to activate for chroot building.</p>
</dd>
</dl>
</div>
<div class="section" id="debcowbuilder">
<h3><a class="toc-backref" href="#id296">DebCowbuilder</a><a class="headerlink" href="#debcowbuilder" title="Permalink to this headline">¶</a></h3>
<p>The <a href="#id216"><span class="problematic" id="id217">:bb:step:`DebCowbuilder`</span></a> step is a subclass of <a href="#id218"><span class="problematic" id="id219">:bb:step:`DebPbuilder`</span></a>, which use cowbuilder instead of pbuilder.</p>
</div>
<div class="section" id="deblintian">
<h3><a class="toc-backref" href="#id297">DebLintian</a><a class="headerlink" href="#deblintian" title="Permalink to this headline">¶</a></h3>
<p>The <a href="#id220"><span class="problematic" id="id221">:bb:step:`DebLintian`</span></a> step checks a build .deb for bugs and policy violations.
The packages or changes file to test is specified in <code class="docutils literal notranslate"><span class="pre">fileloc</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">DebLintian</span><span class="p">(</span><span class="n">fileloc</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;%(prop:deb-changes)s&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="miscellaneous-buildsteps">
<h2><a class="toc-backref" href="#id298"><span class="section-number">2.5.11.14. </span>Miscellaneous BuildSteps</a><a class="headerlink" href="#miscellaneous-buildsteps" title="Permalink to this headline">¶</a></h2>
<p>A number of steps do not fall into any particular category.</p>
<div class="section" id="hlint">
<h3><a class="toc-backref" href="#id299">HLint</a><a class="headerlink" href="#hlint" title="Permalink to this headline">¶</a></h3>
<p>The <a href="#id222"><span class="problematic" id="id223">:bb:step:`HLint`</span></a> step runs Twisted Lore, a lint-like checker over a set of <code class="docutils literal notranslate"><span class="pre">.xhtml</span></code> files.
Any deviations from recommended style is flagged and put in the output log.</p>
<p>The step looks at the list of changes in the build to determine which files to check - it does not check all files.
It specifically excludes any <code class="docutils literal notranslate"><span class="pre">.xhtml</span></code> files in the top-level <code class="docutils literal notranslate"><span class="pre">sandbox/</span></code> directory.</p>
<p>The step takes a single, optional, parameter: <code class="docutils literal notranslate"><span class="pre">python</span></code>.
This specifies the Python executable to use to run Lore.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">HLint</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="maxq">
<h3><a class="toc-backref" href="#id300">MaxQ</a><a class="headerlink" href="#maxq" title="Permalink to this headline">¶</a></h3>
<p>MaxQ (<a class="reference external" href="http://maxq.tigris.org/">http://maxq.tigris.org/</a>) is a web testing tool that allows you to record HTTP sessions and play them back.
The <a href="#id224"><span class="problematic" id="id225">:bb:step:`MaxQ`</span></a> step runs this framework.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MaxQ</span><span class="p">(</span><span class="n">testdir</span><span class="o">=</span><span class="s1">&#39;tests/&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The single argument, <code class="docutils literal notranslate"><span class="pre">testdir</span></code>, specifies where the tests should be run.
This directory will be passed to the <code class="docutils literal notranslate"><span class="pre">run_maxq.py</span></code> command, and the results analyzed.</p>
</div>
<div class="section" id="http-requests">
<h3><a class="toc-backref" href="#id301">HTTP Requests</a><a class="headerlink" href="#http-requests" title="Permalink to this headline">¶</a></h3>
<p>Using the <a href="#id226"><span class="problematic" id="id227">:bb:step:`HTTPStep`</span></a> step, it is possible to perform HTTP requests in order to trigger another REST service about the progress of the build.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step requires the <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> and <a class="reference external" href="https://requests.readthedocs.io/en/master">requests</a> Python libraries.</p>
</div>
<p>The parameters are the following:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">url</span></code></dt><dd><p>(mandatory) The URL where to send the request</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">method</span></code></dt><dd><p>The HTTP method to use (out of <code class="docutils literal notranslate"><span class="pre">POST</span></code>, <code class="docutils literal notranslate"><span class="pre">GET</span></code>, <code class="docutils literal notranslate"><span class="pre">PUT</span></code>, <code class="docutils literal notranslate"><span class="pre">DELETE</span></code>, <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> or <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code>), default to <code class="docutils literal notranslate"><span class="pre">POST</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">params</span></code></dt><dd><p>Dictionary of URL parameters to append to the URL.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">data</span></code></dt><dd><p>The body to attach the request.
If a dictionary is provided, form-encoding will take place.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">headers</span></code></dt><dd><p>Dictionary of headers to send.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">other</span> <span class="pre">params</span></code></dt><dd><p>Any other keywords supported by the <code class="docutils literal notranslate"><span class="pre">requests</span></code>
<a class="reference external" href="https://2.python-requests.org/en/master/api/#main-interface">api</a>
can be passed to this step.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The entire Buildbot master process shares a single Requests <code class="docutils literal notranslate"><span class="pre">Session</span></code> object.
This has the advantage of supporting connection re-use and other HTTP/1.1 features.
However, it also means that any cookies or other state changed by one step will be visible to other steps, causing unexpected results.
This behavior may change in future versions.</p>
</div>
</dd>
</dl>
<p>When the method is known in advance, class with the name of the method can also be used.
In this case, it is not necessary to specify the method.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">POST</span><span class="p">(</span><span class="s1">&#39;http://myRESTService.example.com/builds&#39;</span><span class="p">,</span>
                     <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;builder&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;buildername&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;buildnumber&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;buildnumber&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;workername&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;workername&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;revision&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;got_revision&#39;</span><span class="p">)</span>
                     <span class="p">}))</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="interlocks.html" class="btn btn-neutral float-right" title="2.5.12. Interlocks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="properties.html" class="btn btn-neutral float-left" title="2.5.10. Properties" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, junpengxu

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>