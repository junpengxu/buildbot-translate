

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.2.5. Worker Setup &mdash; buildbot-translate 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.2.6. Next Steps" href="misc.html" />
    <link rel="prev" title="2.2.4. Buildmaster Setup" href="buildmaster.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> buildbot-translate
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">1. Buildbot Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">2. Buildbot Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">2.1. Introduction</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">2.2. Installation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="components.html">2.2.1. Buildbot Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="requirements.html">2.2.2. Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html">2.2.3. Installing the code</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildmaster.html">2.2.4. Buildmaster Setup</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.2.5. Worker Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-worker">2.2.5.1. Creating a worker</a></li>
<li class="toctree-l4"><a class="reference internal" href="#upgrading-an-existing-worker">2.2.5.2. Upgrading an Existing Worker</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="misc.html">2.2.6. Next Steps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../concepts.html">2.3. Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../secretsmanagement.html">2.4. Secret Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.html">2.5. Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../customization.html">2.6. Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmdline.html">2.7. Command-line Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resources.html">2.8. Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization.html">2.9. Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins.html">2.10. Plugin Infrastructure in Buildbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy.html">2.11. Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrading/index.html">2.12. Upgrading</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">buildbot-translate</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html"><span class="section-number">2. </span>Buildbot Manual</a> &raquo;</li>
        
          <li><a href="index.html"><span class="section-number">2.2. </span>Installation</a> &raquo;</li>
        
      <li><span class="section-number">2.2.5. </span>Worker Setup</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/manual/installation/worker.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="worker-setup">
<h1><span class="section-number">2.2.5. </span>Worker Setup<a class="headerlink" href="#worker-setup" title="Permalink to this headline">¶</a></h1>
<div class="section" id="creating-a-worker">
<span id="id1"></span><h2><span class="section-number">2.2.5.1. </span>Creating a worker<a class="headerlink" href="#creating-a-worker" title="Permalink to this headline">¶</a></h2>
<p>Typically, you will be adding a worker to an existing buildmaster, to provide additional architecture coverage.
The Buildbot administrator will give you several pieces of information necessary to connect to the buildmaster.
You should also be somewhat familiar with the project being tested, so you can troubleshoot build problems locally.</p>
<p>The Buildbot exists to make sure that the project’s stated <code class="docutils literal notranslate"><span class="pre">how</span> <span class="pre">to</span> <span class="pre">build</span> <span class="pre">it</span></code> process actually works.
To this end, the worker should run in an environment just like that of your regular developers.
Typically the project build process is documented somewhere (<code class="file docutils literal notranslate"><span class="pre">README</span></code>, <code class="file docutils literal notranslate"><span class="pre">INSTALL</span></code>, etc), in a document that should mention all library dependencies and contain a basic set of build instructions.
This document will be useful as you configure the host and account in which the worker runs.</p>
<p>Here’s a good checklist for setting up a worker:</p>
<ol class="arabic simple">
<li><p>Set up the account</p></li>
</ol>
<blockquote>
<div><p>It is recommended (although not mandatory) to set up a separate user account for the worker.
This account is frequently named <code class="docutils literal notranslate"><span class="pre">buildbot</span></code> or <code class="docutils literal notranslate"><span class="pre">worker</span></code>.
This serves to isolate your personal working environment from that of the worker’s, and helps to minimize the security threat posed by letting possibly-unknown contributors run arbitrary code on your system.
The account should have a minimum of fancy init scripts.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Install the Buildbot code</p></li>
</ol>
<blockquote>
<div><p>Follow the instructions given earlier (<a class="reference internal" href="installation.html#installing-the-code"><span class="std std-ref">Installing the code</span></a>).
If you use a separate worker account, and you didn’t install the Buildbot code to a shared location, then you will need to install it with <code class="docutils literal notranslate"><span class="pre">--home=~</span></code> for each account that needs it.</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Set up the host</p></li>
</ol>
<blockquote>
<div><p>Make sure the host can actually reach the buildmaster.
Usually the buildmaster is running a status webserver on the same machine, so simply point your web browser at it and see if you can get there.
Install whatever additional packages or libraries the project’s INSTALL document advises.
(or not: if your worker is supposed to make sure that building without optional libraries still works, then don’t install those libraries.)</p>
<p>Again, these libraries don’t necessarily have to be installed to a site-wide shared location, but they must be available to your build process.
Accomplishing this is usually very specific to the build process, so installing them to <code class="file docutils literal notranslate"><span class="pre">/usr</span></code> or <code class="file docutils literal notranslate"><span class="pre">/usr/local</span></code> is usually the best approach.</p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Test the build process</p></li>
</ol>
<blockquote>
<div><p>Follow the instructions in the <code class="file docutils literal notranslate"><span class="pre">INSTALL</span></code> document, in the worker’s account.
Perform a full CVS (or whatever) checkout, configure, make, run tests, etc.
Confirm that the build works without manual fussing.
If it doesn’t work when you do it by hand, it will be unlikely to work when the Buildbot attempts to do it in an automated fashion.</p>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Choose a base directory</p></li>
</ol>
<blockquote>
<div><p>This should be somewhere in the worker’s account, typically named after the project which is being tested.
The worker will not touch any file outside of this directory.
Something like <code class="file docutils literal notranslate"><span class="pre">~/Buildbot</span></code> or <code class="file docutils literal notranslate"><span class="pre">~/Workers/fooproject</span></code> is appropriate.</p>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>Get the buildmaster host/port, botname, and password</p></li>
</ol>
<blockquote>
<div><p>When the Buildbot admin configures the buildmaster to accept and use your worker, they will provide you with the following pieces of information:</p>
<ul class="simple">
<li><p>your worker’s name</p></li>
<li><p>the password assigned to your worker</p></li>
<li><p>the hostname and port number of the buildmaster, i.e. <a class="reference external" href="http://buildbot.example.org:8007">http://buildbot.example.org:8007</a></p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>Create the worker</p></li>
</ol>
<blockquote>
<div><p>Now run the ‘worker’ command as follows:</p>
<blockquote>
<div><p><code class="samp docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span> <em><span class="pre">BASEDIR</span></em> <em><span class="pre">MASTERHOST</span></em><span class="pre">:</span><em><span class="pre">PORT</span></em> <em><span class="pre">WORKERNAME</span></em> <em><span class="pre">PASSWORD</span></em></code></p>
</div></blockquote>
<p>This will create the base directory and a collection of files inside, including the <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> file that contains all the information you passed to the <strong class="command">buildbot</strong> command.</p>
</div></blockquote>
<ol class="arabic simple" start="8">
<li><p>Fill in the hostinfo files</p></li>
</ol>
<blockquote>
<div><p>When it first connects, the worker will send a few files up to the buildmaster which describe the host that it is running on.
These files are presented on the web status display so that developers have more information to reproduce any test failures that are witnessed by the Buildbot.
There are sample files in the <code class="file docutils literal notranslate"><span class="pre">info</span></code> subdirectory of the Buildbot’s base directory.
You should edit these to correctly describe you and your host.</p>
<p><code class="file docutils literal notranslate"><em><span class="pre">BASEDIR</span></em><span class="pre">/info/admin</span></code> should contain your name and email address.
This is the <code class="docutils literal notranslate"><span class="pre">worker</span> <span class="pre">admin</span> <span class="pre">address</span></code>, and will be visible from the build status page (so you may wish to munge it a bit if address-harvesting spambots are a concern).</p>
<p><code class="file docutils literal notranslate"><em><span class="pre">BASEDIR</span></em><span class="pre">/info/host</span></code> should be filled with a brief description of the host: OS, version, memory size, CPU speed, versions of relevant libraries installed, and finally the version of the Buildbot code which is running the worker.</p>
<p>The optional <code class="file docutils literal notranslate"><em><span class="pre">BASEDIR</span></em><span class="pre">/info/access_uri</span></code> can specify a URI which will connect a user to the machine.
Many systems accept <code class="docutils literal notranslate"><span class="pre">ssh://hostname</span></code> URIs for this purpose.</p>
<p>If you run many workers, you may want to create a single <code class="file docutils literal notranslate"><span class="pre">~worker/info</span></code> file and share it among all the workers with symlinks.</p>
</div></blockquote>
<div class="section" id="worker-options">
<span id="id2"></span><h3>Worker Options<a class="headerlink" href="#worker-options" title="Permalink to this headline">¶</a></h3>
<p>There are a handful of options you might want to use when creating the worker with the <code class="samp docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span> <span class="pre">&lt;options&gt;</span> <span class="pre">DIR</span> <span class="pre">&lt;params&gt;</span></code> command.
You can type <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span> <span class="pre">--help</span></code> for a summary.
To use these, just include them on the <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span></code> command line, like this</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot-worker create-worker --umask<span class="o">=</span>0o22 ~/worker buildmaster.example.org:42012 <span class="se">\</span>
    <span class="o">{</span>myworkername<span class="o">}</span> <span class="o">{</span>mypasswd<span class="o">}</span>
</pre></div>
</div>
<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-no-logrotate">
<code class="sig-name descname">--no-logrotate</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-no-logrotate" title="Permalink to this definition">¶</a></dt>
<dd><p>This disables internal worker log management mechanism.
With this option worker does not override the default logfile name and its behaviour giving a possibility to control those with command-line options of twistd daemon.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-umask">
<code class="sig-name descname">--umask</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-umask" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a string (generally an octal representation of an integer) which will cause the worker process’ <code class="docutils literal notranslate"><span class="pre">umask</span></code> value to be set shortly after initialization.
The <code class="docutils literal notranslate"><span class="pre">twistd</span></code> daemonization utility forces the umask to 077 at startup (which means that all files created by the worker or its child processes will be unreadable by any user other than the worker account).
If you want build products to be readable by other accounts, you can add <code class="docutils literal notranslate"><span class="pre">--umask=0o22</span></code> to tell the worker to fix the umask after twistd clobbers it.
If you want build products to be <em>writable</em> by other accounts too, use <code class="docutils literal notranslate"><span class="pre">--umask=0o000</span></code>, but this is likely to be a security problem.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-keepalive">
<code class="sig-name descname">--keepalive</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-keepalive" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a number that indicates how frequently <code class="docutils literal notranslate"><span class="pre">keepalive</span></code> messages should be sent from the worker to the buildmaster, expressed in seconds.
The default (600) causes a message to be sent to the buildmaster at least once every 10 minutes.
To set this to a lower value, use e.g. <code class="docutils literal notranslate"><span class="pre">--keepalive=120</span></code>.</p>
<p>If the worker is behind a NAT box or stateful firewall, these messages may help to keep the connection alive: some NAT boxes tend to forget about a connection if it has not been used in a while.
When this happens, the buildmaster will think that the worker has disappeared, and builds will time out.
Meanwhile the worker will not realize than anything is wrong.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-maxdelay">
<code class="sig-name descname">--maxdelay</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-maxdelay" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a number that indicates the maximum amount of time the worker will wait between connection attempts, expressed in seconds.
The default (300) causes the worker to wait at most 5 minutes before trying to connect to the buildmaster again.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-maxretries">
<code class="sig-name descname">--maxretries</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-maxretries" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a number that indicates the maximum number of time the worker will make connection attempts.
After that amount, the worker process will stop.
This option is useful for <a class="reference internal" href="../configuration/workers.html#latent-workers"><span class="std std-ref">Latent Workers</span></a> to avoid consuming resources in case of misconfiguration or master failure.</p>
<p>For VM based latent workers, the user is responsible for halting the system when Buildbot worker has exited.
This feature is heavily OS dependent, and cannot be managed by Buildbot worker.
For example with <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd.service.html">systemd</a>, one can add <code class="docutils literal notranslate"><span class="pre">ExecStopPost=shutdown</span> <span class="pre">now</span></code> to the Buildbot worker service unit configuration.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-log-size">
<code class="sig-name descname">--log-size</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-log-size" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the size in bytes when to rotate the Twisted log files.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-log-count">
<code class="sig-name descname">--log-count</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-log-count" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the number of log rotations to keep around.
You can either specify a number or <code class="docutils literal notranslate"><span class="pre">None</span></code> to keep all <code class="file docutils literal notranslate"><span class="pre">twistd.log</span></code> files around.
The default is 10.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-allow-shutdown">
<code class="sig-name descname">--allow-shutdown</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-allow-shutdown" title="Permalink to this definition">¶</a></dt>
<dd><p>Can also be passed directly to the Worker constructor in <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code>.
If set, it allows the worker to initiate a graceful shutdown, meaning that it will ask the master to shut down the worker when the current build, if any, is complete.</p>
<p>Setting allow_shutdown to <code class="docutils literal notranslate"><span class="pre">file</span></code> will cause the worker to watch <code class="file docutils literal notranslate"><span class="pre">shutdown.stamp</span></code> in basedir for updates to its mtime.
When the mtime changes, the worker will request a graceful shutdown from the master.
The file does not need to exist prior to starting the worker.</p>
<p>Setting allow_shutdown to <code class="docutils literal notranslate"><span class="pre">signal</span></code> will set up a SIGHUP handler to start a graceful shutdown.
When the signal is received, the worker will request a graceful shutdown from the master.</p>
<p>The default value is <code class="docutils literal notranslate"><span class="pre">None</span></code>, in which case this feature will be disabled.</p>
<p>Both master and worker must be at least version 0.8.3 for this feature to work.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-use-tls">
<code class="sig-name descname">--use-tls</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-use-tls" title="Permalink to this definition">¶</a></dt>
<dd><p>Can also be passed directly to the Worker constructor in <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code>.
If set, the generated connection string starts with <code class="docutils literal notranslate"><span class="pre">tls</span></code> instead of with <code class="docutils literal notranslate"><span class="pre">tcp</span></code>, allowing encrypted connection to the buildmaster.
Make sure the worker trusts the buildmasters certificate. If you have an non-authoritative certificate (CA is self-signed) see <code class="docutils literal notranslate"><span class="pre">connection_string</span></code> below.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-delete-leftover-dirs">
<code class="sig-name descname">--delete-leftover-dirs</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-delete-leftover-dirs" title="Permalink to this definition">¶</a></dt>
<dd><p>Can also be passed directly to the Worker constructor in <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code>.
If set, unexpected directories in worker base directory will be removed.
Otherwise, a warning will be displayed in <code class="file docutils literal notranslate"><span class="pre">twistd.log</span></code> so that you can manually remove them.</p>
</dd></dl>

</div>
<div class="section" id="other-worker-configuration">
<span id="id3"></span><h3>Other Worker Configuration<a class="headerlink" href="#other-worker-configuration" title="Permalink to this headline">¶</a></h3>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">unicode_encoding</span></code></dt><dd><p>This represents the encoding that Buildbot should use when converting unicode commandline arguments into byte strings in order to pass to the operating system when spawning new processes.</p>
<p>The default value is what Python’s <code class="xref py py-func docutils literal notranslate"><span class="pre">sys.getfilesystemencoding()</span></code> returns, which on Windows is ‘mbcs’, on Mac OSX is ‘utf-8’, and on Unix depends on your locale settings.</p>
<p>If you need a different encoding, this can be changed in your worker’s <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> file by adding a <code class="docutils literal notranslate"><span class="pre">unicode_encoding</span></code> argument to the Worker constructor.</p>
</dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span><span class="n">buildmaster_host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">workername</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">basedir</span><span class="p">,</span>
           <span class="n">keepalive</span><span class="p">,</span> <span class="n">usepty</span><span class="p">,</span> <span class="n">umask</span><span class="o">=</span><span class="n">umask</span><span class="p">,</span> <span class="n">maxdelay</span><span class="o">=</span><span class="n">maxdelay</span><span class="p">,</span>
           <span class="n">unicode_encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">allow_shutdown</span><span class="o">=</span><span class="s1">&#39;signal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="worker-tls-configuration">
<span id="worker-tls-config"></span><h3>Worker TLS Configuration<a class="headerlink" href="#worker-tls-configuration" title="Permalink to this headline">¶</a></h3>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">tls</span></code></dt><dd><p>See <code class="docutils literal notranslate"><span class="pre">--useTls</span></code> option above as an alternative to setting the <code class="docutils literal notranslate"><span class="pre">conneciton_string</span></code> manually.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">connection_string</span></code></dt><dd><p>For TLS connections to the master the <code class="docutils literal notranslate"><span class="pre">connection_string</span></code>-argument must be used to <code class="docutils literal notranslate"><span class="pre">Worker.__init__</span></code> function. <code class="docutils literal notranslate"><span class="pre">buildmaster_host</span></code> and <code class="docutils literal notranslate"><span class="pre">port</span></code> must then be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">connection_string</span></code> will be used to create a client endpoint with <a class="reference external" href="https://twistedmatrix.com/documents/current/api/twisted.internet.endpoints.clientFromString.html">clientFromString</a>. An example of <code class="docutils literal notranslate"><span class="pre">connection_string</span></code> is <code class="docutils literal notranslate"><span class="pre">&quot;TLS:buildbot-master.com:9989&quot;</span></code>.</p>
<p>See more about how to formulate the connection string in <a class="reference external" href="https://twistedmatrix.com/documents/current/core/howto/endpoints.html">ConnectionStrings</a>.</p>
<p>Example TLS connection string:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">workername</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">basedir</span><span class="p">,</span> <span class="n">keepalive</span><span class="p">,</span>
           <span class="n">connection_string</span><span class="o">=</span><span class="s1">&#39;TLS:buildbot-master.com:9989&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Make sure the worker trusts the masters certificate. If you have an non-authoritative certificate
(CA is self-signed) the trustRoot parameter can be used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">workername</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">basedir</span><span class="p">,</span> <span class="n">keepalive</span><span class="p">,</span>
           <span class="n">connection_string</span><span class="o">=</span>
           <span class="s1">&#39;TLS:buildbot-master.com:9989:trustRoots=/dir-with-ca-certs&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>It must point to a directory with PEM-encoded certificates in files with file ending .pem. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cat /dir-with-ca-certs/ca.pem
-----BEGIN CERTIFICATE-----
MIIE9DCCA9ygAwIBAgIJALEqLrC/m1w3MA0GCSqGSIb3DQEBCwUAMIGsMQswCQYD
VQQGEwJaWjELMAkGA1UECBMCUUExEDAOBgNVBAcTB05vd2hlcmUxETAPBgNVBAoT
CEJ1aWxkYm90MRkwFwYDVQQLExBEZXZlbG9wbWVudCBUZWFtMRQwEgYDVQQDEwtC
dWlsZGJvdCBDQTEQMA4GA1UEKRMHRWFzeVJTQTEoMCYGCSqGSIb3DQEJARYZYnVp
bGRib3RAaW50ZWdyYXRpb24udGVzdDAeFw0xNjA5MDIxMjA5NTJaFw0yNjA4MzEx
MjA5NTJaMIGsMQswCQYDVQQGEwJaWjELMAkGA1UECBMCUUExEDAOBgNVBAcTB05v
d2hlcmUxETAPBgNVBAoTCEJ1aWxkYm90MRkwFwYDVQQLExBEZXZlbG9wbWVudCBU
ZWFtMRQwEgYDVQQDEwtCdWlsZGJvdCBDQTEQMA4GA1UEKRMHRWFzeVJTQTEoMCYG
CSqGSIb3DQEJARYZYnVpbGRib3RAaW50ZWdyYXRpb24udGVzdDCCASIwDQYJKoZI
hvcNAQEBBQADggEPADCCAQoCggEBALJZcC9j4XYBi1fYT/fibY2FRWn6Qh74b1Pg
I7iIde6Sf3DPdh/ogYvZAT+cIlkZdo4v326d0EkuYKcywDvho8UeET6sIYhuHPDW
lRl1Ret6ylxpbEfxFNvMoEGNhYAP0C6QS2eWEP9LkV2lCuMQtWWzdedjk+efqBjR
Gozaim0lr/5lx7bnVx0oRLAgbI5/9Ukbopansfr+Cp9CpFpbNPGZSmELzC3FPKXK
5tycj8WEqlywlha2/VRnCZfYefB3aAuQqQilLh+QHyhn6hzc26+n5B0l8QvrMkOX
atKdznMLzJWGxS7UwmDKcsolcMAW+82BZ8nUCBPF3U5PkTLO540CAwEAAaOCARUw
ggERMB0GA1UdDgQWBBT7A/I+MZ1sFFJ9jikYkn51Q3wJ+TCB4QYDVR0jBIHZMIHW
gBT7A/I+MZ1sFFJ9jikYkn51Q3wJ+aGBsqSBrzCBrDELMAkGA1UEBhMCWloxCzAJ
BgNVBAgTAlFBMRAwDgYDVQQHEwdOb3doZXJlMREwDwYDVQQKEwhCdWlsZGJvdDEZ
MBcGA1UECxMQRGV2ZWxvcG1lbnQgVGVhbTEUMBIGA1UEAxMLQnVpbGRib3QgQ0Ex
EDAOBgNVBCkTB0Vhc3lSU0ExKDAmBgkqhkiG9w0BCQEWGWJ1aWxkYm90QGludGVn
cmF0aW9uLnRlc3SCCQCxKi6wv5tcNzAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEB
CwUAA4IBAQCJGJVMAmwZRK/mRqm9E0e3s4YGmYT2jwX5IX17XljEy+1cS4huuZW2
33CFpslkT1MN/r8IIZWilxT/lTujHyt4eERGjE1oRVKU8rlTH8WUjFzPIVu7nkte
09abqynAoec8aQukg79NRCY1l/E2/WzfnUt3yTgKPfZmzoiN0K+hH4gVlWtrizPA
LaGwoslYYTA6jHNEeMm8OQLNf17OTmAa7EpeIgVpLRCieI9S3JIG4WYU8fVkeuiU
cB439SdixU4cecVjNfFDpq6JM8N6+DQoYOSNRt9Dy0ioGyx5D4lWoIQ+BmXQENal
gw+XLyejeNTNgLOxf9pbNYMJqxhkTkoE
-----END CERTIFICATE-----
</pre></div>
</div>
<p>Using TCP in <code class="docutils literal notranslate"><span class="pre">connection_string</span></code> is the equivalent as using the <code class="docutils literal notranslate"><span class="pre">buildmaster_host</span></code> and <code class="docutils literal notranslate"><span class="pre">port</span></code> arguments.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">workername</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">basedir</span><span class="p">,</span> <span class="n">keepalive</span>
           <span class="n">connection_string</span><span class="o">=</span><span class="s1">&#39;TCP:buildbot-master.com:9989&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>is equivalent to</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span><span class="s1">&#39;buildbot-master.com&#39;</span><span class="p">,</span> <span class="mi">9989</span><span class="p">,</span> <span class="n">workername</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">basedir</span><span class="p">,</span>
           <span class="n">keepalive</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="upgrading-an-existing-worker">
<span id="id4"></span><h2><span class="section-number">2.2.5.2. </span>Upgrading an Existing Worker<a class="headerlink" href="#upgrading-an-existing-worker" title="Permalink to this headline">¶</a></h2>
<div class="section" id="version-specific-notes">
<span id="worker-version-specific-notes"></span><h3>Version-specific Notes<a class="headerlink" href="#version-specific-notes" title="Permalink to this headline">¶</a></h3>
<p>During project lifetime worker has transitioned over few states:</p>
<ol class="arabic simple">
<li><p>Before Buildbot version 0.8.1 worker were integral part of <code class="docutils literal notranslate"><span class="pre">buildbot</span></code> package distribution.</p></li>
<li><p>Starting from Buildbot version 0.8.1 worker were extracted from <code class="docutils literal notranslate"><span class="pre">buildbot</span></code> package to <code class="docutils literal notranslate"><span class="pre">buildbot-slave</span></code> package.</p></li>
<li><p>Starting from Buildbot version 0.9.0 the <code class="docutils literal notranslate"><span class="pre">buildbot-slave</span></code> package was renamed to <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code>.</p></li>
</ol>
<div class="section" id="upgrading-a-worker-to-buildbot-slave-0-8-1">
<h4>Upgrading a Worker to buildbot-slave 0.8.1<a class="headerlink" href="#upgrading-a-worker-to-buildbot-slave-0-8-1" title="Permalink to this headline">¶</a></h4>
<p>Before Buildbot version 0.8.1, the Buildbot master and worker were part of the same distribution.
As of version 0.8.1, the worker is a separate distribution.</p>
<p>As of this release, you will need to install <code class="docutils literal notranslate"><span class="pre">buildbot-slave</span></code> to run a worker.</p>
<p>Any automatic startup scripts that had run <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">start</span></code> for previous versions should be changed to run <code class="docutils literal notranslate"><span class="pre">buildslave</span> <span class="pre">start</span></code> instead.</p>
<p>If you are running a version later than 0.8.1, then you can skip the remainder of this section: the <code class="docutils literal notranslate"><span class="pre">upgrade-slave</span></code> command will take care of this.
If you are upgrading directly to 0.8.1, read on.</p>
<p>The existing <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> for any workers running older versions will need to be edited or replaced.
If the loss of cached worker state (e.g., for Source steps in copy mode) is not problematic, the easiest solution is to simply delete the worker directory and re-run <code class="docutils literal notranslate"><span class="pre">buildslave</span> <span class="pre">create-slave</span></code>.</p>
<p>If deleting the worker directory is problematic, the change to <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> is simple.
On line 3, replace:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.slave.bot</span> <span class="kn">import</span> <span class="n">BuildSlave</span>
</pre></div>
</div>
<p>with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildslave.bot</span> <span class="kn">import</span> <span class="n">BuildSlave</span>
</pre></div>
</div>
<p>After this change, the worker should start as usual.</p>
</div>
<div class="section" id="upgrading-from-0-8-1-to-the-latest-0-8-version-of-buildbot-slave">
<h4>Upgrading from <cite>0.8.1</cite> to the latest <code class="docutils literal notranslate"><span class="pre">0.8.*</span></code> version of buildbot-slave<a class="headerlink" href="#upgrading-from-0-8-1-to-the-latest-0-8-version-of-buildbot-slave" title="Permalink to this headline">¶</a></h4>
<p>If you have just installed a new version of Buildbot-slave, you may need to take some steps to upgrade it.
If you are upgrading to version 0.8.2 or later, you can run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildslave upgrade-slave /path/to/worker/dir
</pre></div>
</div>
</div>
<div class="section" id="upgrading-from-the-latest-version-of-buildbot-slave-to-buildbot-worker">
<h4>Upgrading from the latest version of <code class="docutils literal notranslate"><span class="pre">buildbot-slave</span></code> to <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code><a class="headerlink" href="#upgrading-from-the-latest-version-of-buildbot-slave-to-buildbot-worker" title="Permalink to this headline">¶</a></h4>
<p>If the loss of cached worker state (e.g., for Source steps in copy mode) is not problematic, the easiest solution is to simply delete the worker directory and re-run <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span></code>.</p>
<p>If deleting the worker directory is problematic, you can change <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> in the following way:</p>
<ol class="arabic">
<li><p>Replace:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildslave.bot</span> <span class="kn">import</span> <span class="n">BuildSlave</span>
</pre></div>
</div>
<p>with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot_worker.bot</span> <span class="kn">import</span> <span class="n">Worker</span>
</pre></div>
</div>
</li>
<li><p>Replace:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">application</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">Application</span><span class="p">(</span><span class="s1">&#39;buildslave&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">application</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">Application</span><span class="p">(</span><span class="s1">&#39;buildbot-worker&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Replace:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">BuildSlave</span><span class="p">(</span><span class="n">buildmaster_host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">slavename</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">basedir</span><span class="p">,</span>
               <span class="n">keepalive</span><span class="p">,</span> <span class="n">usepty</span><span class="p">,</span> <span class="n">umask</span><span class="o">=</span><span class="n">umask</span><span class="p">,</span> <span class="n">maxdelay</span><span class="o">=</span><span class="n">maxdelay</span><span class="p">,</span>
               <span class="n">numcpus</span><span class="o">=</span><span class="n">numcpus</span><span class="p">,</span> <span class="n">allow_shutdown</span><span class="o">=</span><span class="n">allow_shutdown</span><span class="p">)</span>
</pre></div>
</div>
<p>with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span><span class="n">buildmaster_host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">slavename</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">basedir</span><span class="p">,</span>
           <span class="n">keepalive</span><span class="p">,</span> <span class="n">umask</span><span class="o">=</span><span class="n">umask</span><span class="p">,</span> <span class="n">maxdelay</span><span class="o">=</span><span class="n">maxdelay</span><span class="p">,</span>
           <span class="n">numcpus</span><span class="o">=</span><span class="n">numcpus</span><span class="p">,</span> <span class="n">allow_shutdown</span><span class="o">=</span><span class="n">allow_shutdown</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>See <a class="reference internal" href="../upgrading/0.9-worker-transition.html#worker-transition-buildbot-worker"><span class="std std-ref">Transition to “Worker” Terminology</span></a> for details of changes in version Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.0</span></code>.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="misc.html" class="btn btn-neutral float-right" title="2.2.6. Next Steps" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="buildmaster.html" class="btn btn-neutral float-left" title="2.2.4. Buildmaster Setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, junpengxu

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>