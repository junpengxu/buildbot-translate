

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.2.4. Buildmaster Setup &mdash; buildbot-translate 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.2.5. Worker Setup" href="worker.html" />
    <link rel="prev" title="2.2.3. Installing the code" href="installation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> buildbot-translate
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">1. Buildbot Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">2. Buildbot Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">2.1. Introduction</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">2.2. Installation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="components.html">2.2.1. Buildbot Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="requirements.html">2.2.2. Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html">2.2.3. Installing the code</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.2.4. Buildmaster Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-buildmaster">2.2.4.1. Creating a buildmaster</a></li>
<li class="toctree-l4"><a class="reference internal" href="#upgrading-an-existing-buildmaster">2.2.4.2. Upgrading an Existing Buildmaster</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="worker.html">2.2.5. Worker Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="misc.html">2.2.6. Next Steps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../concepts.html">2.3. Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../secretsmanagement.html">2.4. Secret Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.html">2.5. Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../customization.html">2.6. Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmdline.html">2.7. Command-line Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resources.html">2.8. Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization.html">2.9. Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins.html">2.10. Plugin Infrastructure in Buildbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy.html">2.11. Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrading/index.html">2.12. Upgrading</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">buildbot-translate</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html"><span class="section-number">2. </span>Buildbot Manual</a> &raquo;</li>
        
          <li><a href="index.html"><span class="section-number">2.2. </span>Installation</a> &raquo;</li>
        
      <li><span class="section-number">2.2.4. </span>Buildmaster Setup</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/manual/installation/buildmaster.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="buildmaster-setup">
<h1><span class="section-number">2.2.4. </span>Buildmaster Setup<a class="headerlink" href="#buildmaster-setup" title="Permalink to this headline">¶</a></h1>
<div class="section" id="creating-a-buildmaster">
<span id="id1"></span><h2><span class="section-number">2.2.4.1. </span>Creating a buildmaster<a class="headerlink" href="#creating-a-buildmaster" title="Permalink to this headline">¶</a></h2>
<p>As you learned earlier (<a class="reference internal" href="../introduction.html#system-architecture"><span class="std std-ref">System Architecture</span></a>), the buildmaster runs on a central host (usually one that is publicly visible, so everybody can check on the status of the project), and controls all aspects of the buildbot system</p>
<p>You will probably wish to create a separate user account for the buildmaster, perhaps named <code class="docutils literal notranslate"><span class="pre">buildmaster</span></code>.
Do not run the buildmaster as <code class="docutils literal notranslate"><span class="pre">root</span></code>!</p>
<p>You need to choose a directory for the buildmaster, called the <code class="docutils literal notranslate"><span class="pre">basedir</span></code>.
This directory will be owned by the buildmaster.
It will contain configuration, the database, and status information - including logfiles.
On a large buildmaster this directory will see a lot of activity, so it should be on a disk with adequate space and speed.</p>
<p>Once you’ve picked a directory, use the <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">create-master</span></code> command to create the directory and populate it with startup files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot create-master -r basedir
</pre></div>
</div>
<p>You will need to create a <a class="reference internal" href="../configuration/index.html#configuration"><span class="std std-ref">configuration file</span></a> before starting the buildmaster.
Most of the rest of this manual is dedicated to explaining how to do this.
A sample configuration file is placed in the working directory, named <code class="file docutils literal notranslate"><span class="pre">master.cfg.sample</span></code>, which can be copied to <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> and edited to suit your purposes.</p>
<p>(Internal details: This command creates a file named <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> that contains all the state necessary to create the buildmaster.
Twisted has a tool called <code class="docutils literal notranslate"><span class="pre">twistd</span></code> which can use this .tac file to create and launch a buildmaster instance.
Twistd takes care of logging and daemonization (running the program in the background).
<code class="file docutils literal notranslate"><span class="pre">/usr/bin/buildbot</span></code> is a front end which runs <cite>twistd</cite> for you.)</p>
<p>Your master will need a database to store the various information about your builds, and its configuration.
By default, the <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> backend will be used.
This needs no configuration, neither extra software.
All information will be stored in the file <code class="file docutils literal notranslate"><span class="pre">state.sqlite</span></code>.
Buildbot however supports multiple backends.
See <a class="reference internal" href="../deploy.html#database-server"><span class="std std-ref">Using A Database Server</span></a> for more options.</p>
<div class="section" id="buildmaster-options">
<h3>Buildmaster Options<a class="headerlink" href="#buildmaster-options" title="Permalink to this headline">¶</a></h3>
<p>This section lists options to the <code class="docutils literal notranslate"><span class="pre">create-master</span></code> command.
You can also type <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">create-master</span> <span class="pre">--help</span></code> for an up-to-the-moment summary.</p>
<dl class="option">
<dt id="cmdoption-buildbot-create-master-force">
<code class="sig-name descname">--force</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-create-master-force" title="Permalink to this definition">¶</a></dt>
<dd><p>This option will allow to re-use an existing directory.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-create-master-no-logrotate">
<code class="sig-name descname">--no-logrotate</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-create-master-no-logrotate" title="Permalink to this definition">¶</a></dt>
<dd><p>This disables internal worker log management mechanism.
With this option worker does not override the default logfile name and its behaviour giving a possibility to control those with command-line options of twistd daemon.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-create-master-relocatable">
<code class="sig-name descname">--relocatable</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-create-master-relocatable" title="Permalink to this definition">¶</a></dt>
<dd><p>This creates a “relocatable” <code class="docutils literal notranslate"><span class="pre">buildbot.tac</span></code>, which uses relative paths instead of absolute paths, so that the buildmaster directory can be moved about.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-create-master-config">
<code class="sig-name descname">--config</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-create-master-config" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the configuration file to use.
This configuration file need not reside in the buildmaster directory.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-create-master-log-size">
<code class="sig-name descname">--log-size</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-create-master-log-size" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the size in bytes when to rotate the Twisted log files.
The default is 10MiB.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-create-master-log-count">
<code class="sig-name descname">--log-count</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-create-master-log-count" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the number of log rotations to keep around.
You can either specify a number or <code class="docutils literal notranslate"><span class="pre">None</span></code> to keep all <code class="file docutils literal notranslate"><span class="pre">twistd.log</span></code> files around.
The default is 10.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-create-master-db">
<code class="sig-name descname">--db</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-create-master-db" title="Permalink to this definition">¶</a></dt>
<dd><p>The database that the Buildmaster should use.
Note that the same value must be added to the configuration file.</p>
</dd></dl>

</div>
</div>
<div class="section" id="upgrading-an-existing-buildmaster">
<span id="id2"></span><h2><span class="section-number">2.2.4.2. </span>Upgrading an Existing Buildmaster<a class="headerlink" href="#upgrading-an-existing-buildmaster" title="Permalink to this headline">¶</a></h2>
<p>If you have just installed a new version of the Buildbot code, and you have buildmasters that were created using an older version, you’ll need to upgrade these buildmasters before you can use them.
The upgrade process adds and modifies files in the buildmaster’s base directory to make it compatible with the new code.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot upgrade-master basedir
</pre></div>
</div>
<p>This command will also scan your <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> file for incompatibilities (by loading it and printing any errors or deprecation warnings that occur).
Each buildbot release tries to be compatible with configurations that worked cleanly (i.e. without deprecation warnings) on the previous release: any functions or classes that are to be removed will first be deprecated in a release, to give you a chance to start using the replacement.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">upgrade-master</span></code> command is idempotent.
It is safe to run it multiple times.
After each upgrade of the Buildbot code, you should use <code class="docutils literal notranslate"><span class="pre">upgrade-master</span></code> on all your buildmasters.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code class="docutils literal notranslate"><span class="pre">upgrade-master</span></code> command may perform database schema modifications.
To avoid any data loss or corruption, it should <strong>not</strong> be interrupted.
As a safeguard, it ignores all signals except <code class="docutils literal notranslate"><span class="pre">SIGKILL</span></code>.</p>
</div>
<p>In general, Buildbot workers and masters can be upgraded independently, although some new features will not be available, depending on the master and worker versions.</p>
<p>Beyond this general information, read all of the sections below that apply to versions through which you are upgrading.</p>
<div class="section" id="version-specific-notes">
<span id="buildmaster-version-specific-notes"></span><h3>Version-specific Notes<a class="headerlink" href="#version-specific-notes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="upgrading-from-buildbot-0-8-x-to-buildbot-0-9-x">
<h4>Upgrading from Buildbot-0.8.x to Buildbot-0.9.x<a class="headerlink" href="#upgrading-from-buildbot-0-8-x-to-buildbot-0-9-x" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference internal" href="../upgrading/0.9-upgrade.html#upgrading-to-nine"><span class="std std-ref">Upgrading to Buildbot 0.9.0</span></a> for a guide to upgrading from 0.8.x to 0.9.x</p>
</div>
<div class="section" id="upgrading-a-buildmaster-to-buildbot-0-7-6">
<h4>Upgrading a Buildmaster to Buildbot-0.7.6<a class="headerlink" href="#upgrading-a-buildmaster-to-buildbot-0-7-6" title="Permalink to this headline">¶</a></h4>
<p>The 0.7.6 release introduced the <code class="file docutils literal notranslate"><span class="pre">public_html/</span></code> directory, which contains <code class="file docutils literal notranslate"><span class="pre">index.html</span></code> and other files served by the <code class="docutils literal notranslate"><span class="pre">WebStatus</span></code> and <code class="docutils literal notranslate"><span class="pre">Waterfall</span></code> status displays.
The <code class="docutils literal notranslate"><span class="pre">upgrade-master</span></code> command will create these files if they do not already exist.
It will not modify existing copies, but it will write a new copy in e.g. <code class="file docutils literal notranslate"><span class="pre">index.html.new</span></code> if the new version differs from the version that already exists.</p>
</div>
<div class="section" id="upgrading-a-buildmaster-to-buildbot-0-8-0">
<h4>Upgrading a Buildmaster to Buildbot-0.8.0<a class="headerlink" href="#upgrading-a-buildmaster-to-buildbot-0-8-0" title="Permalink to this headline">¶</a></h4>
<p>Buildbot-0.8.0 introduces a database backend, which is SQLite by default.
The <code class="docutils literal notranslate"><span class="pre">upgrade-master</span></code> command will automatically create and populate this database with the changes the buildmaster has seen.
Note that, as of this release, build history is <em>not</em> contained in the database, and is thus not migrated.</p>
</div>
<div class="section" id="upgrading-into-a-non-sqlite-database">
<h4>Upgrading into a non-SQLite database<a class="headerlink" href="#upgrading-into-a-non-sqlite-database" title="Permalink to this headline">¶</a></h4>
<p>If you are not using sqlite, you will need to add an entry into your <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> to reflect the database version you are using.
The upgrade process does <em>not</em> edit your <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> for you.
So something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># for using mysql:</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;db_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mysql://bbuser:&lt;password&gt;@localhost/buildbot&#39;</span>
</pre></div>
</div>
<p>Once the parameter has been added, invoke <code class="docutils literal notranslate"><span class="pre">upgrade-master</span></code>.
This will extract the DB url from your configuration file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot upgrade-master
</pre></div>
</div>
<p>See <a class="reference internal" href="../configuration/global.html#database-specification"><span class="std std-ref">Database Specification</span></a> for more options to specify a database.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="worker.html" class="btn btn-neutral float-right" title="2.2.5. Worker Setup" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral float-left" title="2.2.3. Installing the code" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, junpengxu

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>