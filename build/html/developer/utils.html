

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Utilities &mdash; buildbot-translate 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> buildbot-translate
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">1. Buildbot Tutorial</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">buildbot-translate</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Utilities</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developer/utils.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-buildbot.util">
<span id="utilities"></span><h1>Utilities<a class="headerlink" href="#module-buildbot.util" title="Permalink to this headline">¶</a></h1>
<p>Several small utilities are available at the top-level <a class="reference internal" href="#module-buildbot.util" title="buildbot.util"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util</span></code></a> package.</p>
<dl class="function">
<dt id="buildbot.util.naturalSort">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">naturalSort</code><span class="sig-paren">(</span><em class="sig-param">list</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.naturalSort" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>list</strong> – list of strings</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>sorted strings</p>
</dd>
</dl>
<p>This function sorts strings “naturally”, with embedded numbers sorted numerically.
This ordering is good for objects which might have a numeric suffix, e.g., <code class="docutils literal notranslate"><span class="pre">winworker1</span></code>, <code class="docutils literal notranslate"><span class="pre">winworker2</span></code></p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.formatInterval">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">formatInterval</code><span class="sig-paren">(</span><em class="sig-param">interval</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.formatInterval" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>interval</strong> – duration in seconds</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>human-readable (English) equivalent</p>
</dd>
</dl>
<p>This function will return a human-readable string describing a length of time, given a number of seconds.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.util.ComparableMixin">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">ComparableMixin</code><a class="headerlink" href="#buildbot.util.ComparableMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>This mixin class adds comparability to a subclass.
Use it like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Widget</span><span class="p">(</span><span class="n">FactoryProduct</span><span class="p">,</span> <span class="n">ComparableMixin</span><span class="p">):</span>
    <span class="n">compare_attrs</span> <span class="o">=</span> <span class="p">(</span> <span class="s1">&#39;radius&#39;</span><span class="p">,</span> <span class="s1">&#39;thickness&#39;</span> <span class="p">)</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>Any attributes not in <code class="docutils literal notranslate"><span class="pre">compare_attrs</span></code> will not be considered when comparing objects.
This is used to implement Buildbot’s reconfig logic, where a comparison between the new and existing objects is used to determine whether the new object should replace the existing object.
If the comparison shows the objects to be equivalent, then the old object is left in place.
If they differ, the old object is removed from the buildmaster and the new object added.</p>
<p>For use in configuration objects (schedulers, changesources, etc.), include any attributes which are set in the constructor based on the user’s configuration.
Be sure to also include the superclass’s list, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyScheduler</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">BaseScheduler</span><span class="p">):</span>
    <span class="n">compare_attrs</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">BaseScheduler</span><span class="o">.</span><span class="n">compare_attrs</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;arg1&#39;</span><span class="p">,</span> <span class="s1">&#39;arg2&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>A point to note is that the compare_attrs list is cumulative; that is, when a subclass also has a compare_attrs and the parent class has a compare_attrs, the subclass’ compare_attrs also includes the parent class’ compare_attrs.</p>
<p>This class also implements the <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.interfaces.IConfigured</span></code> interface.
The configuration is automatically generated, being the dict of all <code class="docutils literal notranslate"><span class="pre">compare_attrs</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.safeTranslate">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">safeTranslate</code><span class="sig-paren">(</span><em class="sig-param">str</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.safeTranslate" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>str</strong> – input string</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>safe version of the input</p>
</dd>
</dl>
<p>This function will filter out some inappropriate characters for filenames; it is suitable for adapting strings from the configuration for use as filenames.
It is not suitable for use with strings from untrusted sources.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.epoch2datetime">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">epoch2datetime</code><span class="sig-paren">(</span><em class="sig-param">epoch</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.epoch2datetime" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>epoch</strong> – an epoch time (integer)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>equivalent datetime object</p>
</dd>
</dl>
<p>Convert a UNIX epoch timestamp to a Python datetime object, in the UTC timezone.
Note that timestamps specify UTC time (modulo leap seconds and a few other minor details).
If the argument is None, returns None.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.datetime2epoch">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">datetime2epoch</code><span class="sig-paren">(</span><em class="sig-param">datetime</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.datetime2epoch" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>datetime</strong> – a datetime object</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>equivalent epoch time (integer)</p>
</dd>
</dl>
<p>Convert an arbitrary Python datetime object into a UNIX epoch timestamp.
If the argument is None, returns None.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.util.UTC">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">UTC</code><a class="headerlink" href="#buildbot.util.UTC" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="docutils literal notranslate"><span class="pre">datetime.tzinfo</span></code> subclass representing UTC time.
A similar class has finally been added to Python in version 3.2, but the implementation is simple enough to include here.
This is mostly used in tests to create timezone-aware datetime objects in UTC:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1978</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">UTC</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.diffSets">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">diffSets</code><span class="sig-paren">(</span><em class="sig-param">old</em>, <em class="sig-param">new</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.diffSets" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>old</strong> (<em>set</em><em> or </em><em>iterable</em>) – old set</p></li>
<li><p><strong>new</strong> (<em>set</em><em> or </em><em>iterable</em>) – new set</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a tuple, (removed, added)</p>
</dd>
</dl>
<p>This function compares two sets of objects, returning elements that were added and elements that were removed.
This is largely a convenience function for reconfiguring services.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.makeList">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">makeList</code><span class="sig-paren">(</span><em class="sig-param">input</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.makeList" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>input</strong> – a thing</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a list of zero or more things</p>
</dd>
</dl>
<p>This function is intended to support the many places in Buildbot where the user can specify either a string or a list of strings, but the implementation wishes to always consider lists.
It converts any string to a single-element list, <code class="docutils literal notranslate"><span class="pre">None</span></code> to an empty list, and any iterable to a list.
Input lists are copied, avoiding aliasing issues.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.now">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">now</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.now" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>epoch time (integer)</p>
</dd>
</dl>
<p>Return the current time, using either <code class="docutils literal notranslate"><span class="pre">reactor.seconds</span></code> or <code class="docutils literal notranslate"><span class="pre">time.time()</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.flatten">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">flatten</code><span class="sig-paren">(</span><em class="sig-param">list</em><span class="optional">[</span>, <em class="sig-param">types</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.flatten" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>list</strong> – potentially nested list</p></li>
<li><p><strong>types</strong> – An optional iterable of the types to flatten.
By default, if unspecified, this flattens both lists and tuples</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>flat list</p>
</dd>
</dl>
<p>Flatten nested lists into a list containing no other lists. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">flatten</span><span class="p">([</span> <span class="p">[</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span> <span class="p">[</span> <span class="mi">4</span> <span class="p">],</span> <span class="mi">5</span> <span class="p">]</span> <span class="p">])</span>
<span class="go">[ 1, 2, 3, 4, 5 ]</span>
</pre></div>
</div>
<p>Both lists and tuples are looked at by default.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.flattened_iterator">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">flattened_iterator</code><span class="sig-paren">(</span><em class="sig-param">list</em><span class="optional">[</span>, <em class="sig-param">types</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.flattened_iterator" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>list</strong> – potentially nested list</p></li>
<li><p><strong>types</strong> – An optional iterable of the types to flatten.
By default, if unspecified, this flattens both lists and tuples.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>iterator over every element that isn’t in types</p>
</dd>
</dl>
<p>Returns a generator that doesn’t yield any lists/tuples.  For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   &gt;&gt;&gt; for x in flattened_iterator([ [  1, 2 ], 3, [ [ 4 ] ] ]):
   &gt;&gt;&gt;     print x
   1
   2
   3
   4

Use this for extremely large lists to keep memory-usage down and improve performance when
you only need to iterate once.
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.none_or_str">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">none_or_str</code><span class="sig-paren">(</span><em class="sig-param">obj</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.none_or_str" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>obj</strong> – input value</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>string or <code class="docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
<p>If <code class="docutils literal notranslate"><span class="pre">obj</span></code> is not None, return its string representation.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="sig-name descname">bytes2unicode(bytestr, encoding='utf-8', errors='strict'):</code></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bytestr</strong> – bytes</p></li>
<li><p><strong>encoding</strong> – unicode encoding to pass to <code class="xref py py-func docutils literal notranslate"><span class="pre">str.encode()</span></code>, default <code class="docutils literal notranslate"><span class="pre">utf-8</span></code>.</p></li>
<li><p><strong>errors</strong> – error handler to pass to <code class="xref py py-func docutils literal notranslate"><span class="pre">str.encode()</span></code>, default <code class="docutils literal notranslate"><span class="pre">strict</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>string as unicode</p>
</dd>
</dl>
<p>This function is intended to convert bytes to unicode for user convenience.
If given a bytestring, it returns the string decoded using <code class="docutils literal notranslate"><span class="pre">encoding</span></code>.
If given a unicode string, it returns it directly.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="sig-name descname">string2boolean(str):</code></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>str</strong> – string</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>KeyError</strong> – </p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
</dl>
<p>This function converts a string to a boolean.
It is intended to be liberal in what it accepts: case-insensitive, “true”, “on”, “yes”, “1”, etc.
It raises <code class="xref py py-exc docutils literal notranslate"><span class="pre">KeyError</span></code> if the value is not recognized.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="sig-name descname">toJson(obj):</code></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>obj</strong> – object</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>UNIX epoch timestamp</p>
</dd>
</dl>
<p>This function is a helper for json.dump, that allows to convert non-json able objects to json.
For now it supports converting datetime.datetime objects to unix timestamp.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.util.NotABranch">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">NotABranch</code><a class="headerlink" href="#buildbot.util.NotABranch" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a sentinel value used to indicate that no branch is specified.
It is necessary since schedulers and change sources consider <code class="docutils literal notranslate"><span class="pre">None</span></code> a valid name for a branch.
This is generally used as a default value in a method signature, and then tested against with <code class="docutils literal notranslate"><span class="pre">is</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">branch</span> <span class="ow">is</span> <span class="n">NotABranch</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c1"># ...</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.in_reactor">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">in_reactor</code><span class="sig-paren">(</span><em class="sig-param">fn</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.in_reactor" title="Permalink to this definition">¶</a></dt>
<dd><p>This decorator will cause the wrapped function to be run in the Twisted reactor, with the reactor stopped when the function completes.
It returns the result of the wrapped function.
If the wrapped function fails, its traceback will be printed, the reactor halted, and <code class="docutils literal notranslate"><span class="pre">None</span></code> returned.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.asyncSleep">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">asyncSleep</code><span class="sig-paren">(</span><em class="sig-param">secs</em>, <em class="sig-param">reactor=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.asyncSleep" title="Permalink to this definition">¶</a></dt>
<dd><p>Yield a deferred that will fire with no result after <code class="docutils literal notranslate"><span class="pre">secs</span></code> seconds.
This is the asynchronous equivalent to <code class="docutils literal notranslate"><span class="pre">time.sleep</span></code>, and can be useful in tests.
In case a custom reactor is used, the <code class="docutils literal notranslate"><span class="pre">reactor</span></code> parameter may be set.
By default, <code class="docutils literal notranslate"><span class="pre">twisted.internet.reactor</span></code> is used.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.stripUrlPassword">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">stripUrlPassword</code><span class="sig-paren">(</span><em class="sig-param">url</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.stripUrlPassword" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>url</strong> – a URL</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>URL with any password component replaced with <code class="docutils literal notranslate"><span class="pre">xxxx</span></code></p>
</dd>
</dl>
<p>Sanitize a URL; use this before logging or displaying a DB URL.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.join_list">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">join_list</code><span class="sig-paren">(</span><em class="sig-param">maybe_list</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.join_list" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>maybe_list</strong> – list, tuple, byte string, or unicode</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>unicode</p>
</dd>
</dl>
<p>If <code class="docutils literal notranslate"><span class="pre">maybe_list</span></code> is a list or tuple, join it with spaces, casting any strings into unicode using <code class="xref py py-func docutils literal notranslate"><span class="pre">bytes2unicode()</span></code>.
This is useful for configuration parameters that may be strings or lists of strings.</p>
</dd></dl>

<dl class="class">
<dt>
<code class="sig-name descname">Notifier():</code></dt>
<dd><p>This is a helper for firing multiple deferreds with the same result.</p>
<dl class="method">
<dt id="buildbot.util.wait">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">wait</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.wait" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a deferred that will fire when when the notifier is notified.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.notify">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">notify</code><span class="sig-paren">(</span><em class="sig-param">value</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.notify" title="Permalink to this definition">¶</a></dt>
<dd><p>Fire all the outstanding deferreds with the given value.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="buildbot.util.giturlparse">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">giturlparse</code><span class="sig-paren">(</span><em class="sig-param">url</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.giturlparse" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>url</strong> – a git url</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">GitUrl</span></code> with results of parsed url</p>
</dd>
</dl>
<p>This function is intended to help various components to parse git urls.
It helps to find the <code class="docutils literal notranslate"><span class="pre">&lt;owner&gt;/&lt;repo&gt;</span></code> of a git repository url coming from a change, in order to call urls.
<code class="docutils literal notranslate"><span class="pre">owner</span></code> and <code class="docutils literal notranslate"><span class="pre">repo</span></code> is a common scheme for identifying git repository between various git hosting services like GitHub, GitLab, BitBucket, etc.
Each service have their own naming for similar things, but we choose to use the GitHub naming as a de-facto standard.
To simplify implementation, the parser is accepting invalid urls, but it should always parse valid urls correctly.
The unit tests in <code class="docutils literal notranslate"><span class="pre">test_util_giturlparse.py</span></code> is the references of what the parser is accepting.
Please feel free to update the parser and unit tests</p>
<p>Example use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.util</span> <span class="kn">import</span> <span class="n">giturlparse</span>
<span class="n">repourl</span> <span class="o">=</span> <span class="n">giturlparse</span><span class="p">(</span><span class="n">sourcestamp</span><span class="p">[</span><span class="s1">&#39;repository&#39;</span><span class="p">])</span>
<span class="n">repoOwner</span> <span class="o">=</span> <span class="n">repourl</span><span class="o">.</span><span class="n">owner</span>
<span class="n">repoName</span> <span class="o">=</span> <span class="n">repourl</span><span class="o">.</span><span class="n">repo</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt>
<code class="sig-name descname">GitUrl():</code></dt>
<dd><dl class="attribute">
<dt id="buildbot.util.proto">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">proto</code><a class="headerlink" href="#buildbot.util.proto" title="Permalink to this definition">¶</a></dt>
<dd><p>The protocol of the url</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.user">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">user</code><a class="headerlink" href="#buildbot.util.user" title="Permalink to this definition">¶</a></dt>
<dd><p>The user of the url (as in <code class="docutils literal notranslate"><span class="pre">user&#64;domain</span></code>)</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.domain">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">domain</code><a class="headerlink" href="#buildbot.util.domain" title="Permalink to this definition">¶</a></dt>
<dd><p>The domain part of the url</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.port">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">port</code><a class="headerlink" href="#buildbot.util.port" title="Permalink to this definition">¶</a></dt>
<dd><p>The optional port of the url</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.owner">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">owner</code><a class="headerlink" href="#buildbot.util.owner" title="Permalink to this definition">¶</a></dt>
<dd><p>The owner of the repository (in case of GitLab might be a nested group, i.e contain <code class="docutils literal notranslate"><span class="pre">/</span></code>, e.g <code class="docutils literal notranslate"><span class="pre">repo/subrepo/subsubrepo</span></code>)</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.repo">
<code class="sig-prename descclassname">buildbot.util.</code><code class="sig-name descname">repo</code><a class="headerlink" href="#buildbot.util.repo" title="Permalink to this definition">¶</a></dt>
<dd><p>The owner of the repository (in case of GitLab might be a nested group, i.e contain <code class="docutils literal notranslate"><span class="pre">/</span></code>)</p>
</dd></dl>

</dd></dl>

<div class="section" id="module-buildbot.util.lru">
<span id="buildbot-util-lru"></span><h2><a class="reference internal" href="#module-buildbot.util.lru" title="buildbot.util.lru"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.lru</span></code></a><a class="headerlink" href="#module-buildbot.util.lru" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt>
<code class="sig-name descname">LRUCache(miss_fn, max_size=50):</code></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>miss_fn</strong> – function to call, with key as parameter, for cache misses.
The function should return the value associated with the key argument, or None if there is no value associated with the key.</p></li>
<li><p><strong>max_size</strong> – maximum number of objects in the cache.</p></li>
</ul>
</dd>
</dl>
<p>This is a simple least-recently-used cache.
When the cache grows beyond the maximum size, the least-recently used items will be automatically removed from the cache.</p>
<p>This cache is designed to control memory usage by minimizing duplication of objects, while avoiding unnecessary re-fetching of the same rows from the database.</p>
<p>All values are also stored in a weak valued dictionary, even after they have expired from the cache.
This allows values that are used elsewhere in Buildbot to “stick” in the cache in case they are needed by another component.
Weak references cannot be used for some types, so these types are not compatible with this class.
Note that dictionaries can be weakly referenced if they are an instance of a subclass of <code class="docutils literal notranslate"><span class="pre">dict</span></code>.</p>
<p>If the result of the <code class="docutils literal notranslate"><span class="pre">miss_fn</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>, then the value is not cached; this is intended to avoid caching negative results.</p>
<p>This is based on <a class="reference external" href="http://code.activestate.com/recipes/498245-lru-and-lfu-cache-decorators/">Raymond Hettinger’s implementation</a>, licensed under the PSF license, which is GPL-compatible.</p>
<dl class="attribute">
<dt id="buildbot.util.lru.hits">
<code class="sig-prename descclassname">buildbot.util.lru.</code><code class="sig-name descname">hits</code><a class="headerlink" href="#buildbot.util.lru.hits" title="Permalink to this definition">¶</a></dt>
<dd><p>cache hits so far</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.lru.refhits">
<code class="sig-prename descclassname">buildbot.util.lru.</code><code class="sig-name descname">refhits</code><a class="headerlink" href="#buildbot.util.lru.refhits" title="Permalink to this definition">¶</a></dt>
<dd><p>cache misses found in the weak ref dictionary, so far</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.lru.misses">
<code class="sig-prename descclassname">buildbot.util.lru.</code><code class="sig-name descname">misses</code><a class="headerlink" href="#buildbot.util.lru.misses" title="Permalink to this definition">¶</a></dt>
<dd><p>cache misses leading to re-fetches, so far</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.lru.max_size">
<code class="sig-prename descclassname">buildbot.util.lru.</code><code class="sig-name descname">max_size</code><a class="headerlink" href="#buildbot.util.lru.max_size" title="Permalink to this definition">¶</a></dt>
<dd><p>maximum allowed size of the cache</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.lru.get">
<code class="sig-prename descclassname">buildbot.util.lru.</code><code class="sig-name descname">get</code><span class="sig-paren">(</span><em class="sig-param">key</em>, <em class="sig-param">**miss_fn_kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.lru.get" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> – cache key</p></li>
<li><p><strong>miss_fn_kwargs</strong> – keyword arguments to the <code class="docutils literal notranslate"><span class="pre">miss_fn</span></code></p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>value via Deferred</p>
</dd>
</dl>
<p>Fetch a value from the cache by key, invoking <code class="docutils literal notranslate"><span class="pre">miss_fn(key,</span> <span class="pre">**miss_fn_kwargs)</span></code> if the key is not in the cache.</p>
<p>Any additional keyword arguments are passed to the <code class="docutils literal notranslate"><span class="pre">miss_fn</span></code> as keyword arguments; these can supply additional information relating to the key.
It is up to the caller to ensure that this information is functionally identical for each key value: if the key is already in the cache, the <code class="docutils literal notranslate"><span class="pre">miss_fn</span></code> will not be invoked, even if the keyword arguments differ.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.lru.put">
<code class="sig-prename descclassname">buildbot.util.lru.</code><code class="sig-name descname">put</code><span class="sig-paren">(</span><em class="sig-param">key</em>, <em class="sig-param">value</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.lru.put" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> – key at which to place the value</p></li>
<li><p><strong>value</strong> – value to place there</p></li>
</ul>
</dd>
</dl>
<p>Add the given key and value into the cache.
The purpose of this method is to insert a new value into the cache <em>without</em> invoking the miss_fn (e.g., to avoid unnecessary overhead).</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.lru.inv">
<code class="sig-prename descclassname">buildbot.util.lru.</code><code class="sig-name descname">inv</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.lru.inv" title="Permalink to this definition">¶</a></dt>
<dd><p>Check invariants on the cache.
This is intended for debugging purposes.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt>
<code class="sig-name descname">AsyncLRUCache(miss_fn, max_size=50):</code></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>miss_fn</strong> – This is the same as the miss_fn for class LRUCache, with the difference that this function <em>must</em> return a Deferred.</p></li>
<li><p><strong>max_size</strong> – maximum number of objects in the cache.</p></li>
</ul>
</dd>
</dl>
<p>This class has the same functional interface as LRUCache, but asynchronous locking is used to ensure that in the common case of multiple concurrent requests for the same key, only one fetch is performed.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.bbcollections">
<span id="buildbot-util-bbcollections"></span><h2><a class="reference internal" href="#module-buildbot.util.bbcollections" title="buildbot.util.bbcollections"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.bbcollections</span></code></a><a class="headerlink" href="#module-buildbot.util.bbcollections" title="Permalink to this headline">¶</a></h2>
<p>This package provides a few useful collection objects.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This module used to be named <code class="docutils literal notranslate"><span class="pre">collections</span></code>, but without absolute imports (<span class="target" id="index-0"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0328"><strong>PEP 328</strong></a>), this precluded using the standard library’s <code class="docutils literal notranslate"><span class="pre">collections</span></code> module.</p>
</div>
<dl class="class">
<dt id="buildbot.util.bbcollections.defaultdict">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.bbcollections.</code><code class="sig-name descname">defaultdict</code><a class="headerlink" href="#buildbot.util.bbcollections.defaultdict" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a clone of the Python <code class="xref py py-class docutils literal notranslate"><span class="pre">collections.defaultdict</span></code> for use in Python-2.4.
In later versions, this is simply a reference to the built-in <a class="reference internal" href="#buildbot.util.bbcollections.defaultdict" title="buildbot.util.bbcollections.defaultdict"><code class="xref py py-class docutils literal notranslate"><span class="pre">defaultdict</span></code></a>, so Buildbot code can simply use <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.util.collections.defaultdict</span></code> everywhere.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.util.bbcollections.KeyedSets">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.bbcollections.</code><code class="sig-name descname">KeyedSets</code><a class="headerlink" href="#buildbot.util.bbcollections.KeyedSets" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a collection of named sets.
In principal, it contains an empty set for every name, and you can add things to sets, discard things from sets, and so on.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span> <span class="o">=</span> <span class="n">KeyedSets</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="p">[</span><span class="s1">&#39;tim&#39;</span><span class="p">]</span>                   <span class="c1"># get a named set</span>
<span class="go">set([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tim&#39;</span><span class="p">,</span> <span class="s1">&#39;friendly&#39;</span><span class="p">)</span>   <span class="c1"># add an element to a set</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tim&#39;</span><span class="p">,</span> <span class="s1">&#39;dexterous&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="p">[</span><span class="s1">&#39;tim&#39;</span><span class="p">]</span>
<span class="go">set([&#39;friendly&#39;, &#39;dexterous&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;tim&#39;</span> <span class="ow">in</span> <span class="n">ks</span>                 <span class="c1"># membership testing</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;ron&#39;</span> <span class="ow">in</span> <span class="n">ks</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s1">&#39;tim&#39;</span><span class="p">,</span> <span class="s1">&#39;friendly&#39;</span><span class="p">)</span><span class="c1"># discard set element</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tim&#39;</span><span class="p">)</span>               <span class="c1"># return set and reset to empty</span>
<span class="go">set([&#39;dexterous&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="p">[</span><span class="s1">&#39;tim&#39;</span><span class="p">]</span>
<span class="go">set([])</span>
</pre></div>
</div>
<p>This class is careful to conserve memory space - empty sets do not occupy any space.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.eventual">
<span id="buildbot-util-eventual"></span><h2><a class="reference internal" href="#module-buildbot.util.eventual" title="buildbot.util.eventual"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.eventual</span></code></a><a class="headerlink" href="#module-buildbot.util.eventual" title="Permalink to this headline">¶</a></h2>
<p>This function provides a simple way to say “please do this later”.
For example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.util.eventual</span> <span class="kn">import</span> <span class="n">eventually</span>
<span class="k">def</span> <span class="nf">do_what_I_say</span><span class="p">(</span><span class="n">what</span><span class="p">,</span> <span class="n">where</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="k">return</span> <span class="n">d</span>
<span class="n">eventually</span><span class="p">(</span><span class="n">do_what_I_say</span><span class="p">,</span> <span class="s2">&quot;clean up&quot;</span><span class="p">,</span> <span class="s2">&quot;your bedroom&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The package defines “later” as “next time the reactor has control”, so this is a good way to avoid long loops that block other activity in the reactor.</p>
<dl class="function">
<dt id="buildbot.util.eventual.eventually">
<code class="sig-prename descclassname">buildbot.util.eventual.</code><code class="sig-name descname">eventually</code><span class="sig-paren">(</span><em class="sig-param">cb</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.eventual.eventually" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cb</strong> – callable to invoke later</p></li>
<li><p><strong>args</strong> – args to pass to <code class="docutils literal notranslate"><span class="pre">cb</span></code></p></li>
<li><p><strong>kwargs</strong> – kwargs to pass to <code class="docutils literal notranslate"><span class="pre">cb</span></code></p></li>
</ul>
</dd>
</dl>
<p>Invoke the callable <code class="docutils literal notranslate"><span class="pre">cb</span></code> in a later reactor turn.</p>
<p>Callables given to <a class="reference internal" href="#buildbot.util.eventual.eventually" title="buildbot.util.eventual.eventually"><code class="xref py py-func docutils literal notranslate"><span class="pre">eventually()</span></code></a> are guaranteed to be called in the same order as the calls to <a class="reference internal" href="#buildbot.util.eventual.eventually" title="buildbot.util.eventual.eventually"><code class="xref py py-func docutils literal notranslate"><span class="pre">eventually()</span></code></a> – writing <code class="docutils literal notranslate"><span class="pre">eventually(a);</span> <span class="pre">eventually(b)</span></code> guarantees that <code class="docutils literal notranslate"><span class="pre">a</span></code> will be called before <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p>
<p>Any exceptions that occur in the callable will be logged with <code class="docutils literal notranslate"><span class="pre">log.err()</span></code>.
If you really want to ignore them, provide a callable that catches those exceptions.</p>
<p>This function returns None.
If you care to know when the callable was run, be sure to provide a callable that notifies somebody.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.eventual.fireEventually">
<code class="sig-prename descclassname">buildbot.util.eventual.</code><code class="sig-name descname">fireEventually</code><span class="sig-paren">(</span><em class="sig-param">value=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.eventual.fireEventually" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>value</strong> – value with which the Deferred should fire</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Deferred</p>
</dd>
</dl>
<p>This function returns a Deferred which will fire in a later reactor turn, after the current call stack has been completed, and after all other Deferreds previously scheduled with <a class="reference internal" href="#buildbot.util.eventual.eventually" title="buildbot.util.eventual.eventually"><code class="xref py py-func docutils literal notranslate"><span class="pre">eventually()</span></code></a>.
The returned Deferred will never fail.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.eventual.flushEventualQueue">
<code class="sig-prename descclassname">buildbot.util.eventual.</code><code class="sig-name descname">flushEventualQueue</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.eventual.flushEventualQueue" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Deferred</p>
</dd>
</dl>
<p>This returns a Deferred which fires when the eventual-send queue is finally empty.
This is useful for tests and other circumstances where it is useful to know that “later” has arrived.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.debounce">
<span id="buildbot-util-debounce"></span><h2><a class="reference internal" href="#module-buildbot.util.debounce" title="buildbot.util.debounce"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.debounce</span></code></a><a class="headerlink" href="#module-buildbot.util.debounce" title="Permalink to this headline">¶</a></h2>
<p>It’s often necessary to perform some action in response to a particular type of event.
For example, steps need to update their status after updates arrive from the worker.
However, when many events arrive in quick succession, it’s more efficient to only perform the action once, after the last event has occurred.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">debounce.method(wait)</span></code> decorator is the tool for the job.</p>
<dl class="function">
<dt id="buildbot.util.debounce.method">
<code class="sig-prename descclassname">buildbot.util.debounce.</code><code class="sig-name descname">method</code><span class="sig-paren">(</span><em class="sig-param">wait</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.debounce.method" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wait</strong> – time to wait before invoking, in seconds</p></li>
<li><p><strong>get_reactor</strong> – A callable that takes the underlying instance and returns the reactor to use. Defaults to <code class="docutils literal notranslate"><span class="pre">instance.master.reactor</span></code>.</p></li>
</ul>
</dd>
</dl>
<p>Returns a decorator that debounces the underlying method.
The underlying method must take no arguments (except <code class="docutils literal notranslate"><span class="pre">self</span></code>).</p>
<p>For each call to the decorated method, the underlying method will be invoked at least once within <em>wait</em> seconds (plus the time the method takes to execute).
Calls are “debounced” during that time, meaning that multiple calls to the decorated method will result in a single invocation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This functionality is similar to Underscore’s <code class="docutils literal notranslate"><span class="pre">debounce</span></code>, except that the Underscore method resets its timer on every call.</p>
</div>
<p>The decorated method is an instance of <a class="reference internal" href="#buildbot.util.debounce.Debouncer" title="buildbot.util.debounce.Debouncer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Debouncer</span></code></a>, allowing it to be started and stopped.
This is useful when the method is a part of a Buildbot service: call <code class="docutils literal notranslate"><span class="pre">method.start()</span></code> from <code class="docutils literal notranslate"><span class="pre">startService</span></code> and <code class="docutils literal notranslate"><span class="pre">method.stop()</span></code> from <code class="docutils literal notranslate"><span class="pre">stopService</span></code>, handling its Deferred appropriately.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.util.debounce.Debouncer">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.debounce.</code><code class="sig-name descname">Debouncer</code><a class="headerlink" href="#buildbot.util.debounce.Debouncer" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.util.debounce.Debouncer.stop">
<code class="sig-name descname">stop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.debounce.Debouncer.stop" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Deferred</p>
</dd>
</dl>
<p>Stop the debouncer.
While the debouncer is stopped, calls to the decorated method will be ignored.
If a call is pending when <code class="docutils literal notranslate"><span class="pre">stop</span></code> is called, that call will occur immediately.
When the Deferred that <code class="docutils literal notranslate"><span class="pre">stop</span></code> returns fires, the underlying method is not executing.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.debounce.Debouncer.start">
<code class="sig-name descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.debounce.Debouncer.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the debouncer.
This reverses the effects of <code class="docutils literal notranslate"><span class="pre">stop</span></code>.
This method can be called on a started debouncer without issues.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.poll">
<span id="buildbot-util-poll"></span><h2><a class="reference internal" href="#module-buildbot.util.poll" title="buildbot.util.poll"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.poll</span></code></a><a class="headerlink" href="#module-buildbot.util.poll" title="Permalink to this headline">¶</a></h2>
<p>Many Buildbot services perform some periodic, asynchronous operation.
Change sources, for example, contact the repositories they monitor on a regular basis.
The tricky bit is, the periodic operation must complete before the service stops.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&#64;poll.method</span></code> decorator makes this behavior easy and reliable.</p>
<dl class="function">
<dt id="buildbot.util.poll.method">
<code class="sig-prename descclassname">buildbot.util.poll.</code><code class="sig-name descname">method</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.poll.method" title="Permalink to this definition">¶</a></dt>
<dd><p>This decorator replaces the decorated method with a <a class="reference internal" href="#buildbot.util.poll.Poller" title="buildbot.util.poll.Poller"><code class="xref py py-class docutils literal notranslate"><span class="pre">Poller</span></code></a> instance configured to call the decorated method periodically.
The poller is initially stopped, so periodic calls will not begin until its <code class="docutils literal notranslate"><span class="pre">start</span></code> method is called.
The start polling interval is specified when the poller is started.</p>
<p>If the decorated method fails or raises an exception, the Poller logs the error and re-schedules the call for the next interval.</p>
<p>If a previous invocation of the method has not completed when the interval expires, then the next invocation is skipped and the interval timer starts again.</p>
<p>A common idiom is to call <code class="docutils literal notranslate"><span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">stop</span></code> from <code class="docutils literal notranslate"><span class="pre">startService</span></code> and <code class="docutils literal notranslate"><span class="pre">stopService</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WatchThings</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="nd">@poll.method</span>
    <span class="k">def</span> <span class="nf">watch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beginCheckingSomething</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">startService</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">watch</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pollingInterval</span><span class="p">,</span> <span class="n">now</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stopService</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">watch</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.util.poll.Poller">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.poll.</code><code class="sig-name descname">Poller</code><a class="headerlink" href="#buildbot.util.poll.Poller" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.util.poll.Poller.start">
<code class="sig-name descname">start</code><span class="sig-paren">(</span><em class="sig-param">interval=N</em>, <em class="sig-param">now=False</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.poll.Poller.start" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>interval</strong> – time, in seconds, between invocations</p></li>
<li><p><strong>now</strong> – if true, call the decorated method immediately on startup.</p></li>
</ul>
</dd>
</dl>
<p>Start the poller.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.poll.Poller.stop">
<code class="sig-name descname">stop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.poll.Poller.stop" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Deferred</p>
</dd>
</dl>
<p>Stop the poller.
The returned Deferred fires when the decorated method is complete.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.poll.Poller.__call__">
<code class="sig-name descname">__call__</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.poll.Poller.__call__" title="Permalink to this definition">¶</a></dt>
<dd><p>Force a call to the decorated method now.
If the decorated method is currently running, another call will begin as soon as it completes.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.maildir">
<span id="buildbot-util-maildir"></span><h2><a class="reference internal" href="#module-buildbot.util.maildir" title="buildbot.util.maildir"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.maildir</span></code></a><a class="headerlink" href="#module-buildbot.util.maildir" title="Permalink to this headline">¶</a></h2>
<p>Several Buildbot components make use of <a class="reference external" href="http://www.courier-mta.org/maildir.html">maildirs</a> to hand off messages between components.
On the receiving end, there’s a need to watch a maildir for incoming messages and trigger some action when one arrives.</p>
<dl class="class">
<dt id="buildbot.util.maildir.MaildirService">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.maildir.</code><code class="sig-name descname">MaildirService</code><span class="sig-paren">(</span><em class="sig-param">basedir</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.maildir.MaildirService" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">param basedir</dt>
<dd class="field-odd"><p>(optional) base directory of the maildir</p>
</dd>
</dl>
</div></blockquote>
<p>A <a class="reference internal" href="#buildbot.util.maildir.MaildirService" title="buildbot.util.maildir.MaildirService"><code class="xref py py-class docutils literal notranslate"><span class="pre">MaildirService</span></code></a> instance watches a maildir for new messages.
It should be a child service of some <code class="xref py py-class docutils literal notranslate"><span class="pre">MultiService</span></code> instance.
When running, this class uses the linux dirwatcher API (if available) or polls for new files in the ‘new’ maildir subdirectory.
When it discovers a new message, it invokes its <a class="reference internal" href="#buildbot.util.maildir.MaildirService.messageReceived" title="buildbot.util.maildir.MaildirService.messageReceived"><code class="xref py py-meth docutils literal notranslate"><span class="pre">messageReceived()</span></code></a> method.</p>
<p>To use this class, subclass it and implement a more interesting <a class="reference internal" href="#buildbot.util.maildir.MaildirService.messageReceived" title="buildbot.util.maildir.MaildirService.messageReceived"><code class="xref py py-meth docutils literal notranslate"><span class="pre">messageReceived()</span></code></a> function.</p>
<dl class="method">
<dt id="buildbot.util.maildir.MaildirService.setBasedir">
<code class="sig-name descname">setBasedir</code><span class="sig-paren">(</span><em class="sig-param">basedir</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.maildir.MaildirService.setBasedir" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>basedir</strong> – base directory of the maildir</p>
</dd>
</dl>
<p>If no <code class="docutils literal notranslate"><span class="pre">basedir</span></code> is provided to the constructor, this method must be used to set the basedir before the service starts.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.maildir.MaildirService.messageReceived">
<code class="sig-name descname">messageReceived</code><span class="sig-paren">(</span><em class="sig-param">filename</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.maildir.MaildirService.messageReceived" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> – unqualified filename of the new message</p>
</dd>
</dl>
<p>This method is called with the short filename of the new message.
The full name of the new file can be obtained with <code class="docutils literal notranslate"><span class="pre">os.path.join(maildir,</span> <span class="pre">'new',</span> <span class="pre">filename)</span></code>.
The method is un-implemented in the <a class="reference internal" href="#buildbot.util.maildir.MaildirService" title="buildbot.util.maildir.MaildirService"><code class="xref py py-class docutils literal notranslate"><span class="pre">MaildirService</span></code></a> class, and must be implemented in subclasses.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.maildir.MaildirService.moveToCurDir">
<code class="sig-name descname">moveToCurDir</code><span class="sig-paren">(</span><em class="sig-param">filename</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.maildir.MaildirService.moveToCurDir" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> – unqualified filename of the new message</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>open file object</p>
</dd>
</dl>
<p>Call this from <a class="reference internal" href="#buildbot.util.maildir.MaildirService.messageReceived" title="buildbot.util.maildir.MaildirService.messageReceived"><code class="xref py py-meth docutils literal notranslate"><span class="pre">messageReceived()</span></code></a> to start processing the message; this moves the message file to the ‘cur’ directory and returns an open file handle for it.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.misc">
<span id="buildbot-util-misc"></span><h2><a class="reference internal" href="#module-buildbot.util.misc" title="buildbot.util.misc"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.misc</span></code></a><a class="headerlink" href="#module-buildbot.util.misc" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="buildbot.util.misc.deferredLocked">
<code class="sig-prename descclassname">buildbot.util.misc.</code><code class="sig-name descname">deferredLocked</code><span class="sig-paren">(</span><em class="sig-param">lock</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.misc.deferredLocked" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>lock</strong> – a <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.defer.DeferredLock</span></code> instance or a string naming an instance attribute containing one</p>
</dd>
</dl>
<p>This is a decorator to wrap an event-driven method (one returning a <code class="docutils literal notranslate"><span class="pre">Deferred</span></code>) in an acquire/release pair of a designated <code class="xref py py-class docutils literal notranslate"><span class="pre">DeferredLock</span></code>.
For simple functions with a static lock, this is as easy as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">someLock</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">DeferredLock</span><span class="p">()</span>

<span class="nd">@util.deferredLocked</span><span class="p">(</span><span class="n">someLock</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">someLockedFunction</span><span class="p">():</span>
    <span class="c1"># ..</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>For class methods which must access a lock that is an instance attribute, the lock can be specified by a string, which will be dynamically resolved to the specific instance at runtime:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">someLock</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">DeferredLock</span><span class="p">()</span>

<span class="nd">@util.deferredLocked</span><span class="p">(</span><span class="s1">&#39;someLock&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">someLockedFunction</span><span class="p">():</span>
    <span class="c1"># ..</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.misc.cancelAfter">
<code class="sig-prename descclassname">buildbot.util.misc.</code><code class="sig-name descname">cancelAfter</code><span class="sig-paren">(</span><em class="sig-param">seconds</em>, <em class="sig-param">deferred</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.misc.cancelAfter" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>seconds</strong> – timeout in seconds</p></li>
<li><p><strong>deferred</strong> – deferred to cancel after timeout expires</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the deferred passed to the function</p>
</dd>
</dl>
<p>Cancel the given deferred after the given time has elapsed, if it has not already been fired.
Whent his occurs, the deferred’s errback will be fired with a <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.defer.CancelledError</span></code> failure.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.netstrings">
<span id="buildbot-util-netstrings"></span><h2><a class="reference internal" href="#module-buildbot.util.netstrings" title="buildbot.util.netstrings"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.netstrings</span></code></a><a class="headerlink" href="#module-buildbot.util.netstrings" title="Permalink to this headline">¶</a></h2>
<p>Similar to maildirs, <a class="reference external" href="http://cr.yp.to/proto/netstrings.txt">netstrings</a> are used occasionally in Buildbot to encode data for interchange.
While Twisted supports a basic netstring receiver protocol, it does not have a simple way to apply that to a non-network situation.</p>
<dl class="class">
<dt id="buildbot.util.netstrings.NetstringParser">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.netstrings.</code><code class="sig-name descname">NetstringParser</code><a class="headerlink" href="#buildbot.util.netstrings.NetstringParser" title="Permalink to this definition">¶</a></dt>
<dd><p>This class parses strings piece by piece, either collecting the accumulated strings or invoking a callback for each one.</p>
<dl class="method">
<dt id="buildbot.util.netstrings.NetstringParser.feed">
<code class="sig-name descname">feed</code><span class="sig-paren">(</span><em class="sig-param">data</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.netstrings.NetstringParser.feed" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>data</strong> – a portion of netstring-formatted data</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><code class="xref py py-exc docutils literal notranslate"><span class="pre">twisted.protocols.basic.NetstringParseError</span></code></p>
</dd>
</dl>
<p>Add arbitrarily-sized <code class="docutils literal notranslate"><span class="pre">data</span></code> to the incoming-data buffer.
Any complete netstrings will trigger a call to the <code class="xref py py-meth docutils literal notranslate"><span class="pre">stringReceived()</span></code> method.</p>
<p>Note that this method (like the Twisted class it is based on) cannot detect a trailing partial netstring at EOF - the data will be silently ignored.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="sig-name descname">stringReceived(string):</code></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>string</strong> – the decoded string</p>
</dd>
</dl>
<p>This method is called for each decoded string as soon as it is read completely.
The default implementation appends the string to the <a class="reference internal" href="#buildbot.util.netstrings.NetstringParser.strings" title="buildbot.util.netstrings.NetstringParser.strings"><code class="xref py py-attr docutils literal notranslate"><span class="pre">strings</span></code></a> attribute, but subclasses can do anything.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.netstrings.NetstringParser.strings">
<code class="sig-name descname">strings</code><a class="headerlink" href="#buildbot.util.netstrings.NetstringParser.strings" title="Permalink to this definition">¶</a></dt>
<dd><p>The strings decoded so far, if <code class="xref py py-meth docutils literal notranslate"><span class="pre">stringReceived()</span></code> is not overridden.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.sautils">
<span id="buildbot-util-sautils"></span><h2><a class="reference internal" href="#module-buildbot.util.sautils" title="buildbot.util.sautils"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.sautils</span></code></a><a class="headerlink" href="#module-buildbot.util.sautils" title="Permalink to this headline">¶</a></h2>
<p>This module contains a few utilities that are not included with SQLAlchemy.</p>
<dl class="class">
<dt id="buildbot.util.sautils.InsertFromSelect">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.sautils.</code><code class="sig-name descname">InsertFromSelect</code><span class="sig-paren">(</span><em class="sig-param">table</em>, <em class="sig-param">select</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.sautils.InsertFromSelect" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>table</strong> – table into which insert should be performed</p></li>
<li><p><strong>select</strong> – select query from which data should be drawn</p></li>
</ul>
</dd>
</dl>
<p>This class is taken directly from SQLAlchemy’s <a class="reference external" href="http://www.sqlalchemy.org/docs/core/compiler.html#compiling-sub-elements-of-a-custom-expression-construct">compiler.html</a>, and allows a Pythonic representation of <code class="docutils literal notranslate"><span class="pre">INSERT</span> <span class="pre">INTO</span> <span class="pre">..</span> <span class="pre">SELECT</span> <span class="pre">..</span></code> queries.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.sautils.sa_version">
<code class="sig-prename descclassname">buildbot.util.sautils.</code><code class="sig-name descname">sa_version</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.sautils.sa_version" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a 3-tuple representing the SQLAlchemy version.
Note that older versions that did not have a <code class="docutils literal notranslate"><span class="pre">__version__</span></code> attribute are represented by <code class="docutils literal notranslate"><span class="pre">(0,0,0)</span></code>.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.pathmatch">
<span id="buildbot-util-pathmatch"></span><h2><a class="reference internal" href="#module-buildbot.util.pathmatch" title="buildbot.util.pathmatch"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.pathmatch</span></code></a><a class="headerlink" href="#module-buildbot.util.pathmatch" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="buildbot.util.pathmatch.Matcher">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.pathmatch.</code><code class="sig-name descname">Matcher</code><a class="headerlink" href="#buildbot.util.pathmatch.Matcher" title="Permalink to this definition">¶</a></dt>
<dd><p>This class implements the path-matching algorithm used by the data API.</p>
<p>Patterns are tuples of strings, with strings beginning with a colon (<code class="docutils literal notranslate"><span class="pre">:</span></code>) denoting variables.
A character can precede the colon to indicate the variable type:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">i</span></code> specifies an identifier (<a class="reference internal" href="database.html#type-identifier"><span class="std std-ref">identifier</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n</span></code> specifies a number (parseable by <code class="docutils literal notranslate"><span class="pre">int</span></code>).</p></li>
</ul>
<p>A tuple of strings matches a pattern if the lengths are identical, every variable matches and has the correct type, and every non-variable pattern element matches exactly.</p>
<p>A matcher object takes patterns using dictionary-assignment syntax:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ep</span> <span class="o">=</span> <span class="n">ChangeEndpoint</span><span class="p">()</span>
<span class="n">matcher</span><span class="p">[(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="s1">&#39;n:changeid&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ep</span>
</pre></div>
</div>
<p>and performs matching using the dictionary-lookup syntax:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">changeEndpoint</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">matcher</span><span class="p">[(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="s1">&#39;13&#39;</span><span class="p">)]</span>
<span class="c1"># -&gt; (ep, {&#39;changeid&#39;: 13})</span>
</pre></div>
</div>
<p>where the result is a tuple of the original assigned object (the <code class="docutils literal notranslate"><span class="pre">Change</span></code> instance in this case) and the values of any variables in the path.</p>
<dl class="method">
<dt id="buildbot.util.pathmatch.Matcher.iterPatterns">
<code class="sig-name descname">iterPatterns</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.pathmatch.Matcher.iterPatterns" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an iterator which yields all patterns in the matcher as tuples of (pattern, endpoint).</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.topicmatch">
<span id="buildbot-util-topicmatch"></span><h2><a class="reference internal" href="#module-buildbot.util.topicmatch" title="buildbot.util.topicmatch"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.topicmatch</span></code></a><a class="headerlink" href="#module-buildbot.util.topicmatch" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="buildbot.util.topicmatch.TopicMatcher">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.topicmatch.</code><code class="sig-name descname">TopicMatcher</code><span class="sig-paren">(</span><em class="sig-param">topics</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.topicmatch.TopicMatcher" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>topics</strong> (<em>list</em>) – topics to match</p>
</dd>
</dl>
<p>This class implements the AMQP-defined syntax: routing keys are treated as dot-separated sequences of words and matched against topics.
A star (<code class="docutils literal notranslate"><span class="pre">*</span></code>) in the topic will match any single word, while an octothorpe (<code class="docutils literal notranslate"><span class="pre">#</span></code>) will match zero or more words.</p>
<dl class="method">
<dt id="buildbot.util.topicmatch.TopicMatcher.matches">
<code class="sig-name descname">matches</code><span class="sig-paren">(</span><em class="sig-param">routingKey</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.topicmatch.TopicMatcher.matches" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>routingKey</strong> (<em>string</em>) – routing key to examine</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if the routing key matches a topic</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="buildbot-util-subscription">
<h2><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.subscription</span></code><a class="headerlink" href="#buildbot-util-subscription" title="Permalink to this headline">¶</a></h2>
<p>The classes in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.subscription</span></code> module are used for master-local subscriptions.
In the near future, all uses of this module will be replaced with message-queueing implementations that allow subscriptions and subscribers to span multiple masters.</p>
</div>
<div class="section" id="buildbot-util-croniter">
<h2><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.croniter</span></code><a class="headerlink" href="#buildbot-util-croniter" title="Permalink to this headline">¶</a></h2>
<p>This module is a copy of <a class="reference external" href="https://github.com/taichino/croniter">https://github.com/taichino/croniter</a>, and provides support for converting cron-like time specifications into actual times.</p>
</div>
<div class="section" id="module-buildbot.util.state">
<span id="buildbot-util-state"></span><h2><a class="reference internal" href="#module-buildbot.util.state" title="buildbot.util.state"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.state</span></code></a><a class="headerlink" href="#module-buildbot.util.state" title="Permalink to this headline">¶</a></h2>
<p>The classes in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.subscription</span></code> module are used for dealing with object state stored in the database.</p>
<dl class="class">
<dt id="buildbot.util.state.StateMixin">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.state.</code><code class="sig-name descname">StateMixin</code><a class="headerlink" href="#buildbot.util.state.StateMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>This class provides helper methods for accessing the object state stored in the database.</p>
<dl class="attribute">
<dt id="buildbot.util.state.StateMixin.name">
<code class="sig-name descname">name</code><a class="headerlink" href="#buildbot.util.state.StateMixin.name" title="Permalink to this definition">¶</a></dt>
<dd><p>This must be set to the name to be used to identify this object in the database.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.state.StateMixin.master">
<code class="sig-name descname">master</code><a class="headerlink" href="#buildbot.util.state.StateMixin.master" title="Permalink to this definition">¶</a></dt>
<dd><p>This must point to the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildMaster</span></code> object.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.state.StateMixin.getState">
<code class="sig-name descname">getState</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">default</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.state.StateMixin.getState" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – name of the value to retrieve</p></li>
<li><p><strong>default</strong> – (optional) value to return if <cite>name</cite> is not present</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>state value via a Deferred</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>KeyError</strong> – if <cite>name</cite> is not present and no default is given</p></li>
<li><p><strong>TypeError</strong> – if JSON parsing fails</p></li>
</ul>
</dd>
</dl>
<p>Get a named state value from the object’s state.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="sig-name descname">getState</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">value</em><span class="sig-paren">)</span></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – the name of the value to change</p></li>
<li><p><strong>value</strong> – the value to set - must be a JSONable object</p></li>
<li><p><strong>returns</strong> – Deferred</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>TypeError</strong> – if JSONification fails</p>
</dd>
</dl>
<p>Set a named state value in the object’s persistent state.
Note that value must be json-able.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.identifiers">
<span id="buildbot-util-identifiers"></span><h2><a class="reference internal" href="#module-buildbot.util.identifiers" title="buildbot.util.identifiers"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.identifiers</span></code></a><a class="headerlink" href="#module-buildbot.util.identifiers" title="Permalink to this headline">¶</a></h2>
<p>This module makes it easy to manipulate identifiers.</p>
<dl class="function">
<dt id="buildbot.util.identifiers.isIdentifier">
<code class="sig-prename descclassname">buildbot.util.identifiers.</code><code class="sig-name descname">isIdentifier</code><span class="sig-paren">(</span><em class="sig-param">maxLength</em>, <em class="sig-param">object</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.identifiers.isIdentifier" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>maxLength</strong> – maximum length of the identifier</p></li>
<li><p><strong>object</strong> – object to test for identifier-ness</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>boolean</p>
</dd>
</dl>
<p>Is object a <a class="reference internal" href="database.html#type-identifier"><span class="std std-ref">identifier</span></a>?</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.identifiers.forceIdentifier">
<code class="sig-prename descclassname">buildbot.util.identifiers.</code><code class="sig-name descname">forceIdentifier</code><span class="sig-paren">(</span><em class="sig-param">maxLength</em>, <em class="sig-param">str</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.identifiers.forceIdentifier" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>maxLength</strong> – maximum length of the identifier</p></li>
<li><p><strong>str</strong> – string to coerce to an identifier</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>identifier of maximum length <code class="docutils literal notranslate"><span class="pre">maxLength</span></code></p>
</dd>
</dl>
<p>Coerce a string (assuming UTF-8 for bytestrings) into an identifier.
This method will replace any invalid characters with <code class="docutils literal notranslate"><span class="pre">_</span></code> and truncate to the given length.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.identifiers.incrementIdentifier">
<code class="sig-prename descclassname">buildbot.util.identifiers.</code><code class="sig-name descname">incrementIdentifier</code><span class="sig-paren">(</span><em class="sig-param">maxLength</em>, <em class="sig-param">str</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.identifiers.incrementIdentifier" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>maxLength</strong> – maximum length of the identifier</p></li>
<li><p><strong>str</strong> – identifier to increment</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>identifier of maximum length <code class="docutils literal notranslate"><span class="pre">maxLength</span></code></p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p>ValueError if no suitable identifier can be constructed</p>
</dd>
</dl>
<p>“Increment” an identifier by adding a numeric suffix, while keeping the total length limited.
This is useful when selecting a unique identifier for an object.
Maximum-length identifiers like <code class="docutils literal notranslate"><span class="pre">_999999</span></code> cannot be incremented and will raise <code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code>.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.lineboundaries">
<span id="buildbot-util-lineboundaries"></span><h2><a class="reference internal" href="#module-buildbot.util.lineboundaries" title="buildbot.util.lineboundaries"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.lineboundaries</span></code></a><a class="headerlink" href="#module-buildbot.util.lineboundaries" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="buildbot.util.lineboundaries.LineBoundaryFinder">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.lineboundaries.</code><code class="sig-name descname">LineBoundaryFinder</code><a class="headerlink" href="#buildbot.util.lineboundaries.LineBoundaryFinder" title="Permalink to this definition">¶</a></dt>
<dd><p>This class accepts a sequence of arbitrary strings and invokes a callback only with complete (newline-terminated) substrings.
It buffers any partial lines until a subsequent newline is seen.
It considers any of <code class="docutils literal notranslate"><span class="pre">\r</span></code>, <code class="docutils literal notranslate"><span class="pre">\n</span></code>, and <code class="docutils literal notranslate"><span class="pre">\r\n</span></code> to be newlines.
Because of the ambiguity of an append operation ending in the character <code class="docutils literal notranslate"><span class="pre">\r</span></code> (it may be a bare <code class="docutils literal notranslate"><span class="pre">\r</span></code> or half of <code class="docutils literal notranslate"><span class="pre">\r\n</span></code>), the last line of such an append operation will be buffered until the next append or flush.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>callback</strong> – asynchronous function to call with newline-terminated strings</p>
</dd>
</dl>
<dl class="method">
<dt id="buildbot.util.lineboundaries.LineBoundaryFinder.append">
<code class="sig-name descname">append</code><span class="sig-paren">(</span><em class="sig-param">text</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.lineboundaries.LineBoundaryFinder.append" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>text</strong> – text to append to the boundary finder</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Deferred</p>
</dd>
</dl>
<p>Add additional text to the boundary finder.
If the addition of this text completes at least one line, the callback will be invoked with as many complete lines as possible.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.lineboundaries.LineBoundaryFinder.flush">
<code class="sig-name descname">flush</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.lineboundaries.LineBoundaryFinder.flush" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Deferred</p>
</dd>
</dl>
<p>Flush any remaining partial line by adding a newline and invoking the callback.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.service">
<span id="buildbot-util-service"></span><h2><a class="reference internal" href="#module-buildbot.util.service" title="buildbot.util.service"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.service</span></code></a><a class="headerlink" href="#module-buildbot.util.service" title="Permalink to this headline">¶</a></h2>
<p>This module implements some useful subclasses of Twisted services.</p>
<p>The first two classes are more robust implementations of two Twisted classes, and should be used universally in Buildbot code.</p>
<dl class="class">
<dt id="buildbot.util.service.AsyncMultiService">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.service.</code><code class="sig-name descname">AsyncMultiService</code><a class="headerlink" href="#buildbot.util.service.AsyncMultiService" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is similar to <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.application.service.MultiService</span></code>, except that it handles Deferreds returned from child services <code class="docutils literal notranslate"><span class="pre">startService</span></code> and <code class="docutils literal notranslate"><span class="pre">stopService</span></code> methods.</p>
<p>Twisted’s service implementation does not support asynchronous <code class="docutils literal notranslate"><span class="pre">startService</span></code> methods.
The reasoning is that all services should start at process startup, with no need to coordinate between them.
For Buildbot, this is not sufficient.
The framework needs to know when startup has completed, so it can begin scheduling builds.
This class implements the desired functionality, with a parent service’s <code class="docutils literal notranslate"><span class="pre">startService</span></code> returning a Deferred which will only fire when all child services <code class="docutils literal notranslate"><span class="pre">startService</span></code> methods have completed.</p>
<p>This class also fixes a bug with Twisted’s implementation of <code class="docutils literal notranslate"><span class="pre">stopService</span></code> which ignores failures in the <code class="docutils literal notranslate"><span class="pre">stopService</span></code> process.
With <a class="reference internal" href="#buildbot.util.service.AsyncMultiService" title="buildbot.util.service.AsyncMultiService"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncMultiService</span></code></a>, any errors in a child’s <code class="docutils literal notranslate"><span class="pre">stopService</span></code> will be propagated to the parent’s <code class="docutils literal notranslate"><span class="pre">stopService</span></code> method.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.util.service.AsyncService">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.service.</code><code class="sig-name descname">AsyncService</code><a class="headerlink" href="#buildbot.util.service.AsyncService" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is similar to <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.application.service.Service</span></code>, except that its <code class="docutils literal notranslate"><span class="pre">setServiceParent</span></code> method will return a Deferred.
That Deferred will fire after the <code class="docutils literal notranslate"><span class="pre">startService</span></code> method has completed, if the service was started because the new parent was already running.</p>
</dd></dl>

<p id="index-1">Some services in buildbot must have only one “active” instance at any given time.
In a single-master configuration, this requirement is trivial to maintain.
In a multiple-master configuration, some arbitration is required to ensure that the service is always active on exactly one master in the cluster.</p>
<p>For example, a particular daily scheduler could be configured on multiple masters, but only one of them should actually trigger the required builds.</p>
<dl class="class">
<dt id="buildbot.util.service.ClusteredService">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.service.</code><code class="sig-name descname">ClusteredService</code><a class="headerlink" href="#buildbot.util.service.ClusteredService" title="Permalink to this definition">¶</a></dt>
<dd><p>A base class for a service that must have only one “active” instance in a buildbot configuration.</p>
<p>Each instance of the service is started and stopped via the usual twisted <code class="docutils literal notranslate"><span class="pre">startService</span></code> and <code class="docutils literal notranslate"><span class="pre">stopService</span></code> methods.
This utility class hooks into those methods in order to run an arbitration strategy to pick the one instance that should actually be “active”.</p>
<p>The arbitration strategy is implemented via a polling loop.
When each service instance starts, it immediately offers to take over as the active instance (via <code class="docutils literal notranslate"><span class="pre">_claimService</span></code>).</p>
<p>If successful, the <code class="docutils literal notranslate"><span class="pre">activate</span></code> method is called.
Once active, the instance remains active until it is explicitly stopped (eg, via <code class="docutils literal notranslate"><span class="pre">stopService</span></code>) or otherwise fails.
When this happens, the <code class="docutils literal notranslate"><span class="pre">deactivate</span></code> method is invoked and the “active” status is given back to the cluster (via <code class="docutils literal notranslate"><span class="pre">_unclaimService</span></code>).</p>
<p>If another instance is already active, this offer fails, and the instance will poll periodically to try again.
The polling strategy helps guard against active instances that might silently disappear and leave the service without any active instance running.</p>
<p>Subclasses should use these methods to hook into this activation scheme:</p>
<dl class="method">
<dt id="buildbot.util.service.ClusteredService.activate">
<code class="sig-name descname">activate</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.ClusteredService.activate" title="Permalink to this definition">¶</a></dt>
<dd><p>When a particular instance of the service is chosen to be the one “active” instance, this method is invoked.
It is the corollary to twisted’s <code class="docutils literal notranslate"><span class="pre">startService</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.ClusteredService.deactivate">
<code class="sig-name descname">deactivate</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.ClusteredService.deactivate" title="Permalink to this definition">¶</a></dt>
<dd><p>When the one “active” instance must be deactivated, this method is invoked.
It is the corollary to twisted’s <code class="docutils literal notranslate"><span class="pre">stopService</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.ClusteredService.isActive">
<code class="sig-name descname">isActive</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.ClusteredService.isActive" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns whether this particular instance is the active one.</p>
</dd></dl>

<p>The arbitration strategy is implemented via the following required methods:</p>
<dl class="method">
<dt id="buildbot.util.service.ClusteredService._getServiceId">
<code class="sig-name descname">_getServiceId</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.ClusteredService._getServiceId" title="Permalink to this definition">¶</a></dt>
<dd><p>The “service id” uniquely represents this service in the cluster.
Each instance of this service must have this same id, which will be used in the arbitration to identify candidates for activation.
This method may return a Deferred.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.ClusteredService._claimService">
<code class="sig-name descname">_claimService</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.ClusteredService._claimService" title="Permalink to this definition">¶</a></dt>
<dd><p>An instance is attempting to become the one active instance in the cluster.
This method must return <cite>True</cite> or <cite>False</cite> (optionally via a Deferred) to represent whether this instance’s offer to be the active one was accepted.
If this returns <cite>True</cite>, the <code class="docutils literal notranslate"><span class="pre">activate</span></code> method will be called for this instance.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.ClusteredService._unclaimService">
<code class="sig-name descname">_unclaimService</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.ClusteredService._unclaimService" title="Permalink to this definition">¶</a></dt>
<dd><p>Surrender the “active” status back to the cluster and make it available for another instance.
This will only be called on an instance that successfully claimed the service and has been activated and after its <code class="docutils literal notranslate"><span class="pre">deactivate</span></code> has been called.
Therefore, in this method it is safe to reassign the “active” status to another instance.
This method may return a Deferred.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.util.service.SharedService">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.service.</code><code class="sig-name descname">SharedService</code><a class="headerlink" href="#buildbot.util.service.SharedService" title="Permalink to this definition">¶</a></dt>
<dd><p>This class implements a generic Service that needs to be instantiated only once according to its parameters.
It is a common use case to need this for accessing remote services.
Having a shared service allows to limit the number of simultaneous access to the same remote service.
Thus, several completely independent Buildbot services can use that <a class="reference internal" href="#buildbot.util.service.SharedService" title="buildbot.util.service.SharedService"><code class="xref py py-class docutils literal notranslate"><span class="pre">SharedService</span></code></a> to access the remote service, and automatically synchronize themselves to not overwhelm it.</p>
<dl class="method">
<dt id="buildbot.util.service.SharedService.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.SharedService.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor of the service.</p>
<p>Note that unlike <a class="reference internal" href="#buildbot.util.service.BuildbotService" title="buildbot.util.service.BuildbotService"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildbotService</span></code></a>, <a class="reference internal" href="#buildbot.util.service.SharedService" title="buildbot.util.service.SharedService"><code class="xref py py-class docutils literal notranslate"><span class="pre">SharedService</span></code></a> is not reconfigurable and uses the classical constructor method.</p>
<p>Reconfigurability would mean to add some kind of reference counting of the users, which will make the design much more complicated to use.
This means that the SharedService will not be destroyed when there is no more users, it will be destroyed at the master’s stopService
It is important that those <a class="reference internal" href="#buildbot.util.service.SharedService" title="buildbot.util.service.SharedService"><code class="xref py py-class docutils literal notranslate"><span class="pre">SharedService</span></code></a> life cycles are properly handled.
Twisted will indeed wait for any thread pool to finish at master stop, which will not happen if the thread pools are not properly closed.</p>
<p>The lifecycle of the SharedService is the same as a service, it must implement startService and stopService in order to allocate and free its resources.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.SharedService.getName">
<code class="sig-name descname">getName</code><span class="sig-paren">(</span><em class="sig-param">cls</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.SharedService.getName" title="Permalink to this definition">¶</a></dt>
<dd><p>Class method.
Takes same arguments as the constructor of the service.
Get a unique name for that instance of a service.
This returned name is the key inside the parent’s service dictionary that is used to decide if the instance has already been created before or if there is a need to create a new object.
Default implementation will hash args and kwargs and use <code class="docutils literal notranslate"><span class="pre">&lt;classname&gt;_&lt;hash&gt;</span></code> as the name.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.SharedService.getService">
<code class="sig-name descname">getService</code><span class="sig-paren">(</span><em class="sig-param">cls</em>, <em class="sig-param">parentService</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.SharedService.getService" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>parentService</strong> – an <a class="reference internal" href="#buildbot.util.service.AsyncMultiService" title="buildbot.util.service.AsyncMultiService"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncMultiService</span></code></a> where to lookup and register the <a class="reference internal" href="#buildbot.util.service.SharedService" title="buildbot.util.service.SharedService"><code class="xref py py-class docutils literal notranslate"><span class="pre">SharedService</span></code></a> (usually the root service, the master)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>instance of the service via Deferred</p>
</dd>
</dl>
<p>Class method.
Takes same arguments as the constructor of the service (plus the <cite>parentService</cite> at the beginning of the list).
Construct an instance of the service if needed, and place it at the beginning of the <cite>parentService</cite> service list.
Placing it at the beginning will guarantee that the <a class="reference internal" href="#buildbot.util.service.SharedService" title="buildbot.util.service.SharedService"><code class="xref py py-class docutils literal notranslate"><span class="pre">SharedService</span></code></a> will be stopped after the other services.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.util.service.BuildbotService">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.service.</code><code class="sig-name descname">BuildbotService</code><a class="headerlink" href="#buildbot.util.service.BuildbotService" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is the combinations of all <cite>Service</cite> classes implemented in buildbot.
It is Async, MultiService, and Reconfigurable, and designed to be eventually the base class for all buildbot services.
This class makes it easy to manage (re)configured services.</p>
<p>The design separates the check of the config and the actual configuration/start.
A service sibling is a configured object that has the same name of a previously started service.
The sibling configuration will be used to configure the running service.</p>
<p>Service lifecycle is as follow:</p>
<ul class="simple">
<li><p>Buildbot master start</p></li>
<li><p>Buildbot is evaluating the configuration file.
BuildbotServices are created, and checkConfig() are called by the generic constructor.</p></li>
<li><p>If everything is fine, all services are started.
BuildbotServices startService() is called, and call reconfigService() for the first time.</p></li>
<li><p>User reconfigures buildbot.</p></li>
<li><p>Buildbot is evaluating the configuration file.
BuildbotServices siblings are created, and checkConfig() are called by the generic constructor.</p></li>
<li><p>BuildbotServiceManager is figuring out added services, removed services, unchanged services</p></li>
<li><p>BuildbotServiceManager calls stopService() for services that disappeared from the configuration.</p></li>
<li><p>BuildbotServiceManager calls startService() like in buildbot start phase for services that appeared from the configuration.</p></li>
<li><p>BuildbotServiceManager calls reconfigService() for the second time for services that have their configuration changed.</p></li>
</ul>
<dl class="method">
<dt id="buildbot.util.service.BuildbotService.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.BuildbotService.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor of the service.
The constructor initializes the service, calls checkConfig() and stores the config arguments in private attributes.</p>
<p>This should <em>not</em> be overridden by subclasses, as they should rather override checkConfig.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.BuildbotService.checkConfig">
<code class="sig-name descname">checkConfig</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.BuildbotService.checkConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Please override this method to check the parameters of your config.
Please use <a class="reference internal" href="config.html#buildbot.config.error" title="buildbot.config.error"><code class="xref py py-func docutils literal notranslate"><span class="pre">buildbot.config.error()</span></code></a> for error reporting.
You can replace them <code class="docutils literal notranslate"><span class="pre">*args,</span> <span class="pre">**kwargs</span></code> by actual constructor like arguments with default args, and it have to match self.reconfigService
This method is synchronous, and executed in the context of the master.cfg.
Please don’t block, or use deferreds in this method.
Remember that the object that runs checkConfig is not always the object that is actually started.
The checked configuration can be passed to another sibling service.
Any actual resource creation shall be handled in reconfigService() or startService()</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.BuildbotService.reconfigService">
<code class="sig-name descname">reconfigService</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.BuildbotService.reconfigService" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is called at buildbot startup, and buildbot reconfig.
<cite>*args</cite> and <cite>**kwargs</cite> are the configuration arguments passed to the constructor in master.cfg.
You can replace <code class="docutils literal notranslate"><span class="pre">them</span> <span class="pre">*args,</span> <span class="pre">**kwargs</span></code> by actual constructor like arguments with default args, and it have to match self.checkConfig</p>
<p>Returns a deferred that should fire when the service is ready.
Builds are not started until all services are configured.</p>
<p>BuildbotServices must be aware that during reconfiguration, their methods can still be called by running builds.
So they should atomically switch old configuration and new configuration, so that the service is always available.</p>
<p>If this method raises <code class="xref py py-class docutils literal notranslate"><span class="pre">NotImplementedError</span></code>, it means the service is legacy, and do not support reconfiguration.
The <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildbotServiceManager</span></code> parent, will detect this, and swap old service with new service.
This behaviour allow smooth transition of old code to new reconfigurable service lifecycle but shall not be used for new code.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.BuildbotService.reconfigServiceWithSibling">
<code class="sig-name descname">reconfigServiceWithSibling</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">sibling</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.BuildbotService.reconfigServiceWithSibling" title="Permalink to this definition">¶</a></dt>
<dd><p>Internal method that finds the configuration bits in a sibling, an object with same class that is supposed to replace it from a new configuration.
We want to reuse the service started at master startup and just reconfigure it.
This method handles necessary steps to detect if the config has changed, and eventually call self.reconfigService()</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.BuildbotService.renderSecrets">
<code class="sig-name descname">renderSecrets</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">*args</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.BuildbotService.renderSecrets" title="Permalink to this definition">¶</a></dt>
<dd><p>Utility method which renders a list of parameters which can be interpolated as a secret.
This is meant for services which have their secrets parameter configurable as positional arguments.
If there are several argument, the secrets are interpolated in parallel, and a list of result is returned via deferred.
If there is one argument, the result is directly returned.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For keyword arguments, a simpler method is to use the <code class="docutils literal notranslate"><span class="pre">secrets</span></code> class variable, which items
will be automatically interpolated just before reconfiguration.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reconfigService</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
    <span class="n">user</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderSecrets</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reconfigService</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
    <span class="n">token</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderSecrets</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">secrets</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">reconfigService</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
    <span class="c1"># nothing to do user and password will be automatically interpolated</span>
</pre></div>
</div>
</dd></dl>

<p>Advanced users can derive this class to make their own services that run inside buildbot, and follow the application lifecycle of buildbot master.</p>
<p>Such services are singletons accessible in nearly every objects of buildbot (buildsteps, status, changesources, etc) using self.master.namedServices[‘&lt;nameOfYourService’].</p>
<p>As such, they can be used to factorize access to external services, available e.g using a REST api.
Having a single service will help with caching, and rate-limiting access of those APIs.</p>
<p>Here is an example on how you would integrate and configure a simple service in your <cite>master.cfg</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyShellCommand</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">getResultSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># access the service attribute</span>
        <span class="n">service</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">namedServices</span><span class="p">[</span><span class="s1">&#39;myService&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="sa">u</span><span class="s2">&quot;arg value: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">service</span><span class="o">.</span><span class="n">arg1</span><span class="p">,))</span>

<span class="k">class</span> <span class="nc">MyService</span><span class="p">(</span><span class="n">BuildbotService</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;myService&quot;</span>

    <span class="k">def</span> <span class="nf">checkConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg1</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">config</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;arg1 must be an integer while it is </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arg1</span><span class="p">,))</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">arg1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;arg1 must be positive while it is </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arg1</span><span class="p">,))</span>

    <span class="k">def</span> <span class="nf">reconfigService</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arg1</span> <span class="o">=</span> <span class="n">arg1</span>
        <span class="k">return</span> <span class="n">defer</span><span class="o">.</span><span class="n">succeed</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ForceScheduler</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;force&quot;</span><span class="p">,</span>
        <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;testy&quot;</span><span class="p">])]</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">MyShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s1">&#39;echo hei&#39;</span><span class="p">))</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;builders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">BuilderConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;testy&quot;</span><span class="p">,</span>
                  <span class="n">workernames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;local1&quot;</span><span class="p">],</span>
                  <span class="n">factory</span><span class="o">=</span><span class="n">f</span><span class="p">)]</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">MyService</span><span class="p">(</span><span class="n">arg1</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="buildbot-util-httpclientservice">
<h2><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.httpclientservice</span></code><a class="headerlink" href="#buildbot-util-httpclientservice" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="buildbot.util.service.HTTPClientService">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.service.</code><code class="sig-name descname">HTTPClientService</code><a class="headerlink" href="#buildbot.util.service.HTTPClientService" title="Permalink to this definition">¶</a></dt>
<dd><p>This class implements a SharedService for doing http client access.
The module automatically chooses from <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> and <a class="reference external" href="https://pypi.python.org/pypi/treq">treq</a> and uses whichever is installed.
It provides minimalistic API similar to the one from <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> and <a class="reference external" href="https://pypi.python.org/pypi/treq">treq</a>.
Having a SharedService for this allows to limits the number of simultaneous connection for the same host.
While twisted application can managed thousands of connections at the same time, this is often not the case for the services buildbot controls.
Both <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> and <a class="reference external" href="https://pypi.python.org/pypi/treq">treq</a> use keep-alive connection polling.
Lots of HTTP REST API will however force a connection close in the end of a transaction.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The API described here is voluntary minimalistic, and reflects what is tested.
As most of this module is implemented as a pass-through to the underlying libraries, other options can work but have not been tested to work in both backends.
If there is a need for more functionality, please add new tests before using them.</p>
</div>
<dl class="method">
<dt id="buildbot.util.service.HTTPClientService.getService">
<em class="property">static </em><code class="sig-name descname">getService</code><span class="sig-paren">(</span><em class="sig-param">master</em>, <em class="sig-param">base_url</em>, <em class="sig-param">auth=None</em>, <em class="sig-param">headers=None</em>, <em class="sig-param">debug=None</em>, <em class="sig-param">verify=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.HTTPClientService.getService" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>master</strong> – the instance of the master service (available in self.master for all the <a class="reference internal" href="#buildbot.util.service.BuildbotService" title="buildbot.util.service.BuildbotService"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildbotService</span></code></a> instances)</p></li>
<li><p><strong>base_url</strong> – The base http url of the service to access. e.g. <code class="docutils literal notranslate"><span class="pre">http://github.com/</span></code></p></li>
<li><p><strong>auth</strong> – Authentication information. If auth is a tuple then <code class="docutils literal notranslate"><span class="pre">BasicAuth</span></code> will be used. e.g <code class="docutils literal notranslate"><span class="pre">('user',</span> <span class="pre">'passwd')</span></code>
It can also be a <code class="xref py py-mod docutils literal notranslate"><span class="pre">requests.auth</span></code> authentication plugin.
In this case <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> will be forced, and <a class="reference external" href="https://pypi.python.org/pypi/treq">treq</a> cannot be used.</p></li>
<li><p><strong>headers</strong> – The headers to pass to every requests for this url</p></li>
<li><p><strong>debug</strong> – log every requests and every response.</p></li>
<li><p><strong>verify</strong> – disable the SSL verification.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>instance of :<cite>HTTPClientService</cite></p>
</dd>
</dl>
<p>Get an instance of the SharedService.
There is one instance per base_url and auth.</p>
<p>The constructor initialize the service, and store the config arguments in private attributes.</p>
<p>This should <em>not</em> be overridden by subclasses, as they should rather override checkConfig.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.HTTPClientService.get">
<code class="sig-name descname">get</code><span class="sig-paren">(</span><em class="sig-param">endpoint</em>, <em class="sig-param">params=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.HTTPClientService.get" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>endpoint</strong> – endpoint relative to the base_url (starts with <code class="docutils literal notranslate"><span class="pre">/</span></code>)</p></li>
<li><p><strong>params</strong> – optional dictionary that will be encoded in the query part of the url (e.g. <code class="docutils literal notranslate"><span class="pre">?param1=foo</span></code>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>implementation of :<cite>IHTTPResponse</cite> via deferred</p>
</dd>
</dl>
<p>Performs a HTTP <code class="docutils literal notranslate"><span class="pre">GET</span></code></p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.HTTPClientService.delete">
<code class="sig-name descname">delete</code><span class="sig-paren">(</span><em class="sig-param">endpoint</em>, <em class="sig-param">params=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.HTTPClientService.delete" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>endpoint</strong> – endpoint relative to the base_url (starts with <code class="docutils literal notranslate"><span class="pre">/</span></code>)</p></li>
<li><p><strong>params</strong> – optional dictionary that will be encoded in the query part of the url (e.g. <code class="docutils literal notranslate"><span class="pre">?param1=foo</span></code>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>implementation of :<cite>IHTTPResponse</cite> via deferred</p>
</dd>
</dl>
<p>Performs a HTTP <code class="docutils literal notranslate"><span class="pre">DELETE</span></code></p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.HTTPClientService.post">
<code class="sig-name descname">post</code><span class="sig-paren">(</span><em class="sig-param">endpoint</em>, <em class="sig-param">data=None</em>, <em class="sig-param">json=None</em>, <em class="sig-param">params=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.HTTPClientService.post" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>endpoint</strong> – endpoint relative to the base_url (starts with <code class="docutils literal notranslate"><span class="pre">/</span></code>)</p></li>
<li><p><strong>data</strong> – optional dictionary that will be encoded in the body of the http requests as <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code></p></li>
<li><p><strong>json</strong> – optional dictionary that will be encoded in the body of the http requests as <code class="docutils literal notranslate"><span class="pre">application/json</span></code></p></li>
<li><p><strong>params</strong> – optional dictionary that will be encoded in the query part of the url (e.g. <code class="docutils literal notranslate"><span class="pre">?param1=foo</span></code>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>implementation of :<cite>IHTTPResponse</cite> via deferred</p>
</dd>
</dl>
<p>Performs a HTTP <code class="docutils literal notranslate"><span class="pre">POST</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>json and data cannot be used at the same time.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.HTTPClientService.put">
<code class="sig-name descname">put</code><span class="sig-paren">(</span><em class="sig-param">endpoint</em>, <em class="sig-param">data=None</em>, <em class="sig-param">json=None</em>, <em class="sig-param">params=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.HTTPClientService.put" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>endpoint</strong> – endpoint relative to the base_url (starts with <code class="docutils literal notranslate"><span class="pre">/</span></code>)</p></li>
<li><p><strong>data</strong> – optional dictionary that will be encoded in the body of the http requests as <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code></p></li>
<li><p><strong>json</strong> – optional dictionary that will be encoded in the body of the http requests as <code class="docutils literal notranslate"><span class="pre">application/json</span></code></p></li>
<li><p><strong>params</strong> – optional dictionary that will be encoded in the query part of the url (e.g. <code class="docutils literal notranslate"><span class="pre">?param1=foo</span></code>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>implementation of :<cite>IHTTPResponse</cite> via deferred</p>
</dd>
</dl>
<p>Performs a HTTP <code class="docutils literal notranslate"><span class="pre">PUT</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>json and data cannot be used at the same time.</p>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.util.service.IHTTPResponse">
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.service.</code><code class="sig-name descname">IHTTPResponse</code><a class="headerlink" href="#buildbot.util.service.IHTTPResponse" title="Permalink to this definition">¶</a></dt>
<dd><div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#buildbot.util.service.IHTTPResponse" title="buildbot.util.service.IHTTPResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">IHTTPResponse</span></code></a> is a subset of <a class="reference external" href="https://pypi.python.org/pypi/treq">treq</a> <code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code> API described <a class="reference external" href="https://treq.readthedocs.io/en/latest/api.html#module-treq.response">here</a>
The API it is voluntarily minimalistic and reflects what is tested and reliable to use with the three backends (including fake).
The api is a subset of the <a class="reference external" href="https://pypi.python.org/pypi/treq">treq</a> API, which is itself a superset of <a class="reference external" href="https://twistedmatrix.com/documents/current/api/twisted.web.iweb.IResponse.html">twisted IResponse API</a>.
<a class="reference external" href="https://pypi.python.org/pypi/treq">treq</a> is thus implemented as passthrough.</p>
<p>Notably:</p>
<ul class="simple">
<li><p>There is no api to automatically decode content, as this is not implemented the same in both backends.</p></li>
<li><p>There is no api to stream content as the two libraries have very different way for doing it, and we do not see use-case where buildbot would need to transfer large content to the master.</p></li>
</ul>
</div>
<dl class="method">
<dt id="buildbot.util.service.IHTTPResponse.content">
<code class="sig-name descname">content</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.IHTTPResponse.content" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>raw (<code class="docutils literal notranslate"><span class="pre">bytes</span></code>) content of the response via deferred</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.IHTTPResponse.json">
<code class="sig-name descname">json</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.IHTTPResponse.json" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>json decoded content of the response via deferred</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.service.IHTTPResponse.code">
<code class="sig-name descname">code</code><a class="headerlink" href="#buildbot.util.service.IHTTPResponse.code" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>http status code of the request’s response (e.g 200)</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="buildbot-test-fake-httpclientservice">
<h2><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.test.fake.httpclientservice</span></code><a class="headerlink" href="#buildbot-test-fake-httpclientservice" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt>
<em class="property">class </em><code class="sig-prename descclassname">buildbot.util.service.</code><code class="sig-name descname">HTTPClientService</code></dt>
<dd><p>This class implements a fake version of the <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.util.httpclientservice.HTTPClientService</span></code> that needs to be used for testing services which needs http client access.
It implements the same APIs as <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.util.httpclientservice.HTTPClientService</span></code>, plus one that should be used to register the expectations.
It should be registered by the test case before the tested service actually requests an HTTPClientService instance, with the same parameters.
It will then replace the original implementation automatically (no need to patch anything).
The testing methodology is based on <a class="reference external" href="https://docs.angularjs.org/api/ngMock/service/$httpBackend">AngularJS ngMock</a>.</p>
<dl class="method">
<dt>
<code class="sig-name descname">getFakeService(cls, master, case, *args, **kwargs):</code></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>master</strong> – the instance of a fake master service</p></li>
<li><p><strong>case</strong> – a <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.python.unittest.TestCase</span></code> instance</p></li>
</ul>
</dd>
</dl>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">getFakeService()</span></code> returns a fake <a class="reference internal" href="#buildbot.util.service.HTTPClientService" title="buildbot.util.service.HTTPClientService"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPClientService</span></code></a>, and should be used in place of <a class="reference internal" href="#buildbot.util.service.HTTPClientService.getService" title="buildbot.util.service.HTTPClientService.getService"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getService()</span></code></a>.</p>
<p>on top of <a class="reference internal" href="#buildbot.util.service.HTTPClientService.getService" title="buildbot.util.service.HTTPClientService.getService"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getService()</span></code></a> it will make sure the original <a class="reference internal" href="#buildbot.util.service.HTTPClientService" title="buildbot.util.service.HTTPClientService"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPClientService</span></code></a> is not called, and assert that all expected http requests have been described in the test case.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="sig-name descname">expect(self, method, ep, params=None, data=None, json=None, code=200,</code></dt>
<dt>
<code class="sig-name descname">content=None, content_json=None):</code></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>method</strong> – expected HTTP method</p></li>
<li><p><strong>ep</strong> – expected endpoint</p></li>
<li><p><strong>params</strong> – optional expected query parameters</p></li>
<li><p><strong>data</strong> – optional expected non-json data (bytes)</p></li>
<li><p><strong>json</strong> – optional expected json data (dictionary or list or string)</p></li>
<li><p><strong>code</strong> – optional http code that will be received</p></li>
<li><p><strong>content</strong> – optional content that will be received</p></li>
<li><p><strong>content_json</strong> – optional content encoded in json that will be received</p></li>
</ul>
</dd>
</dl>
<p>Records an expectation of HTTP requests that will happen during the test.
The order of the requests is important.
All the request expectation must be defined in the test.</p>
<p>example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">defer</span>
<span class="kn">from</span> <span class="nn">twisted.trial</span> <span class="kn">import</span> <span class="n">unittest</span>

<span class="kn">from</span> <span class="nn">buildbot.test.fake</span> <span class="kn">import</span> <span class="n">httpclientservice</span> <span class="k">as</span> <span class="n">fakehttpclientservice</span>
<span class="kn">from</span> <span class="nn">buildbot.util</span> <span class="kn">import</span> <span class="n">httpclientservice</span>
<span class="kn">from</span> <span class="nn">buildbot.util</span> <span class="kn">import</span> <span class="n">service</span>


<span class="k">class</span> <span class="nc">myTestedService</span><span class="p">(</span><span class="n">service</span><span class="o">.</span><span class="n">BuildbotService</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;myTestedService&#39;</span>

    <span class="nd">@defer.inlineCallbacks</span>
    <span class="k">def</span> <span class="nf">reconfigService</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseurl</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_http</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">httpclientservice</span><span class="o">.</span><span class="n">HTTPClientService</span><span class="o">.</span><span class="n">getService</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">,</span> <span class="n">baseurl</span><span class="p">)</span>

    <span class="nd">@defer.inlineCallbacks</span>
    <span class="k">def</span> <span class="nf">doGetRoot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="c1"># note that at this point, only the http response headers are received</span>
        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">: server did not succeed&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">code</span><span class="p">))</span>
        <span class="n">res_json</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="c1"># res.json() returns a deferred to account for the time needed to fetch the</span>
        <span class="c1"># entire body</span>
        <span class="k">return</span> <span class="n">res_json</span>


<span class="k">class</span> <span class="nc">Test</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">SynchronousTestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">baseurl</span> <span class="o">=</span> <span class="s1">&#39;http://127.0.0.1:8080&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">MasterService</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_http</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">successResultOf</span><span class="p">(</span>
            <span class="n">fakehttpclientservice</span><span class="o">.</span><span class="n">HTTPClientService</span><span class="o">.</span><span class="n">getFakeService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span>
                                                                   <span class="n">baseurl</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tested</span> <span class="o">=</span> <span class="n">myTestedService</span><span class="p">(</span><span class="n">baseurl</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">successResultOf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tested</span><span class="o">.</span><span class="n">setServiceParent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">successResultOf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">startService</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_http</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">content_json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">})</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">successResultOf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tested</span><span class="o">.</span><span class="n">doGetRoot</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">test_root_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_http</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">content_json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">},</span> <span class="n">code</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">failureResultOf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tested</span><span class="o">.</span><span class="n">doGetRoot</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">getErrorMessage</span><span class="p">(),</span> <span class="s1">&#39;404: server did not succeed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="buildbot-util-ssl">
<h2><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.ssl</span></code><a class="headerlink" href="#buildbot-util-ssl" title="Permalink to this headline">¶</a></h2>
<p>This module is a copy of <code class="xref py py-mod docutils literal notranslate"><span class="pre">twisted.internet.ssl</span></code> except it won’t crash with <code class="xref py py-class docutils literal notranslate"><span class="pre">ImportError</span></code> if <code class="xref py py-mod docutils literal notranslate"><span class="pre">pyopenssl</span></code> is not installed.
If you need to use <code class="xref py py-mod docutils literal notranslate"><span class="pre">twisted.internet.ssl</span></code>, please instead use <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.ssl</span></code>, and call <code class="xref py py-func docutils literal notranslate"><span class="pre">ssl.ensureHasSSL()</span></code> in <code class="xref py py-meth docutils literal notranslate"><span class="pre">checkConfig()</span></code> to provide helpful message to the user, only if he enabled SSL for your plugin.</p>
<dl class="function">
<dt id="buildbot.util.service.ensureHasSSL">
<code class="sig-prename descclassname">buildbot.util.service.</code><code class="sig-name descname">ensureHasSSL</code><span class="sig-paren">(</span><em class="sig-param">plugin_name</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.ensureHasSSL" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>plugin_name</strong> – name of the plugin. Usually <code class="docutils literal notranslate"><span class="pre">self.__class__.__name__</span></code></p>
</dd>
</dl>
<p>Call this function to provide helpful config error to the user in case of <code class="docutils literal notranslate"><span class="pre">OpenSSL</span></code> not installed.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.service.skipUnless">
<code class="sig-prename descclassname">buildbot.util.service.</code><code class="sig-name descname">skipUnless</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.skipUnless" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>f</strong> – decorated test</p>
</dd>
</dl>
<p>Test decorator which will skip the test if <code class="docutils literal notranslate"><span class="pre">OpenSSL</span></code> is not installed.</p>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, junpengxu

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>