

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Javascript Data Module &mdash; buildbot-translate 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> buildbot-translate
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">1. Buildbot Tutorial</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">buildbot-translate</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Javascript Data Module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developer/www-data-module.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="javascript-data-module">
<span id="www-data-module"></span><h1>Javascript Data Module<a class="headerlink" href="#javascript-data-module" title="Permalink to this headline">¶</a></h1>
<p>Data_module is a reusable angularJS module used to access buildbot’s data api from the browser.
Its main purpose is to handle the 3 way binding.</p>
<p>2 way binding is the angular MVVM concept, which seamlessly synchronise the view and the model.
Here we introduce an additional way of synchronisation, which is from the server to the model.</p>
<p>We use the message queue and the websocket interfaces to maintain synchronisation between the server and the client.</p>
<p>The client application just needs to query needed data using a highlevel API, and the data module is using the best approach to make the data always up to date.</p>
<p>Once the binding is setup by the controller, everything is automatically up-to-date.</p>
<div class="section" id="base-concepts">
<h2>Base Concepts<a class="headerlink" href="#base-concepts" title="Permalink to this headline">¶</a></h2>
<div class="section" id="collections">
<h3>Collections<a class="headerlink" href="#collections" title="Permalink to this headline">¶</a></h3>
<p>All the data you can get are Collections.
Even a query to a single resource returns a collection.
A collection is an Array subclass which has extra capabilities:</p>
<ul class="simple">
<li><p>It listen to the event stream and is able to maintain itself up-to-date</p></li>
<li><p>It implements client side query in order to guarantee up-to-date filtering, ordering and limiting queries.</p></li>
<li><p>It has a fast access to each item it contains via its id.</p></li>
<li><p>It has its own event handlers so that client code can react when the Collection is changing</p></li>
</ul>
</div>
<div class="section" id="wrappers">
<h3>Wrappers<a class="headerlink" href="#wrappers" title="Permalink to this headline">¶</a></h3>
<p>Each data type contain in a collection is wrapped in a javascript object.
This allows to create some custom enhancements to the data model.
For example the Change wrapper decodes the author name and email from the “author” field.</p>
<p>Each wrapper class also has specific access method, which allow to access more data from the REST hierarchy.</p>
</div>
<div class="section" id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<p>The Data module is available as a standalone AngularJS module.
Installation via yarn:</p>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>yarn add buildbot-data
</pre></div>
</div>
</div></blockquote>
<p>Inject the <code class="docutils literal notranslate"><span class="pre">bbData</span></code> module to your application:</p>
<blockquote>
<div><div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bbData&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="service-api">
<h3>Service API<a class="headerlink" href="#service-api" title="Permalink to this headline">¶</a></h3>
<div class="section" id="dataservice">
<h4>DataService<a class="headerlink" href="#dataservice" title="Permalink to this headline">¶</a></h4>
<p>DataService is the service used for accessing the Buildbot data API.
It has a modern interface for accessing data in such a way that the updating of the data via web socket is transparent.</p>
<p>Methods:</p>
<p><code class="docutils literal notranslate"><span class="pre">.open()</span></code>: returns a DataAccessor, which handles 3 way data binding</p>
<blockquote>
<div><ul class="simple">
<li><p>open a new accessor every time you need updating data in a controller</p></li>
<li><p>it registers on $destroy event on the scope, and thus automatically unsubscribes from updates when the data is not used anymore.</p></li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// open a new accessor every time you need updating data in a controller</span>
<span class="kr">class</span> <span class="nx">DemoController</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">dataService</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// automatically closes all the bindings when the $scope is destroyed</span>
        <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">dataService</span><span class="p">.</span><span class="nx">open</span><span class="p">().</span><span class="nx">closeOnDestroy</span><span class="p">(</span><span class="nx">$scope</span><span class="p">);</span>

        <span class="c1">// request new data, it updates automatically</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">builders</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">getBuilders</span><span class="p">({</span><span class="nx">limit</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span> <span class="nx">order</span><span class="o">:</span> <span class="s1">&#39;-started_at&#39;</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">.getXs([id],</span> <span class="pre">[query])</span></code>: returns Collection which will eventually contain all the requested data</p>
<blockquote>
<div><ul class="simple">
<li><p>it’s highly advised to use these instead of the lower level <code class="docutils literal notranslate"><span class="pre">.get('string')</span></code> function</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Xs</span></code> can be the following: <code class="docutils literal notranslate"><span class="pre">Builds</span></code>, <code class="docutils literal notranslate"><span class="pre">Builders</span></code>, <code class="docutils literal notranslate"><span class="pre">Buildrequests</span></code>, <code class="docutils literal notranslate"><span class="pre">Buildsets</span></code>, <code class="docutils literal notranslate"><span class="pre">Workers</span></code>, <code class="docutils literal notranslate"><span class="pre">Changes</span></code>, <code class="docutils literal notranslate"><span class="pre">Changesources</span></code>, <code class="docutils literal notranslate"><span class="pre">Forceschedulers</span></code>, <code class="docutils literal notranslate"><span class="pre">Masters</span></code>, <code class="docutils literal notranslate"><span class="pre">Schedulers</span></code>, <code class="docutils literal notranslate"><span class="pre">Sourcestamps</span></code></p></li>
<li><p>The collections returns without using an accessor are not automatically updated.
So use those methods only when you know the data are not changing</p></li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// assign builds to $scope.builds and then load the steps when the builds are discovered</span>
<span class="c1">// onNew is called at initial load</span>
<span class="nx">$scope</span><span class="p">.</span><span class="nx">builds</span> <span class="o">=</span> <span class="nx">dataService</span><span class="p">.</span><span class="nx">getBuilds</span><span class="p">({</span><span class="nx">builderid</span><span class="o">:</span> <span class="mi">1</span><span class="p">});</span>
<span class="nx">$scope</span><span class="p">.</span><span class="nx">builds</span><span class="p">.</span><span class="nx">onNew</span> <span class="o">=</span> <span class="nx">build</span> <span class="p">=&gt;</span> <span class="nx">build</span><span class="p">.</span><span class="nx">loadSteps</span><span class="p">();</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">.get(endpoint,</span> <span class="pre">[id],</span> <span class="pre">[query])</span></code>: returns a &lt;Collection&gt;, when the promise is resolved, the Collection contains all the requested data</p>
<blockquote>
<div><div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// assign builds to $scope.builds once the Collection is filled</span>
<span class="kr">const</span> <span class="nx">builderid</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">$scope</span><span class="p">.</span><span class="nx">builds</span> <span class="o">=</span> <span class="nx">dataService</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="sb">`builders/</span><span class="si">${</span><span class="nx">builderid</span><span class="si">}</span><span class="sb">/builds`</span><span class="p">,</span> <span class="p">{</span><span class="nx">limit</span><span class="o">:</span> <span class="mi">1</span><span class="p">});</span>
<span class="nx">$scope</span><span class="p">.</span><span class="nx">builds</span><span class="p">.</span><span class="nx">onNew</span> <span class="o">=</span> <span class="nx">build</span> <span class="p">=&gt;</span> <span class="nx">build</span><span class="p">.</span><span class="nx">loadSteps</span><span class="p">();</span>
</pre></div>
</div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// assign builds to $scope.builds before the Collection is filled using the</span>
<span class="c1">// .getArray() function</span>
<span class="nx">$scope</span><span class="p">.</span><span class="nx">builds</span> <span class="o">=</span> <span class="nx">dataService</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;builds&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">builderid</span><span class="o">:</span> <span class="mi">1</span><span class="p">});</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">.control(url,</span> <span class="pre">method,</span> <span class="pre">[params])</span></code>: returns a promise, sends a JSON RPC2 POST request to the server</p>
<blockquote>
<div><div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// open a new accessor every time you need updating data in a controller</span>
<span class="nx">dataService</span><span class="p">.</span><span class="nx">control</span><span class="p">(</span><span class="s1">&#39;forceschedulers/force&#39;</span><span class="p">,</span> <span class="s1">&#39;force&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="nx">$log</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="nx">response</span><span class="p">),</span>
          <span class="nx">reason</span> <span class="p">=&gt;</span> <span class="nx">$log</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">reason</span><span class="p">));</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="dataaccessor">
<h4>DataAccessor<a class="headerlink" href="#dataaccessor" title="Permalink to this headline">¶</a></h4>
<p>DataAccessor object is returned by the dataService.open() method.</p>
<p>Methods:</p>
<p><code class="docutils literal notranslate"><span class="pre">.closeOnDestroy($scope)</span></code>: registers scope destruction as waterfall destruction for all collection accessed via this accessor.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">.close()</span></code>: Destruct all collections previously accessed via this accessor.</dt><dd><p>Destroying a collection means it will unsubscribe to any events necessary to maintain it up-to-date.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.getXs([id],</span> <span class="pre">[query])</span></code>: returns Collection which will eventually contain all the requested data</dt><dd><p>Same methods as in the dataService, except here the data will be maintained up-to-date.</p>
</dd>
</dl>
</div>
<div class="section" id="id1">
<h4>Collections<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">.get(id)</span></code>: returns one element of the collection by id, or undefined, if this id is unknown to the collection.</dt><dd><p>This method does not do any network access, and thus only know about data already fetched.</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">.hasOwnProperty(id)</span></code>: returns true if this id is known by this collection.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">.close()</span></code>: forcefully unsubscribe this connection from auto-update.</dt><dd><p>Normally, this is done automatically on scope destruction, but sometimes, when you got enough data, you want to save bandwidth and disconnect the collection.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.put(object)</span></code>: insert one plain object to the collection.</dt><dd><p>As an external API, this method is only useful for the unit tests to simulate new data coming asynchronously.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.from(object_list)</span></code>: insert several plain objects to the collection.</dt><dd><p>This method is only useful for the unit tests to simulate new data coming asynchronously.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.onNew</span> <span class="pre">=</span> <span class="pre">(object)</span> <span class="pre">-&gt;</span></code>: Callback method which is called when a new object arrives in the collection.</dt><dd><p>This can be called either when initial data is coming via REST api, or when data is coming via the event stream.
The affected object is given in parameter.
<cite>this</cite> context is the collection.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.onUpdate</span> <span class="pre">=</span> <span class="pre">(object)</span> <span class="pre">-&gt;</span></code>: Callback method which is called when an object is modified.</dt><dd><p>This is called when data is coming via the event stream.
The affected object is given in parameter.
<cite>this</cite> context is the collection.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.onChange</span> <span class="pre">=</span> <span class="pre">(collection)</span> <span class="pre">-&gt;</span></code>: Callback method which is called when an object is modified.</dt><dd><p>This is called when data is coming via the event stream.
<cite>this</cite> context is the collection.
The full collection is given in parameter (in case you override <code class="docutils literal notranslate"><span class="pre">this</span></code> via fat arrow).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.$ready</span></code>: attribute similar to what <code class="docutils literal notranslate"><span class="pre">ngResource</span></code> provides.</dt><dd><p>True after first server interaction is completed, false before that.
Knowing if the Collection has been resolved is useful in data-binding (for example to display a loading graphic).</p>
</dd>
</dl>
</div>
<div class="section" id="wrapper">
<h4>Wrapper<a class="headerlink" href="#wrapper" title="Permalink to this headline">¶</a></h4>
<p>Wrapper objects are objects stored in the collection.
Those objects have specific methods, depending on their types. methods:</p>
<p><code class="docutils literal notranslate"><span class="pre">.getXs([id],</span> <span class="pre">[query])</span></code>: returns a Collection, when the promise is resolved, the Collection contains all the requested data</p>
<blockquote>
<div><ul class="simple">
<li><p>same as <code class="docutils literal notranslate"><span class="pre">dataService.getXs</span></code>, but with relative endpoint</p></li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// assign builds to $scope.builds once the Collection is filled</span>
<span class="nx">$scope</span><span class="p">.</span><span class="nx">builds</span> <span class="o">=</span> <span class="nx">dataService</span><span class="p">.</span><span class="nx">getBuilds</span><span class="p">({</span><span class="nx">builderid</span><span class="o">:</span> <span class="mi">1</span><span class="p">});</span>
<span class="nx">$scope</span><span class="p">.</span><span class="nx">builds</span><span class="p">.</span><span class="nx">onNew</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">b</span><span class="p">.</span><span class="nx">complete_steps</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">getSteps</span><span class="p">({</span><span class="nx">complete</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
    <span class="nx">b</span><span class="p">.</span><span class="nx">running_steps</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">getSteps</span><span class="p">({</span><span class="nx">complete</span><span class="o">:</span><span class="kc">false</span><span class="p">});</span>
<span class="p">};</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">.loadXs([id],</span> <span class="pre">[query])</span></code>: returns a Collection, the Collection contains all the requested data, which is also assigned to <code class="docutils literal notranslate"><span class="pre">o.Xs</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">o.loadXs()</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">o.xs</span> <span class="pre">=</span> <span class="pre">o.getXs()</span></code></p></li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// get builder with id = 1</span>
<span class="nx">dataService</span><span class="p">.</span><span class="nx">getBuilders</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">onNew</span> <span class="o">=</span> <span class="nx">builder</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// load all builds in builder.builds</span>
    <span class="nx">builder</span><span class="p">.</span><span class="nx">loadBuilds</span><span class="p">().</span><span class="nx">onNew</span><span class="p">(</span><span class="nx">build</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="c1">// load all buildsteps in build.steps</span>
        <span class="nx">build</span><span class="p">.</span><span class="nx">loadSteps</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">};</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">.control(method,</span> <span class="pre">params)</span></code>: returns a promise, sends a JSON RPC2 POST request to the server</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, junpengxu

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>